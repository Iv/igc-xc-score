"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Function.noop=function(){},Function.identity=function(value){return value},Function.by=function(by,compare){compare=compare||Object.compare,by=by||Function.identity;var compareBy=function(a,b){return compare(by(a),by(b))};return compareBy.compare=compare,compareBy.by=by,compareBy},Function.get=function(key){return function(object){return Object.get(object,key)}};var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}function getCjsExportFromNamespace(n){return n&&n.default||n}var genericCollection=GenericCollection;function GenericCollection(){throw new Error("Can't construct. GenericCollection is a mixin.")}var DOMTokenList=commonjsGlobal.DOMTokenList||function(){};GenericCollection.EmptyArray=Object.freeze([]),GenericCollection.prototype.addEach=function(values,mapFn,thisp){if(values&&(values instanceof Array||values instanceof DOMTokenList||values instanceof String))if(mapFn)for(var i=0;i<values.length;i++)this.add(mapFn.call(thisp,values[i]),i);else for(i=0;i<values.length;i++)this.add(values[i],i);else if(values&&Object(values)===values)if("function"==typeof values.forEach)mapFn?values.map(mapFn,thisp).forEach(this.add,this):values.forEach(this.add,this);else if("function"==typeof values.next){var value;i=0;if(mapFn)for(;value=values.next().value;)this.add(mapFn.call(thisp,value),i++);else for(;value=values.next().value;)this.add(value,i++)}else if("number"==typeof values.length)if(mapFn)for(i=0;i<values.length;i++)this.add(mapFn.call(thisp,values[i]),i);else for(i=0;i<values.length;i++)this.add(values[i],i);else mapFn?Object.keys(values).forEach((function(key){this.add(mapFn.call(thisp,values[key]),key)}),this):Object.keys(values).forEach((function(key){this.add(values[key],key)}),this);return this},GenericCollection.prototype.deleteEach=function(values,equals){return values.forEach((function(value){this.delete(value,equals)}),this),this},GenericCollection.prototype.forEach=function(callback){var thisp=arguments[1];return this.reduce((function(undefined$1,value,key,object,depth){callback.call(thisp,value,key,object,depth)}),void 0)},GenericCollection.prototype.map=function(callback){var thisp=arguments[1],result=[];return this.reduce((function(undefined$1,value,key,object,depth){result.push(callback.call(thisp,value,key,object,depth))}),void 0),result},GenericCollection.prototype.enumerate=function(start){null==start&&(start=0);var result=[];return this.reduce((function(undefined$1,value){result.push([start++,value])}),void 0),result},GenericCollection.prototype.group=function(callback,thisp,equals){equals=equals||Object.equals;var groups=[],keys=[];return this.forEach((function(value,key,object){key=callback.call(thisp,value,key,object);var group,index=keys.indexOf(key,equals);-1===index?(group=[],groups.push([key,group]),keys.push(key)):group=groups[index][1],group.push(value)})),groups},GenericCollection.prototype.toArray=function(){return this.map(Function.identity)},GenericCollection.prototype.toObject=function(){var object={};return this.reduce((function(undefined$1,value,key){object[key]=value}),void 0),object},GenericCollection.from=function(){return this.apply(this,arguments)},GenericCollection.prototype.filter=function(callback){var thisp=arguments[1],result=this.constructClone();return this.reduce((function(undefined$1,value,key,object,depth){callback.call(thisp,value,key,object,depth)&&result.add(value,key)}),void 0),result},GenericCollection.prototype.every=function(callback){var thisp=arguments[1];return this.reduce((function(result,value,key,object,depth){return result&&callback.call(thisp,value,key,object,depth)}),!0)},GenericCollection.prototype.some=function(callback){var thisp=arguments[1];return this.reduce((function(result,value,key,object,depth){return result||callback.call(thisp,value,key,object,depth)}),!1)},GenericCollection.prototype.all=function(){return this.every(Boolean)},GenericCollection.prototype.any=function(){return this.some(Boolean)},GenericCollection.prototype.min=function(compare){compare=compare||this.contentCompare||Object.compare;var first=!0;return this.reduce((function(result,value){return first?(first=!1,value):compare(value,result)<0?value:result}),void 0)},GenericCollection.prototype.max=function(compare){compare=compare||this.contentCompare||Object.compare;var first=!0;return this.reduce((function(result,value){return first?(first=!1,value):compare(value,result)>0?value:result}),void 0)},GenericCollection.prototype.sum=function(zero){return zero=void 0===zero?0:zero,this.reduce((function(a,b){return a+b}),zero)},GenericCollection.prototype.average=function(zero){var sum=void 0===zero?0:zero,count=void 0===zero?0:zero;return this.reduce((function(undefined$1,value){sum+=value,count+=1}),void 0),sum/count},GenericCollection.prototype.concat=function(){for(var result=this.constructClone(this),i=0;i<arguments.length;i++)result.addEach(arguments[i]);return result},GenericCollection.prototype.flatten=function(){var self=this;return this.reduce((function(result,array){return array.forEach((function(value){this.push(value)}),result,self),result}),[])},GenericCollection.prototype.zip=function(){var table=Array.prototype.slice.call(arguments);return table.unshift(this),Array.unzip(table)},GenericCollection.prototype.join=function(delimiter){return this.reduce((function(result,string){return void 0===result?string:result+delimiter+string}),void 0)},GenericCollection.prototype.sorted=function(compare,by,order){return(compare=compare||this.contentCompare||Object.compare).by?(by=compare.by,compare=compare.compare||this.contentCompare||Object.compare):by=by||Function.identity,void 0===order&&(order=1),this.map((function(item){return{by:by(item),value:item}})).sort((function(a,b){return compare(a.by,b.by)*order})).map((function(pair){return pair.value}))},GenericCollection.prototype.reversed=function(){return this.constructClone(this).reverse()},GenericCollection.prototype.clone=function(depth,memo){if(void 0===depth)depth=1/0;else if(0===depth)return this;var clone=this.constructClone();return this.forEach((function(value,key){clone.add(Object.clone(value,depth-1,memo),key)}),this),clone},GenericCollection.prototype.only=function(){if(1===this.length)return this.one()},GenericCollection.prototype.iterator=function(){return this.iterate.apply(this,arguments)},GenericCollection._sizePropertyDescriptor={get:function(){return this.length},enumerable:!1,configurable:!0},Object.defineProperty(GenericCollection.prototype,"size",GenericCollection._sizePropertyDescriptor);var weakMap=createCommonjsModule((function(module){!function(){if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=weakMapPermitHostObjects);var doubleWeakMapCheckSilentFailure=!1;if("function"==typeof WeakMap){var HostWeakMap=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var testMap=new HostWeakMap,testObject=Object.freeze({});if(testMap.set(testObject,1),1===testMap.get(testObject))return void(module.exports=WeakMap);doubleWeakMapCheckSilentFailure=!0}}var gopn=Object.getOwnPropertyNames,defProp=Object.defineProperty,isExtensible=Object.isExtensible,HIDDEN_NAME="weakmap:ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var ab=new ArrayBuffer(25),u8s=new Uint8Array(ab);crypto.getRandomValues(u8s),HIDDEN_NAME="weakmap:rand:"+Array.prototype.map.call(u8s,(function(u8){return(u8%36).toString(36)})).join("")+"___"}if(defProp(Object,"getOwnPropertyNames",{value:function(obj){return gopn(obj).filter(isNotHiddenName)}}),"getPropertyNames"in Object){var originalGetPropertyNames=Object.getPropertyNames;defProp(Object,"getPropertyNames",{value:function(obj){return originalGetPropertyNames(obj).filter(isNotHiddenName)}})}!function(){var oldFreeze=Object.freeze;defProp(Object,"freeze",{value:function(obj){return getHiddenRecord(obj),oldFreeze(obj)}});var oldSeal=Object.seal;defProp(Object,"seal",{value:function(obj){return getHiddenRecord(obj),oldSeal(obj)}});var oldPreventExtensions=Object.preventExtensions;defProp(Object,"preventExtensions",{value:function(obj){return getHiddenRecord(obj),oldPreventExtensions(obj)}})}();var calledAsFunctionWarningDone=!1,nextId=0,OurWeakMap=function(){this instanceof OurWeakMap||calledAsFunctionWarning();var keys=[],values=[],id=nextId++;return Object.create(OurWeakMap.prototype,{get___:{value:constFunc((function(key,opt_default){var index,hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord?hiddenRecord[id]:opt_default:(index=keys.indexOf(key))>=0?values[index]:opt_default}))},has___:{value:constFunc((function(key){var hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord:keys.indexOf(key)>=0}))},set___:{value:constFunc((function(key,value){var index,hiddenRecord=getHiddenRecord(key);return hiddenRecord?hiddenRecord[id]=value:(index=keys.indexOf(key))>=0?values[index]=value:(index=keys.length,values[index]=value,keys[index]=key),this}))},delete___:{value:constFunc((function(key){var index,lastIndex,hiddenRecord=getHiddenRecord(key);return hiddenRecord?id in hiddenRecord&&delete hiddenRecord[id]:!((index=keys.indexOf(key))<0)&&(lastIndex=keys.length-1,keys[index]=void 0,values[index]=values[lastIndex],keys[index]=keys[lastIndex],keys.length=lastIndex,values.length=lastIndex,!0)}))}})};OurWeakMap.prototype=Object.create(Object.prototype,{get:{value:function(key,opt_default){return this.get___(key,opt_default)},writable:!0,configurable:!0},has:{value:function(key){return this.has___(key)},writable:!0,configurable:!0},set:{value:function(key,value){return this.set___(key,value)},writable:!0,configurable:!0},delete:{value:function(key){return this.delete___(key)},writable:!0,configurable:!0}}),"function"==typeof HostWeakMap?function(){function DoubleWeakMap(){this instanceof OurWeakMap||calledAsFunctionWarning();var dset,hmap=new HostWeakMap,omap=void 0,enableSwitching=!1;return dset=doubleWeakMapCheckSilentFailure?function(key,value){return hmap.set(key,value),hmap.has(key)||(omap||(omap=new OurWeakMap),omap.set(key,value)),this}:function(key,value){if(enableSwitching)try{hmap.set(key,value)}catch(e){omap||(omap=new OurWeakMap),omap.set___(key,value)}else hmap.set(key,value);return this},Object.create(OurWeakMap.prototype,{get___:{value:constFunc((function(key,opt_default){return omap?hmap.has(key)?hmap.get(key):omap.get___(key,opt_default):hmap.get(key,opt_default)}))},has___:{value:constFunc((function(key){return hmap.has(key)||!!omap&&omap.has___(key)}))},set___:{value:constFunc(dset)},delete___:{value:constFunc((function(key){var result=!!hmap.delete(key);return omap&&omap.delete___(key)||result}))},permitHostObjects___:{value:constFunc((function(token){if(token!==weakMapPermitHostObjects)throw new Error("bogus call to permitHostObjects___");enableSwitching=!0}))}})}doubleWeakMapCheckSilentFailure&&"undefined"!=typeof Proxy&&(Proxy=void 0),DoubleWeakMap.prototype=OurWeakMap.prototype,module.exports=DoubleWeakMap,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),module.exports=OurWeakMap)}function weakMapPermitHostObjects(map){map.permitHostObjects___&&map.permitHostObjects___(weakMapPermitHostObjects)}function isNotHiddenName(name){return!("weakmap:"==name.substr(0,"weakmap:".length)&&"___"===name.substr(name.length-3))}function getHiddenRecord(key){if(key!==Object(key))throw new TypeError("Not an object: "+key);var hiddenRecord=key[HIDDEN_NAME];if(hiddenRecord&&hiddenRecord.key===key)return hiddenRecord;if(isExtensible(key)){hiddenRecord={key:key};try{return defProp(key,HIDDEN_NAME,{value:hiddenRecord,writable:!1,enumerable:!1,configurable:!1}),hiddenRecord}catch(error){return}}}function constFunc(func){return func.prototype=null,Object.freeze(func)}function calledAsFunctionWarning(){calledAsFunctionWarningDone||"undefined"==typeof console||(calledAsFunctionWarningDone=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()})),weakMap$1="undefined"!=typeof WeakMap?WeakMap:weakMap,shimObject=Object;Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(object){return Object(object)===object},Object.getValueOf=function(value){return value&&"function"==typeof value.valueOf&&(value=value.valueOf()),value};var hashMap=new weakMap$1;Object.hash=function(object){return object&&"function"==typeof object.hash?""+object.hash():Object(object)===object?(hashMap.has(object)||hashMap.set(object,Math.random().toString(36).slice(2)),hashMap.get(object)):""+object};var owns=Object.prototype.hasOwnProperty;Object.owns=function(object,key){return owns.call(object,key)},Object.has=function(object,key){if("object"!=typeof object)throw new Error("Object.has can't accept non-object: "+typeof object);if(object&&"function"==typeof object.has)return object.has(key);if("string"==typeof key)return key in object&&object[key]!==Object.prototype[key];throw new Error("Key must be a string for Object.has on plain objects")},Object.get=function(object,key,value){if("object"!=typeof object)throw new Error("Object.get can't accept non-object: "+typeof object);return object&&"function"==typeof object.get?object.get(key,value):Object.has(object,key)?object[key]:value},Object.set=function(object,key,value){object&&"function"==typeof object.set?object.set(key,value):object[key]=value},Object.addEach=function(target,source,overrides){var overridesExistingProperty=3!==arguments.length||overrides;if(source)if("function"!=typeof source.forEach||source.hasOwnProperty("forEach"))if("number"==typeof source.length)for(var index=0;index<source.length;index++)target[index]=source[index];else for(var key,keys=Object.keys(source),i=0;key=keys[i];i++)!overridesExistingProperty&&Object.owns(target,key)||(target[key]=source[key]);else!0===source.isMap?source.forEach((function(value,key){target[key]=value})):source.forEach((function(pair){target[pair[0]]=pair[1]}));else;return target},Object.defineEach=function(target,source,overrides,configurable,enumerable,writable){var overridesExistingProperty=3!==arguments.length||overrides;if(source)if("function"!=typeof source.forEach||source.hasOwnProperty("forEach"))if("number"==typeof source.length)for(var index=0;index<source.length;index++)Object.defineProperty(target,index,{value:source[index],writable:writable,configurable:configurable,enumerable:enumerable});else for(var key,keys=Object.keys(source),i=0;key=keys[i];i++)!overridesExistingProperty&&Object.owns(target,key)||Object.defineProperty(target,key,{value:source[key],writable:writable,configurable:configurable,enumerable:enumerable});else!0===source.isMap?source.forEach((function(value,key){Object.defineProperty(target,key,{value:value,writable:writable,configurable:configurable,enumerable:enumerable})})):source.forEach((function(pair){Object.defineProperty(target,pair[0],{value:pair[1],writable:writable,configurable:configurable,enumerable:enumerable})}));else;return target},Object.forEach=function(object,callback,thisp){for(var iKey,keys=Object.keys(object),i=0;iKey=keys[i];i++)callback.call(thisp,object[iKey],iKey,object)},Object.map=function(object,callback,thisp){for(var iKey,keys=Object.keys(object),i=0,result=[];iKey=keys[i];i++)result.push(callback.call(thisp,object[iKey],iKey,object));return result},Object.values=function(object){return Object.map(object,Function.identity)},Object.concat=function(){for(var object={},i=0;i<arguments.length;i++)Object.addEach(object,arguments[i]);return object},Object.from=Object.concat,Object.is=function(x,y){return x===y?0!==x||1/x==1/y:x!=x&&y!=y},Object.equals=function(a,b,equals,memo){if(equals=equals||Object.equals,(a=Object.getValueOf(a))===(b=Object.getValueOf(b)))return!0;if(Object.isObject(a)){if((memo=memo||new weakMap$1).has(a))return!0;memo.set(a,!0)}if(Object.isObject(a)&&"function"==typeof a.equals)return a.equals(b,equals,memo);if(Object.isObject(b)&&"function"==typeof b.equals)return b.equals(a,equals,memo);if(Object.isObject(a)&&Object.isObject(b)&&Object.getPrototypeOf(a)===Object.prototype&&Object.getPrototypeOf(b)===Object.prototype){for(var name in a)if(!equals(a[name],b[name],equals,memo))return!1;for(var name in b)if(!(name in a)||!equals(b[name],a[name],equals,memo))return!1;return!0}return a!=a&&b!=b||(!a||!b)&&a===b},Object.compare=function(a,b){if((a=Object.getValueOf(a))===(b=Object.getValueOf(b)))return 0;var aType=typeof a,bType=typeof b;return"number"===aType&&"number"===bType?a-b:"string"===aType&&"string"===bType?a<b?-1/0:1/0:a&&"function"==typeof a.compare?a.compare(b):b&&"function"==typeof b.compare?-b.compare(a):0},Object.clone=function(value,depth,memo){if(value=Object.getValueOf(value),memo=memo||new weakMap$1,void 0===depth)depth=1/0;else if(0===depth)return value;if(Object.isObject(value)){if(!memo.has(value))if(value&&"function"==typeof value.clone)memo.set(value,value.clone(depth,memo));else{var prototype=Object.getPrototypeOf(value);if(null!==prototype&&prototype!==Object.prototype)throw new Error("Can't clone "+value);var clone=Object.create(prototype);for(var key in memo.set(value,clone),value)clone[key]=Object.clone(value[key],depth-1,memo)}return memo.get(value)}return value},Object.clear=function(object){if(object&&"function"==typeof object.clear)object.clear();else for(var keys=Object.keys(object),i=keys.length;i;)delete object[keys[--i]];return object};var genericOrder=GenericOrder;function GenericOrder(){throw new Error("Can't construct. GenericOrder is a mixin.")}GenericOrder.prototype.equals=function(that,equals){return equals=equals||this.contentEquals||shimObject.equals,this===that||!!that&&(this.length===that.length&&this.zip(that).every((function(pair){return equals(pair[0],pair[1])})))},GenericOrder.prototype.compare=function(that,compare){if(compare=compare||this.contentCompare||shimObject.compare,this===that)return 0;if(!that)return 1;var length=Math.min(this.length,that.length),comparison=this.zip(that).reduce((function(comparison,pair,index){return 0===comparison?index>=length?comparison:compare(pair[0],pair[1]):comparison}),0);return 0===comparison?this.length-that.length:comparison},GenericOrder.prototype.toJSON=function(){return this.toArray()};var array_splice=Array.prototype.splice,array_slice=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.nativeFrom=Array.from;var isSymbolDefined="undefined"!=typeof Symbol;function define(key,value){Object.defineProperty(Array.prototype,key,{value:value,writable:!0,configurable:!0,enumerable:!1})}Array.from=function(values,mapFn,thisArg){if(isSymbolDefined&&values&&"function"==typeof values[Symbol.iterator])return Array.nativeFrom(values,mapFn,thisArg);var array=[];return array.addEach(values),array},Array.unzip=function(table){for(var transpose=[],length=1/0,i=0;i<table.length;i++){var row=table[i];table[i]=row.toArray(),row.length<length&&(length=row.length)}for(i=0;i<table.length;i++){row=table[i];for(var j=0;j<row.length;j++)j<length&&j in row&&(transpose[j]=transpose[j]||[],transpose[j][i]=row[j])}return transpose},define("addEach",genericCollection.prototype.addEach),define("deleteEach",genericCollection.prototype.deleteEach),define("toArray",genericCollection.prototype.toArray),define("toObject",genericCollection.prototype.toObject),define("all",genericCollection.prototype.all),define("any",genericCollection.prototype.any),define("min",genericCollection.prototype.min),define("max",genericCollection.prototype.max),define("sum",genericCollection.prototype.sum),define("average",genericCollection.prototype.average),define("only",genericCollection.prototype.only),define("flatten",genericCollection.prototype.flatten),define("zip",genericCollection.prototype.zip),define("enumerate",genericCollection.prototype.enumerate),define("group",genericCollection.prototype.group),define("sorted",genericCollection.prototype.sorted),define("reversed",genericCollection.prototype.reversed),define("constructClone",(function(values){var clone=new this.constructor;return clone.addEach(values),clone})),define("has",(function(value,equals){return-1!==this.findValue(value,equals)})),define("get",(function(index,defaultValue){if(+index!==index)throw new Error("Indicies must be numbers");return!index in this?defaultValue:this[index]})),define("set",(function(index,value){return this[index]=value,!0})),define("add",(function(value){return this.push(value),!0})),define("delete",(function(value,equals){var index=this.findValue(value,equals);return-1!==index&&(this.spliceOne(index),!0)})),define("deleteAll",(function(value,equals){equals=equals||this.contentEquals||Object.equals;for(var count=0,index=0;index<this.length;)equals(value,this[index])?(this.swap(index,1),count++):index++;return count})),Array.prototype.find||define("find",(function(predicate){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=arguments[1],k=0;k<len;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return kValue;k++}}));var deprecatedWarnNonce={};function deprecatedWarn(msg,notOnce){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==notOnce&&!1===deprecatedWarnNonce.hasOwnProperty(msg)&&(console.warn(msg),deprecatedWarnNonce[msg]++)}var ArrayFindPrototype=Object.getOwnPropertyDescriptor(Array.prototype,"find").value;function ArrayIterator(array,start,end){this.array=array,this.start=null==start?0:start,this.end=end}if(define("find",(function(value,equals,index){return"function"==typeof arguments[0]&&this instanceof Array?ArrayFindPrototype.apply(this,arguments):(deprecatedWarn("Array#find usage is deprecated please use Array#findValue"),this.findValue.apply(this,arguments))})),define("findValue",(function(value,equals,index){if(index)throw new Error("Array#findValue does not support third argument: index");equals=equals||this.contentEquals||Object.equals;for(index=0;index<this.length;index++)if(index in this&&equals(value,this[index]))return index;return-1})),define("findLast",(function(value,equals){return deprecatedWarn("Array#findLast function is deprecated please use Array#findLastValue instead."),this.findLastValue.apply(this,arguments)})),define("findLastValue",(function(value,equals){equals=equals||this.contentEquals||Object.equals;var index=this.length;do{if(--index in this&&equals(this[index],value))return index}while(index>0);return-1})),define("swap",(function(start,length,plus){var args,plusLength,i,j,returnValue;if(start>this.length&&(this.length=start),void 0!==plus){if(args=[start,length],Array.isArray(plus)||(plus=array_slice.call(plus)),i=0,(plusLength=plus.length)<1e3){for(;i<plusLength;i++)args[i+2]=plus[i];return array_splice.apply(this,args)}for(returnValue=array_splice.apply(this,args);i<plusLength;){for(args=[start+i,0],j=2;j<1002&&i<plusLength;j++,i++)args[j]=plus[i];array_splice.apply(this,args)}return returnValue}return void 0!==length?array_splice.call(this,start,length):void 0!==start?array_splice.call(this,start):[]})),define("peek",(function(){return this[0]})),define("poke",(function(value){this.length>0&&(this[0]=value)})),define("peekBack",(function(){if(this.length>0)return this[this.length-1]})),define("pokeBack",(function(value){this.length>0&&(this[this.length-1]=value)})),define("one",(function(){for(var i in this)if(Object.owns(this,i))return this[i]})),Array.prototype.clear||define("clear",(function(){return this.length=0,this})),define("compare",(function(that,compare){var i,length,relative;if(compare=compare||Object.compare,this===that)return 0;if(!that||!Array.isArray(that))return genericOrder.prototype.compare.call(this,that,compare);for(length=this.length<that.length?this.length:that.length,i=0;i<length;i++)if(i in this){if(!(i in that))return-1;if(relative=compare(this[i],that[i]))return relative}else if(i in that)return 1;return this.length-that.length})),define("equals",(function(that,equals){equals=equals||Object.equals;var i=0,length=this.length;if(this===that)return!0;if(!that||!Array.isArray(that))return genericOrder.prototype.equals.call(this,that);if(length!==that.length)return!1;for(;i<length;++i)if(i in this){if(!(i in that))return!1;if(!equals(this[i],that[i]))return!1}else if(i in that)return!1;return!0})),define("clone",(function(depth,memo){if(null==depth)depth=1/0;else if(0===depth)return this;if((memo=memo||new weakMap$1).has(this))return memo.get(this);var clone=new Array(this.length);for(var i in memo.set(this,clone),this)clone[i]=Object.clone(this[i],depth-1,memo);return clone})),define("iterate",(function(start,end){return new ArrayIterator(this,start,end)})),void 0===Array.prototype.spliceOne&&define("spliceOne",(function(index,itemToAdd){var len=this.length;if(len)if(1===arguments.length){for(;index<len;)this[index]=this[index+1],index++;this.length--}else this[index]=itemToAdd})),define("Iterator",ArrayIterator),ArrayIterator.prototype.__iterationObject=null,Object.defineProperty(ArrayIterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),ArrayIterator.prototype.next=function(){return this.start===(null==this.end?this.array.length:this.end)?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=this.array[this.start++],this._iterationObject},!RegExp.escape){var special=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(string){return string.replace(special,"\\$&")}}getCjsExportFromNamespace(Object.freeze({__proto__:null}));var genericSet=GenericSet;function GenericSet(){throw new Error("Can't construct. GenericSet is a mixin.")}GenericSet.prototype.isSet=!0,GenericSet.prototype.union=function(that){var union=this.constructClone(this);return union.addEach(that),union},GenericSet.prototype.intersection=function(that){return this.constructClone(this.filter((function(value){return that.has(value)})))},GenericSet.prototype.difference=function(that){var union=this.constructClone(this);return union.deleteEach(that),union},GenericSet.prototype.symmetricDifference=function(that){var union=this.union(that),intersection=this.intersection(that);return union.difference(intersection)},GenericSet.prototype.deleteAll=function(value){return+this.delete(value)},GenericSet.prototype.equals=function(that,equals){var self=this;return that&&"function"==typeof that.reduce&&this.length===that.length&&that.reduce((function(equal,value){return equal&&self.has(value,equals)}),!0)},GenericSet.prototype.forEach=function(callback){var thisp=arguments[1];return this.reduce((function(undefined$1,value,key,object,depth){callback.call(thisp,value,value,object,depth)}),void 0)},GenericSet.prototype.toJSON=function(){return this.toArray()},GenericSet.prototype.contains=function(value){return this.has(value)},GenericSet.prototype.remove=function(value){return this.delete(value)},GenericSet.prototype.toggle=function(value){this.has(value)?this.delete(value):this.add(value)};var _valuesArrayFunction=function(value,key){return value};GenericSet.prototype.valuesArray=function(){return this.map(_valuesArrayFunction)};var _entriesArrayFunction=function(value,key){return[key,value]};GenericSet.prototype.entriesArray=function(){return this.map(_entriesArrayFunction)};var _list=List;function List(values,equals,getDefault){return List._init(List,this,values,equals,getDefault)}function ListIterator(head){this.head=head,this.at=head.next}function Node(value){this.value=value,this.prev=null,this.next=null}List._init=function(constructor,object,values,equals,getDefault){if(!(object instanceof constructor))return new constructor(values,equals,getDefault);var head=object.head=new object.Node;head.next=head,head.prev=head,object.contentEquals=equals||Object.equals,object.getDefault=getDefault||Function.noop,object.length=0,object.addEach(values)},List.List=List,Object.addEach(List.prototype,genericCollection.prototype),Object.addEach(List.prototype,genericOrder.prototype),List.from=genericCollection.from,List.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.getDefault)},List.prototype.find=function(value,equals,index){equals=equals||this.contentEquals;for(var head=this.head,at=this.scan(index,head.next);at!==head;){if(equals(at.value,value))return at;at=at.next}},List.prototype.findLast=function(value,equals,index){equals=equals||this.contentEquals;for(var head=this.head,at=this.scan(index,head.prev);at!==head;){if(equals(at.value,value))return at;at=at.prev}},List.prototype.has=function(value,equals){return!!this.find(value,equals)},List.prototype.get=function(value,equals){var found=this.find(value,equals);return found?found.value:this.getDefault(value)},List.prototype.delete=function(value,equals){var found=this.findLast(value,equals);return!!found&&(found.delete(),this.length--,!0)},List.prototype.deleteAll=function(value,equals){equals=equals||this.contentEquals;for(var head=this.head,at=head.next,count=0;at!==head;)equals(value,at.value)&&(at.delete(),count++),at=at.next;return this.length-=count,count},List.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},List.prototype.add=function(value){var node=new this.Node(value);return this._addNode(node)},List.prototype._addNode=function(node){return this.head.addBefore(node),this.length++,!0},List.prototype.push=function(){for(var head=this.head,i=0;i<arguments.length;i++){var value=arguments[i],node=new this.Node(value);head.addBefore(node)}this.length+=arguments.length},List.prototype.unshift=function(){for(var at=this.head,i=0;i<arguments.length;i++){var value=arguments[i],node=new this.Node(value);at.addAfter(node),at=node}this.length+=arguments.length},List.prototype._shouldPop=function(){var value,head=this.head;return head.prev!==head&&(value=head.prev.value),value},List.prototype.pop=function(_before,_after){var value,head=this.head;if(head.prev!==head){value=head.prev.value;var index=this.length-1,popDispatchValueArray=_before?_before.call(this,value,index):void 0;head.prev.delete(),this.length--,_after&&_after.call(this,value,index,popDispatchValueArray)}return value},List.prototype.shift=function(_before,_after){var value,head=this.head;if(head.prev!==head){value=head.next.value;var dispatchValueArray=_before?_before.call(this,value,0):void 0;head.next.delete(),this.length--,_after&&_after.call(this,value,0,dispatchValueArray)}return value},List.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},List.prototype.poke=function(value){this.head!==this.head.next?this.head.next.value=value:this.push(value)},List.prototype.one=function(){return this.peek()},List.prototype.scan=function(at,fallback){var head=this.head;if("number"==typeof at){var count=at;if(count>=0)for(at=head.next;count&&(count--,(at=at.next)!=head););else for(at=head;count<0&&(count++,(at=at.prev)!=head););return at}return at||fallback},List.prototype.slice=function(at,end){var sliced=[],head=this.head;for(at=this.scan(at,head.next),end=this.scan(end,head);at!==end&&at!==head;)sliced.push(at.value),at=at.next;return sliced},List.prototype.splice=function(at,length){return this.swap(at,length,Array.prototype.slice.call(arguments,2))},List.prototype.swap=function(start,length,plus,_before,_after){var initial=start;start=this.scan(start,this.head),null==length&&(length=1/0),plus=Array.from(plus);for(var minus=[],at=start;length--&&length>=0&&at!==this.head;)minus.push(at.value),at=at.next;_before&&_before.call(this,start,plus,minus);at=start;var i=0;for(at=start;i<minus.length;i++,at=at.next)at.delete();null==initial&&at===this.head&&(at=this.head.next);for(i=0;i<plus.length;i++){var node=new this.Node(plus[i]);at.addBefore(node)}return this.length+=plus.length-minus.length,_after&&_after.call(this,start,plus,minus),minus},List.prototype.reverse=function(){var at=this.head;do{var temp=at.next;at.next=at.prev,at.prev=temp,at=at.next}while(at!==this.head);return this},List.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))},List.prototype.reduce=function(callback,basis){for(var thisp=arguments[2],head=this.head,at=head.next;at!==head;)basis=callback.call(thisp,basis,at.value,at,this),at=at.next;return basis},List.prototype.reduceRight=function(callback,basis){for(var thisp=arguments[2],head=this.head,at=head.prev;at!==head;)basis=callback.call(thisp,basis,at.value,at,this),at=at.prev;return basis},List.prototype.updateIndexes=function(node,index){for(;node!==this.head;)node.index=index++,node=node.next},List.prototype.iterate=function(){return new ListIterator(this.head)},ListIterator.prototype.__iterationObject=null,Object.defineProperty(ListIterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),ListIterator.prototype.next=function(){if(this.at===this.head)this._iterationObject.done=!0,this._iterationObject.value=void 0;else{var value=this.at.value;this.at=this.at.next,this._iterationObject.value=value}return this._iterationObject},List.prototype.Node=Node,Node.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},Node.prototype.addBefore=function(node){var prev=this.prev;this.prev=node,node.prev=prev,prev.next=node,node.next=this},Node.prototype.addAfter=function(node){var next=this.next;this.next=node,node.next=next,next.prev=node,node.prev=this};var iterator=Iterator;function Iterator(iterable,standardMode){var values=standardMode&&iterable&&iterable.values&&iterable.values();if(values&&"function"==typeof values.next)return values;if(!(this instanceof Iterator))return new Iterator(iterable);if(Array.isArray(iterable)||"string"==typeof iterable)return Iterator.iterate(iterable);if((iterable=shimObject(iterable))instanceof Iterator)return iterable;if(iterable.next)this.next=function(){return iterable.next()};else if(iterable.iterate){var iterator=iterable.iterate();this.next=function(){return iterator.next()}}else{if("[object Function]"!==shimObject.prototype.toString.call(iterable))throw new TypeError("Can't iterate "+iterable);this.next=iterable}}Iterator.prototype.forEach=genericCollection.prototype.forEach,Iterator.prototype.map=genericCollection.prototype.map,Iterator.prototype.filter=genericCollection.prototype.filter,Iterator.prototype.every=genericCollection.prototype.every,Iterator.prototype.some=genericCollection.prototype.some,Iterator.prototype.any=genericCollection.prototype.any,Iterator.prototype.all=genericCollection.prototype.all,Iterator.prototype.min=genericCollection.prototype.min,Iterator.prototype.max=genericCollection.prototype.max,Iterator.prototype.sum=genericCollection.prototype.sum,Iterator.prototype.average=genericCollection.prototype.average,Iterator.prototype.flatten=genericCollection.prototype.flatten,Iterator.prototype.zip=genericCollection.prototype.zip,Iterator.prototype.enumerate=genericCollection.prototype.enumerate,Iterator.prototype.sorted=genericCollection.prototype.sorted,Iterator.prototype.group=genericCollection.prototype.group,Iterator.prototype.reversed=genericCollection.prototype.reversed,Iterator.prototype.toArray=genericCollection.prototype.toArray,Iterator.prototype.toObject=genericCollection.prototype.toObject,Iterator.prototype.iterator=genericCollection.prototype.iterator,Iterator.prototype.__iterationObject=null,shimObject.defineProperty(Iterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Iterator.prototype.constructClone=function(values){var clone=[];return clone.addEach(values),clone},Iterator.prototype.mapIterator=function(callback){var self=Iterator(this),thisp=arguments[1],i=0;if("[object Function]"!=shimObject.prototype.toString.call(callback))throw new TypeError;return new self.constructor((function(){if(!0!==self._iterationObject.done){var callbackValue=callback.call(thisp,self.next().value,i++,self);self._iterationObject.value=callbackValue}return self._iterationObject}))},Iterator.prototype.filterIterator=function(callback){var self=Iterator(this),thisp=arguments[1],i=0;if("[object Function]"!=shimObject.prototype.toString.call(callback))throw new TypeError;return new self.constructor((function(){for(var nextEntry;;){if(!0===(nextEntry=self.next()).done)return nextEntry;if(callback.call(thisp,nextEntry.value,i++,self))return nextEntry}}))},Iterator.prototype.reduce=function(callback){var nextEntry,self=Iterator(this),result=arguments[1],thisp=arguments[2],i=0;if("[object Function]"!=shimObject.prototype.toString.call(callback))throw new TypeError;if(!0===(nextEntry=self.next()).done){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(result=arguments.length>1?callback.call(thisp,result,nextEntry.value,i,self):nextEntry.value,i++;;){if(!0===(nextEntry=self.next()).done)return result;result=callback.call(thisp,result,nextEntry.value,i,self),i++}},Iterator.prototype.concat=function(){return Iterator.concat(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.dropWhile=function(callback){var stopValue,nextEntry,self=Iterator(this),thisp=arguments[1],stopped=!1,i=0;if("[object Function]"!=shimObject.prototype.toString.call(callback))throw new TypeError;for(;!0!==(nextEntry=self.next()).done;){if(!callback.call(thisp,nextEntry.value,i,self)){stopped=!0,stopValue=nextEntry.value;break}i++}return stopped?self.constructor([stopValue]).concat(self):self.constructor([])},Iterator.prototype.takeWhile=function(callback){var self=Iterator(this),thisp=arguments[1],i=0;if("[object Function]"!=shimObject.prototype.toString.call(callback))throw new TypeError;return new self.constructor((function(){if(!0!==self._iterationObject.done){var value=self.next().value;callback.call(thisp,value,i++,self)?self._iterationObject.value=value:(self._iterationObject.done=!0,self._iterationObject.value=void 0)}return self._iterationObject}))},Iterator.prototype.zipIterator=function(){return Iterator.unzip(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.enumerateIterator=function(start){return Iterator.count(start).zipIterator(this)},Iterator.iterate=function(iterable){var start;return start=0,new Iterator((function(){if("object"==typeof iterable)for(;!(start in iterable);){if(start>=iterable.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}start+=1}else start>=iterable.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=iterable[start],start+=1),this._iterationObject}))},Iterator.cycle=function(cycle,times){var next;return arguments.length<2&&(times=1/0),new Iterator((function(){var iteration,nextEntry;return next&&(nextEntry=next()),next&&!0!==nextEntry.done||(times>0?(times--,iteration=Iterator.iterate(cycle),nextEntry=(next=iteration.next.bind(iteration))()):(this._iterationObject.done=!0,nextEntry=this._iterationObject)),nextEntry}))},Iterator.concat=function(iterators){var next;return iterators=Iterator(iterators),new Iterator((function(){var iteration,nextEntry;return next&&(nextEntry=next()),nextEntry&&!0!==nextEntry.done?nextEntry:!1===(nextEntry=iterators.next()).done?(iteration=Iterator(nextEntry.value),(next=iteration.next.bind(iteration))()):nextEntry}))},Iterator.unzip=function(iterators){return 0===(iterators=Iterator(iterators).map(Iterator)).length?new Iterator([]):new Iterator((function(){var stopped,nextEntry,result=iterators.map((function(iterator){return!0===(nextEntry=iterator.next()).done&&(stopped=!0),nextEntry.value}));return stopped?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=result,this._iterationObject}))},Iterator.zip=function(){return Iterator.unzip(Array.prototype.slice.call(arguments))},Iterator.chain=function(){return Iterator.concat(Array.prototype.slice.call(arguments))},Iterator.range=function(start,stop,step){return arguments.length<3&&(step=1),arguments.length<2&&(stop=start,start=0),start=start||0,step=step||1,new Iterator((function(){start>=stop&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var result=start;return start+=step,this._iterationObject.value=result,this._iterationObject}))},Iterator.count=function(start,step){return Iterator.range(start,1/0,step)},Iterator.repeat=function(value,times){return new Iterator.range(times).mapIterator((function(){return value}))};var genericMap=GenericMap;function GenericMap(){throw new Error("Can't construct. GenericMap is a mixin.")}function Item(key,value){this.key=key,this.value=value}GenericMap.prototype.isMap=!0,GenericMap.prototype.addEach=function(values){var i;if(values&&shimObject(values)===values)if("function"==typeof values.forEach)!0===values.isMap?values.forEach((function(value,key){this.set(key,value)}),this):values.forEach((function(pair){this.set(pair[0],pair[1])}),this);else if("number"==typeof values.length)for(i=0;i<values.length;i++)this.add(values[i],i);else shimObject.keys(values).forEach((function(key){this.set(key,values[key])}),this);else if(values&&"number"==typeof values.length)for(i=0;i<values.length;i++)this.add(values[i],i);return this},GenericMap.prototype.get=function(key,defaultValue){var item=this.store.get(new this.Item(key));return item?item.value:arguments.length>1?(console.log("Use of a second argument as default value is deprecated to match standards"),defaultValue):this.getDefault(key)},GenericMap.prototype.set=function(key,value){var item=new this.Item(key,value),found=this.store.get(item);return found?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,found.value),found.value=value,this.dispatchesMapChanges&&this.dispatchMapChange(key,value)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,void 0),this.store.add(item)&&this.length++,this.dispatchesMapChanges&&this.dispatchMapChange(key,value)),this},GenericMap.prototype.add=function(value,key){return this.set(key,value)},GenericMap.prototype.has=function(key){return this.store.has(new this.Item(key))},GenericMap.prototype.delete=function(key){var item=new this.Item(key);if(this.store.has(item)){var from=this.store.get(item).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,from),this.store.delete(item),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0),!0}return!1},GenericMap.prototype.clear=function(){var keys,key;if(this.dispatchesMapChanges&&(this.forEach((function(value,key){this.dispatchBeforeMapChange(key,value)}),this),keys=this.keysArray()),this.store.clear(),this.length=0,this.dispatchesMapChanges)for(var i=0;key=keys[i];i++)this.dispatchMapChange(key)},GenericMap.prototype.reduce=function(callback,basis,thisp){return this.store.reduce((function(basis,item){return callback.call(thisp,basis,item.value,item.key,this)}),basis,this)},GenericMap.prototype.reduceRight=function(callback,basis,thisp){return this.store.reduceRight((function(basis,item){return callback.call(thisp,basis,item.value,item.key,this)}),basis,this)},GenericMap.prototype.keysArray=function(){return this.map((function(value,key){return key}))},GenericMap.prototype.keys=function(){return new iterator(this.keysArray(),!0)},GenericMap.prototype.valuesArray=function(){return this.map(Function.identity)},GenericMap.prototype.values=function(){return new iterator(this.valuesArray(),!0)},GenericMap.prototype.entriesArray=function(){return this.map((function(value,key){return[key,value]}))},GenericMap.prototype.entries=function(){return new iterator(this.entriesArray(),!0)},GenericMap.prototype.items=function(){return this.entriesArray()},GenericMap.prototype.equals=function(that,equals){return equals=equals||shimObject.equals,this===that||(that&&"function"==typeof that.every?that.length===this.length&&that.every((function(value,key){return equals(this.get(key),value)}),this):shimObject.keys(that).length===this.length&&shimObject.keys(that).every((function(key){return equals(this.get(key),that[key])}),this))},GenericMap.prototype.toJSON=function(){return this.entriesArray()},GenericMap.prototype.Item=Item,Item.prototype.equals=function(that){return shimObject.equals(this.key,that.key)&&shimObject.equals(this.value,that.value)},Item.prototype.compare=function(that){return shimObject.compare(this.key,that.key)};var _dict=Dict;function Dict(values,getDefault){if(!(this instanceof Dict))return new Dict(values,getDefault);getDefault=getDefault||Function.noop,this.getDefault=getDefault,this.store=Object.create(null),this.length=0,this.addEach(values)}Dict.Dict=Dict,Object.addEach(Dict.prototype,genericCollection.prototype),Object.addEach(Dict.prototype,genericMap.prototype),Dict.from=genericCollection.from,Dict.prototype.constructClone=function(values){return new this.constructor(values,this.getDefault)},Dict.prototype.assertString=function(key){if("string"!=typeof key)throw new TypeError("key must be a string but Got "+key)},Object.defineProperty(Dict.prototype,"$__proto__",{writable:!0}),Object.defineProperty(Dict.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&void 0!==this._protoValue}}),Object.defineProperty(Dict.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(value){this.$__proto__=value}}),Object.defineProperty(Dict.prototype,"size",genericCollection._sizePropertyDescriptor),Dict.prototype.get=function(key,defaultValue){return this.assertString(key),"__proto__"===key?this._hasProto?this._protoValue:arguments.length>1?defaultValue:this.getDefault(key):key in this.store?this.store[key]:arguments.length>1?defaultValue:this.getDefault(key)},Dict.prototype.set=function(key,value){this.assertString(key);var isProtoKey="__proto__"===key;return(isProtoKey?this._hasProto:key in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,isProtoKey?this._protoValue:this.store[key]),isProtoKey?this._protoValue=value:this.store[key]=value,this.dispatchesMapChanges&&this.dispatchMapChange(key,value),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,void 0),this.length++,isProtoKey?this._protoValue=value:this.store[key]=value,this.dispatchesMapChanges&&this.dispatchMapChange(key,value),!0)},Dict.prototype.has=function(key){return this.assertString(key),"__proto__"===key?this._hasProto:key in this.store},Dict.prototype.delete=function(key){return this.assertString(key),"__proto__"===key?!!this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0),!0):key in this.store&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,this.store[key]),delete this.store[key],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0),!0)},Dict.prototype.clear=function(){var key;for(key in this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0)),this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,this.store[key]),delete this.store[key],this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0);this.length=0},Dict.prototype.reduce=function(callback,basis,thisp){this._hasProto&&(basis=callback.call(thisp,basis,"$__proto__","__proto__",this));var store=this.store;for(var key in this.store)basis=callback.call(thisp,basis,store[key],key,this);return basis},Dict.prototype.reduceRight=function(callback,basis,thisp){var self=this,store=this.store;return basis=Object.keys(this.store).reduceRight((function(basis,key){return callback.call(thisp,basis,store[key],key,self)}),basis),this._hasProto?callback.call(thisp,basis,this._protoValue,"__proto__",self):basis},Dict.prototype.one=function(){var key;for(key in this.store)return this.store[key];return this._protoValue},Dict.prototype.toJSON=function(){return this.toObject()};var treeLog=TreeLog;function TreeLog(){}TreeLog.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},TreeLog.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},TreeLog.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"};var _fastSet=FastSet;function FastSet(values,equals,hash,getDefault){if(!(this instanceof FastSet))return new FastSet(values,equals,hash,getDefault);equals=equals||Object.equals,hash=hash||Object.hash,getDefault=getDefault||Function.noop,this.contentEquals=equals,this.contentHash=hash,this.getDefault=getDefault;var self=this;this.buckets=new this.Buckets(null,(function(){return new self.Bucket})),this.length=0,this.addEach(values)}FastSet.FastSet=FastSet,Object.addEach(FastSet.prototype,genericCollection.prototype),Object.addEach(FastSet.prototype,genericSet.prototype),FastSet.from=genericCollection.from,FastSet.prototype.Buckets=_dict,FastSet.prototype.Bucket=_list,FastSet.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentHash,this.getDefault)},FastSet.prototype.has=function(value){var hash=this.contentHash(value);return this.buckets.get(hash).has(value)},FastSet.prototype.get=function(value,equals){if(equals)throw new Error("FastSet#get does not support second argument: equals");var hash=this.contentHash(value),buckets=this.buckets;return buckets.has(hash)?buckets.get(hash).get(value):this.getDefault(value)},FastSet.prototype.delete=function(value,equals){if(equals)throw new Error("FastSet#delete does not support second argument: equals");var hash=this.contentHash(value),buckets=this.buckets;if(buckets.has(hash)){var bucket=buckets.get(hash);if(bucket.delete(value))return this.length--,0===bucket.length&&buckets.delete(hash),!0}return!1},FastSet.prototype.clear=function(){this.buckets.clear(),this.length=0},FastSet.prototype.add=function(value){var hash=this.contentHash(value),buckets=this.buckets;return buckets.has(hash)||buckets.set(hash,new this.Bucket(null,this.contentEquals)),!buckets.get(hash).has(value)&&(buckets.get(hash).add(value),this.length++,!0)},FastSet.prototype.reduce=function(callback,basis){var thisp=arguments[2],buckets=this.buckets,index=0;return buckets.reduce((function(basis,bucket){return bucket.reduce((function(basis,value){return callback.call(thisp,basis,value,index++,this)}),basis,this)}),basis,this)},FastSet.prototype.one=function(){if(this.length>0)return this.buckets.one().one()},FastSet.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()},FastSet.prototype.log=function(charmap,logNode,callback,thisp){charmap=charmap||treeLog.unicodeSharp,logNode=logNode||this.logNode,callback||(callback=console.log,thisp=console),callback=callback.bind(thisp);for(var hash,branch,leader,bucket,buckets=this.buckets,bucketsSize=buckets.size,mapIter=buckets.keys(),index=0;hash=mapIter.next().value;)index===bucketsSize-1?(branch=charmap.fromAbove,leader=" "):0===index?(branch=charmap.branchDown,leader=charmap.strafe):(branch=charmap.fromBoth,leader=charmap.strafe),bucket=buckets.get(hash),callback.call(thisp,branch+charmap.through+charmap.branchDown+" "+hash),bucket.forEach((function(value,node){var branch,below,written;node===bucket.head.prev?(branch=charmap.fromAbove,below=" "):(branch=charmap.fromBoth,below=charmap.strafe),logNode(node,(function(line){written?callback.call(thisp,leader+" "+below+"  "+line):(callback.call(thisp,leader+" "+branch+charmap.through+charmap.through+line),written=!0)}),(function(line){callback.call(thisp,leader+" "+charmap.strafe+"  "+line)}))})),index++},FastSet.prototype.logNode=function(node,write){var value=node.value;Object(value)===value?JSON.stringify(value,null,4).split("\n").forEach((function(line){write(" "+line)})):write(" "+value)};var _set=createCommonjsModule((function(module){var GlobalSet,CollectionsSet;void 0!==commonjsGlobal.Set&&"function"==typeof commonjsGlobal.Set.prototype.values&&((GlobalSet=module.exports=commonjsGlobal.Set).Set=GlobalSet,GlobalSet.prototype.reduce=function(callback,basis){var thisp=arguments[2];return this.forEach((function(value){basis=callback.call(thisp,basis,value,this)})),basis},GlobalSet.prototype.reduceRight=function(callback,basis){for(var value,thisp=arguments[2],setIterator=this.values(),size=this.size,reverseOrder=new Array(this.size),i=size;value=setIterator.next().value;)reverseOrder[--i]=value;for(;i<size;)basis=callback.call(thisp,basis,reverseOrder[i++],this);return basis},GlobalSet.prototype.equals=function(that,equals){var self=this;return that&&"function"==typeof that.reduce&&this.size===(that.size||that.length)&&that.reduce((function(equal,value){return equal&&self.has(value,equals)}),!0)},GlobalSet.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentHash,this.getDefault)},GlobalSet.prototype.toJSON=function(){return this.entriesArray()},GlobalSet.prototype.one=function(){if(this.size>0)return this.values().next().value},GlobalSet.prototype.pop=function(){if(this.size){for(var aValue,value,setIterator=this.values();aValue=setIterator.next().value;)value=aValue;return this.delete(value,this.size-1),value}},GlobalSet.prototype.shift=function(){if(this.size){var firstValue=this.values().next().value;return this.delete(firstValue,0),firstValue}},Object.defineProperty(GlobalSet.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),GlobalSet.from=function(value){var result=new this;return result.addEach(value),result},Object.addEach(GlobalSet.prototype,genericCollection.prototype,!1),Object.addEach(GlobalSet.prototype,genericSet.prototype,!1)),(CollectionsSet=function CollectionsSet(values,equals,hash,getDefault){return CollectionsSet._init(CollectionsSet,this,values,equals,hash,getDefault)})._init=function(constructor,object,values,equals,hash,getDefault){if(!(object instanceof constructor))return new constructor(values,equals,hash,getDefault);equals=equals||Object.equals,hash=hash||Object.hash,getDefault=getDefault||Function.noop,object.contentEquals=equals,object.contentHash=hash,object.getDefault=getDefault,object.order=new object.Order(void 0,equals),object.store=new object.Store(void 0,(function(a,b){return equals(a.value,b.value)}),(function(node){return hash(node.value)})),object.length=0,object.addEach(values)},CollectionsSet.Set=CollectionsSet,CollectionsSet.CollectionsSet=CollectionsSet,Object.addEach(CollectionsSet.prototype,genericCollection.prototype),Object.addEach(CollectionsSet.prototype,genericSet.prototype),CollectionsSet.from=genericCollection.from,Object.defineProperty(CollectionsSet.prototype,"size",genericCollection._sizePropertyDescriptor),CollectionsSet.prototype.Order=_list,CollectionsSet.prototype.Store=_fastSet,CollectionsSet.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentHash,this.getDefault)},CollectionsSet.prototype.has=function(value){var node=new this.order.Node(value);return this.store.has(node)},CollectionsSet.prototype.get=function(value,equals){if(equals)throw new Error("Set#get does not support second argument: equals");var node=new this.order.Node(value);return(node=this.store.get(node))?node.value:this.getDefault(value)},CollectionsSet.prototype.add=function(value){var node=new this.order.Node(value);if(!this.store.has(node)){this.length;return this.order.add(value),node=this.order.head.prev,this.store.add(node),this.length++,!0}return!1},CollectionsSet.prototype.delete=function(value,equals){if(equals)throw new Error("Set#delete does not support second argument: equals");var node=new this.order.Node(value);return!!this.store.has(node)&&(node=this.store.get(node),this.store.delete(node),this.order.splice(node,1),this.length--,!0)},CollectionsSet.prototype.pop=function(){if(this.length){var result=this.order.head.prev.value;return this.delete(result),result}},CollectionsSet.prototype.shift=function(){if(this.length){var result=this.order.head.next.value;return this.delete(result),result}},CollectionsSet.prototype.one=function(){if(this.length>0)return this.store.one().value},CollectionsSet.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(CollectionsSet.prototype,"_clear",{value:CollectionsSet.prototype.clear}),CollectionsSet.prototype.reduce=function(callback,basis){var thisp=arguments[2],list=this.order,index=0;return list.reduce((function(basis,value){return callback.call(thisp,basis,value,index++,this)}),basis,this)},CollectionsSet.prototype.reduceRight=function(callback,basis){var thisp=arguments[2],list=this.order,index=this.length-1;return list.reduceRight((function(basis,value){return callback.call(thisp,basis,value,index--,this)}),basis,this)},CollectionsSet.prototype.iterate=function(){return this.order.iterate()},CollectionsSet.prototype.values=function(){return new iterator(this.valuesArray(),!0)},CollectionsSet.prototype.log=function(){var set=this.store;return set.log.apply(set,arguments)},GlobalSet?(GlobalSet.prototype.valuesArray=genericSet.prototype.valuesArray,GlobalSet.prototype.entriesArray=genericSet.prototype.entriesArray,module.exports=GlobalSet,GlobalSet.CollectionsSet=CollectionsSet):module.exports=CollectionsSet})),_map=createCommonjsModule((function(module){var Map,GlobalMap,CollectionsMap;if(void 0!==commonjsGlobal.Map&&"function"==typeof commonjsGlobal.Set.prototype.values){var map_makeObservable;GlobalMap=Map=module.exports=commonjsGlobal.Map,Map.Map=Map,map_makeObservable={}.__proto__===Object.prototype?function(){this.__proto__=ChangeDispatchMap}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(Map.prototype,"makeObservable",{value:map_makeObservable,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Map.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),Map.prototype.constructClone=function(values){return new this.constructor(values)},Map.prototype.isMap=!0,Map.prototype.addEach=function(values){if(values&&Object(values)===values)if("function"==typeof values.forEach)!0===values.isMap?values.forEach((function(value,key){this.set(key,value)}),this):values.forEach((function(pair){this.set(pair[0],pair[1])}),this);else if("number"==typeof values.length)for(var i=0;i<values.length;i++)this.add(values[i],i);else Object.keys(values).forEach((function(key){this.set(key,values[key])}),this);else if(values&&"number"==typeof values.length)for(i=0;i<values.length;i++)this.add(values[i],i);return this},Map.prototype.add=function(value,key){return this.set(key,value)},Map.prototype.reduce=function(callback,basis){var thisp=arguments[2];return this.forEach((function(value,key,map){basis=callback.call(thisp,basis,value,key,this)})),basis},Map.prototype.reduceRight=function(callback,basis){for(var aKey,thisp=arguments[2],keysIterator=this.keys(),size=this.size,reverseOrder=new Array(this.size),i=0;aKey=keysIterator.next().value;)reverseOrder[--size]=aKey;for(;i++<size;)basis=callback.call(thisp,basis,this.get(reverseOrder[i]),reverseOrder[i],this);return basis},Map.prototype.equals=function(that,equals){return equals=equals||Object.equals,this===that||(that&&"function"==typeof that.every?that.size===this.size&&that.every((function(value,key){return equals(this.get(key),value)}),this):Object.keys(that).length===this.size&&Object.keys(that).every((function(key){return equals(this.get(key),that[key])}),this))};var _keysArrayFunction=function(value,key){return key};Map.prototype.keysArray=function(){return this.map(_keysArrayFunction)};var _valuesArrayFunction=function(value,key){return value};Map.prototype.valuesArray=function(){return this.map(_valuesArrayFunction)};var _entriesArrayFunction=function(value,key){return[key,value]};Map.prototype.entriesArray=function(){return this.map(_entriesArrayFunction)},Map.prototype.toJSON=function(){return this.entriesArray()},Map.prototype.items=function(){return this.entriesArray()},Map.from=function(value){var result=new this;return result.addEach(value),result},Object.defineProperty(Map.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0});var map_clear=Map.prototype.clear,map_set=Map.prototype.set,map_delete=Map.prototype.delete,observableMapProperties={clear:{value:function(){var keys;this.dispatchesMapChanges&&(this.forEach((function(value,key){this.dispatchBeforeMapChange(key,value)}),this),keys=this.keysArray()),map_clear.call(this),this.dispatchesMapChanges&&keys.forEach((function(key){this.dispatchMapChange(key)}),this)},writable:!0,configurable:!0},set:{value:function(key,value){var found=this.get(key);return found?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,found),map_set.call(this,key,value),this.dispatchesMapChanges&&this.dispatchMapChange(key,value)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,void 0),map_set.call(this,key,value),this.dispatchesMapChanges&&this.dispatchMapChange(key,value)),this},writable:!0,configurable:!0},delete:{value:function(key){return!!this.has(key)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(key,this.get(key)),map_delete.call(this,key),this.dispatchesMapChanges&&this.dispatchMapChange(key,void 0),!0)}}};Object.addEach(Map.prototype,genericCollection.prototype,!1);var ChangeDispatchMap=Object.create(Map.prototype,observableMapProperties)}var Set=_set.CollectionsSet;CollectionsMap=Map=function Map(values,equals,hash,getDefault){if(!(this instanceof Map))return new Map(values,equals,hash,getDefault);equals=equals||Object.equals,hash=hash||Object.hash,getDefault=getDefault||Function.noop,this.contentEquals=equals,this.contentHash=hash,this.getDefault=getDefault,this.store=new Set(void 0,(function(a,b){return equals(a.key,b.key)}),(function(item){return hash(item.key)})),this.length=0,this.addEach(values)},Map.Map=Map,Object.addEach(Map.prototype,genericCollection.prototype),Object.addEach(Map.prototype,genericMap.prototype),Object.defineProperty(Map.prototype,"size",genericCollection._sizePropertyDescriptor),Map.from=genericCollection.from,Map.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentHash,this.getDefault)},Map.prototype.log=function(charmap,logNode,callback,thisp){logNode=logNode||this.logNode,this.store.log(charmap,(function(node,log,logBefore){logNode(node.value.value,log,logBefore)}),callback,thisp)},Map.prototype.logNode=function(node,log){log(" key: "+node.key),log(" value: "+node.value)},GlobalMap?(module.exports=GlobalMap,GlobalMap.CollectionsMap=CollectionsMap):module.exports=CollectionsMap})),changeDescriptor=createCommonjsModule((function(module){var ObjectChangeDescriptor=module.exports.ObjectChangeDescriptor=function(name){return this.name=name,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(ObjectChangeDescriptor.prototype,{name:{value:null,writable:!0},isActive:{value:!1,writable:!0},_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new this.willChangeListenersRecordConstructor(this.name))}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new this.changeListenersRecordConstructor(this.name))}},changeListenersRecordConstructor:{value:ChangeListenersRecord,writable:!0},willChangeListenersRecordConstructor:{value:WillChangeListenersRecord,writable:!0}});var ListenerGhost=module.exports.ListenerGhost=Object.create(null),ChangeListenerSpecificHandlerMethodName=new _map;function ChangeListenersRecord(name){var specificHandlerMethodName=ChangeListenerSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name,specificHandlerMethodName+="Change",ChangeListenerSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this._current=null,this._current=null,this.specificHandlerMethodName=specificHandlerMethodName,this}module.exports.ChangeListenersRecord=ChangeListenersRecord,Object.defineProperties(ChangeListenersRecord.prototype,{_current:{value:null,writable:!0},current:{get:function(){return this._current},set:function(value){this._current=value}},ListenerGhost:{value:ListenerGhost,writable:!0},ghostCount:{value:0,writable:!0},maxListenerGhostRatio:{value:.3,writable:!0},listenerGhostFilter:{value:function(value){return value!==this.ListenerGhost}},removeCurrentGostListenersIfNeeded:{value:function(){return this._current&&this.ghostCount/this._current.length>this.maxListenerGhostRatio&&(this.ghostCount=0,this._current=this._current.filter(this.listenerGhostFilter,this)),this._current}},dispatchBeforeChange:{value:!1,writable:!0},genericHandlerMethodName:{value:"handlePropertyChange",writable:!0}}),module.exports.WillChangeListenersRecord=WillChangeListenersRecord;var WillChangeListenerSpecificHandlerMethodName=new _map;function WillChangeListenersRecord(name){var specificHandlerMethodName=WillChangeListenerSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name,specificHandlerMethodName+="WillChange",WillChangeListenerSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this.specificHandlerMethodName=specificHandlerMethodName,this}WillChangeListenersRecord.prototype=new ChangeListenersRecord,WillChangeListenersRecord.prototype.constructor=WillChangeListenersRecord,WillChangeListenersRecord.prototype.genericHandlerMethodName="handlePropertyWillChange"})),propertyChanges=(changeDescriptor.ObjectChangeDescriptor,changeDescriptor.ListenerGhost,changeDescriptor.ChangeListenersRecord,changeDescriptor.WillChangeListenersRecord,PropertyChanges);function PropertyChanges(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}var ObjectChangeDescriptor=changeDescriptor.ObjectChangeDescriptor,ListenerGhost=changeDescriptor.ListenerGhost;PropertyChanges.debug=!0;var ObjectsPropertyChangeListeners=new weakMap$1,ObjectChangeDescriptorName=new _map;function dispatchEach(listeners,key,value,object){if(listeners&&listeners._current){var current,listener,i,countI,thisp,specificHandlerMethodName=listeners.specificHandlerMethodName,genericHandlerMethodName=listeners.genericHandlerMethodName,Ghost=ListenerGhost;if(Array.isArray(listeners._current)){for(i=0,countI=(current=listeners.removeCurrentGostListenersIfNeeded()).length;i<countI;i++)if((thisp=current[i])!==Ghost){if(!(listener=thisp[specificHandlerMethodName]||thisp[genericHandlerMethodName]||thisp).call)throw new Error("No event listener for "+listeners.specificHandlerName+" or "+listeners.genericHandlerName+" or call on "+listener);listener.call(thisp,value,key,object)}}else{if(!(listener=(thisp=listeners._current)[specificHandlerMethodName]||thisp[genericHandlerMethodName]||thisp).call)throw new Error("No event listener for "+listeners.specificHandlerName+" or "+listeners.genericHandlerName+" or call on "+listener);listener.call(thisp,value,key,object)}}}PropertyChanges.ObjectChangeDescriptor=function(){},PropertyChanges.prototype.getOwnPropertyChangeDescriptor=function(key){var keyChangeDescriptor,objectPropertyChangeDescriptors=ObjectsPropertyChangeListeners.get(this);if(objectPropertyChangeDescriptors||(objectPropertyChangeDescriptors=Object.create(null),ObjectsPropertyChangeListeners.set(this,objectPropertyChangeDescriptors)),void 0===(keyChangeDescriptor=objectPropertyChangeDescriptors[key])){var propertyName=ObjectChangeDescriptorName.get(key);return propertyName||(propertyName=(propertyName=String(key))&&propertyName[0].toUpperCase()+propertyName.slice(1),ObjectChangeDescriptorName.set(key,propertyName)),objectPropertyChangeDescriptors[key]=new ObjectChangeDescriptor(propertyName)}return keyChangeDescriptor},PropertyChanges.prototype.hasOwnPropertyChangeDescriptor=function(key){var objectPropertyChangeDescriptors=ObjectsPropertyChangeListeners.get(this);return!!objectPropertyChangeDescriptors&&(!key||void 0!==objectPropertyChangeDescriptors[key])},PropertyChanges.prototype.addOwnPropertyChangeListener=function(key,listener,beforeChange){this.makeObservable&&!this.isObservable&&this.makeObservable();var descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key),listeners=beforeChange?descriptor.willChangeListeners:descriptor.changeListeners;PropertyChanges.makePropertyObservable(this,key),listeners._current?Array.isArray(listeners._current)?listeners._current.push(listener):listeners._current=[listeners._current,listener]:listeners._current=listener;var self=this;return function(){PropertyChanges.removeOwnPropertyChangeListener(self,key,listener,beforeChange),self=null}},PropertyChanges.prototype.addBeforeOwnPropertyChangeListener=function(key,listener){return PropertyChanges.addOwnPropertyChangeListener(this,key,listener,!0)},PropertyChanges.prototype.removeOwnPropertyChangeListener=function removeOwnPropertyChangeListener(key,listener,beforeChange){var listeners,descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key);if((listeners=beforeChange?descriptor._willChangeListeners:descriptor._changeListeners)&&listeners._current)if(listeners._current===listener)listeners._current=null;else{var index=listeners._current.lastIndexOf(listener);if(-1===index)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(key));descriptor.isActive?(listeners.ghostCount=listeners.ghostCount+1,listeners._current[index]=removeOwnPropertyChangeListener.ListenerGhost):listeners._current.spliceOne(index)}},PropertyChanges.prototype.removeOwnPropertyChangeListener.ListenerGhost=ListenerGhost,PropertyChanges.prototype.removeBeforeOwnPropertyChangeListener=function(key,listener){return PropertyChanges.removeOwnPropertyChangeListener(this,key,listener,!0)},PropertyChanges.prototype.dispatchOwnPropertyChange=function dispatchOwnPropertyChange(key,value,beforeChange){var listeners,descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key);if(!descriptor.isActive){descriptor.isActive=!0,listeners=beforeChange?descriptor._willChangeListeners:descriptor._changeListeners;try{dispatchOwnPropertyChange.dispatchEach(listeners,key,value,this)}finally{descriptor.isActive=!1}}},PropertyChanges.prototype.dispatchOwnPropertyChange.dispatchEach=dispatchEach,dispatchEach.ListenerGhost=ListenerGhost,PropertyChanges.prototype.dispatchBeforeOwnPropertyChange=function(key,listener){return PropertyChanges.dispatchOwnPropertyChange(this,key,listener,!0)};var ObjectsOverriddenPropertyDescriptors=new weakMap$1,propertyListener=(new weakMap$1,{get:void 0,set:void 0,configurable:!0,enumerable:!1});PropertyChanges.prototype.makePropertyObservable=function(key){var overriddenPropertyDescriptors=ObjectsOverriddenPropertyDescriptors.get(this);if(!overriddenPropertyDescriptors||void 0===overriddenPropertyDescriptors.get(key)){if(!overriddenPropertyDescriptors){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(key)+" observable on "+this+" because object is not extensible");overriddenPropertyDescriptors=new _map,ObjectsOverriddenPropertyDescriptors.set(this,overriddenPropertyDescriptors)}var overriddenDescriptor,attached=this;do{if(overriddenDescriptor=Object.getOwnPropertyDescriptor(attached,key))break;attached=Object.getPrototypeOf(attached)}while(attached);if(overriddenDescriptor){if(!overriddenDescriptor.configurable)return;if(!overriddenDescriptor.writable&&!overriddenDescriptor.set)return}else overriddenDescriptor={value:void 0,enumerable:!0,writable:!0,configurable:!0};overriddenPropertyDescriptors.set(key,overriddenDescriptor),"value"in overriddenDescriptor?(propertyListener.get=function dispatchingGetter(){return dispatchingGetter.overriddenDescriptor.value},propertyListener.set=function dispatchingSetter(value){var descriptor,isActive,overriddenDescriptor=dispatchingSetter.overriddenDescriptor;if(value!==overriddenDescriptor.value){if(!(isActive=(descriptor=dispatchingSetter.descriptor).isActive)){descriptor.isActive=!0;try{dispatchingSetter.dispatchEach(descriptor._willChangeListeners,dispatchingSetter.key,overriddenDescriptor.value,this)}finally{}}if(overriddenDescriptor.value=value,!isActive)try{dispatchingSetter.dispatchEach(descriptor._changeListeners,dispatchingSetter.key,value,this)}finally{descriptor.isActive=!1}}},propertyListener.set.dispatchEach=dispatchEach,propertyListener.set.key=key,propertyListener.get.overriddenDescriptor=propertyListener.set.overriddenDescriptor=overriddenDescriptor,propertyListener.set.descriptor=ObjectsPropertyChangeListeners.get(this)[key],propertyListener.enumerable=overriddenDescriptor.enumerable,propertyListener.configurable=!0):(propertyListener.get=overriddenDescriptor.get,propertyListener.set=function dispatchingSetter(){var descriptor,isActive,newValue,formerValue=dispatchingSetter.overriddenGetter.call(this);if(1===arguments.length?dispatchingSetter.overriddenSetter.call(this,arguments[0]):2===arguments.length?dispatchingSetter.overriddenSetter.call(this,arguments[0],arguments[1]):dispatchingSetter.overriddenSetter.apply(this,arguments),(newValue=dispatchingSetter.overriddenGetter.call(this))!==formerValue){if(!(isActive=(descriptor=dispatchingSetter.descriptor).isActive)){descriptor.isActive=!0;try{dispatchingSetter.dispatchEach(descriptor._willChangeListeners,key,formerValue,this)}finally{}}if(!isActive)try{dispatchingSetter.dispatchEach(descriptor._changeListeners,key,newValue,this)}finally{descriptor.isActive=!1}}},propertyListener.enumerable=overriddenDescriptor.enumerable,propertyListener.configurable=!0,propertyListener.set.dispatchEach=dispatchEach,propertyListener.set.overriddenSetter=overriddenDescriptor.set,propertyListener.set.overriddenGetter=overriddenDescriptor.get,propertyListener.set.descriptor=ObjectsPropertyChangeListeners.get(this)[key]),Object.defineProperty(this,key,propertyListener)}},PropertyChanges.getOwnPropertyChangeDescriptor=function(object,key){return object.getOwnPropertyChangeDescriptor?object.getOwnPropertyChangeDescriptor(key):PropertyChanges.prototype.getOwnPropertyChangeDescriptor.call(object,key)},PropertyChanges.hasOwnPropertyChangeDescriptor=function(object,key){return object.hasOwnPropertyChangeDescriptor?object.hasOwnPropertyChangeDescriptor(key):PropertyChanges.prototype.hasOwnPropertyChangeDescriptor.call(object,key)},PropertyChanges.addOwnPropertyChangeListener=function(object,key,listener,beforeChange){if(Object.isObject(object))return object.addOwnPropertyChangeListener?object.addOwnPropertyChangeListener(key,listener,beforeChange):this.prototype.addOwnPropertyChangeListener.call(object,key,listener,beforeChange)},PropertyChanges.removeOwnPropertyChangeListener=function(object,key,listener,beforeChange){if(Object.isObject(object))return object.removeOwnPropertyChangeListener?object.removeOwnPropertyChangeListener(key,listener,beforeChange):PropertyChanges.prototype.removeOwnPropertyChangeListener.call(object,key,listener,beforeChange)},PropertyChanges.dispatchOwnPropertyChange=function(object,key,value,beforeChange){if(Object.isObject(object))return object.dispatchOwnPropertyChange?object.dispatchOwnPropertyChange(key,value,beforeChange):PropertyChanges.prototype.dispatchOwnPropertyChange.call(object,key,value,beforeChange)},PropertyChanges.addBeforeOwnPropertyChangeListener=function(object,key,listener){return PropertyChanges.addOwnPropertyChangeListener(object,key,listener,!0)},PropertyChanges.removeBeforeOwnPropertyChangeListener=function(object,key,listener){return PropertyChanges.removeOwnPropertyChangeListener(object,key,listener,!0)},PropertyChanges.dispatchBeforeOwnPropertyChange=function(object,key,value){return PropertyChanges.dispatchOwnPropertyChange(object,key,value,!0)},PropertyChanges.makePropertyObservable=function(object,key){return object.makePropertyObservable?object.makePropertyObservable(key):PropertyChanges.prototype.makePropertyObservable.call(object,key)};var ObjectChangeDescriptor$1=changeDescriptor.ObjectChangeDescriptor,ChangeListenersRecord=changeDescriptor.ChangeListenersRecord,ListenerGhost$1=changeDescriptor.ListenerGhost,rangeChangeDescriptors=new weakMap$1;function RangeChangeDescriptor(name){this.name=name,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}RangeChangeDescriptor.prototype=new ObjectChangeDescriptor$1,RangeChangeDescriptor.prototype.constructor=RangeChangeDescriptor,RangeChangeDescriptor.prototype.changeListenersRecordConstructor=RangeChangeListenersRecord,RangeChangeDescriptor.prototype.willChangeListenersRecordConstructor=RangeWillChangeListenersRecord,Object.defineProperty(RangeChangeDescriptor.prototype,"active",{get:function(){return this._active||(this._active=this._current?this._current.slice():[])}});var RangeChangeListenersSpecificHandlerMethodName=new _map;function RangeChangeListenersRecord(name){var specificHandlerMethodName=RangeChangeListenersSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name.slice(0,1).toUpperCase(),specificHandlerMethodName+=name.slice(1),specificHandlerMethodName+="RangeChange",RangeChangeListenersSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this.specificHandlerMethodName=specificHandlerMethodName,this}RangeChangeListenersRecord.prototype=new ChangeListenersRecord,RangeChangeListenersRecord.prototype.constructor=RangeChangeListenersRecord;var RangeWillChangeListenersSpecificHandlerMethodName=new _map;function RangeWillChangeListenersRecord(name){var specificHandlerMethodName=RangeWillChangeListenersSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name.slice(0,1).toUpperCase(),specificHandlerMethodName+=name.slice(1),specificHandlerMethodName+="RangeWillChange",RangeWillChangeListenersSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this.specificHandlerMethodName=specificHandlerMethodName,this}RangeWillChangeListenersRecord.prototype=new ChangeListenersRecord,RangeWillChangeListenersRecord.prototype.constructor=RangeWillChangeListenersRecord;var rangeChanges=RangeChanges;function RangeChanges(){throw new Error("Can't construct. RangeChanges is a mixin.")}RangeChanges.prototype.getAllRangeChangeDescriptors=function(){return rangeChangeDescriptors.has(this)||rangeChangeDescriptors.set(this,new _map),rangeChangeDescriptors.get(this)},RangeChanges.prototype.getRangeChangeDescriptor=function(token){var tokenChangeDescriptors=this.getAllRangeChangeDescriptors();return token=token||"",tokenChangeDescriptors.has(token)||tokenChangeDescriptors.set(token,new RangeChangeDescriptor(token)),tokenChangeDescriptors.get(token)};var ObjectsDispatchesRangeChanges=new weakMap$1,dispatchesChangesPropertyDescriptor={get:function(){return ObjectsDispatchesRangeChanges.get(this)},set:function(value){return ObjectsDispatchesRangeChanges.set(this,value)},configurable:!0,enumerable:!1};RangeChanges.prototype.addRangeChangeListener=function(listener,token,beforeChange){!this.isObservable&&this.makeObservable&&this.makeObservable();var listeners,descriptor=this.getRangeChangeDescriptor(token);(listeners=beforeChange?descriptor.willChangeListeners:descriptor.changeListeners)._current?Array.isArray(listeners._current)?listeners._current.push(listener):listeners._current=[listeners._current,listener]:listeners._current=listener,void 0===Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),"dispatchesRangeChanges")&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),"dispatchesRangeChanges",dispatchesChangesPropertyDescriptor),this.dispatchesRangeChanges=!0;var self=this;return function(){self&&(self.removeRangeChangeListener(listener,token,beforeChange),self=null)}},RangeChanges.prototype.removeRangeChangeListener=function(listener,token,beforeChange){var listeners,descriptor=this.getRangeChangeDescriptor(token);if((listeners=beforeChange?descriptor._willChangeListeners:descriptor._changeListeners)._current)if(listeners._current===listener)listeners._current=null;else{var index=listeners._current.lastIndexOf(listener);if(-1===index)throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(token));descriptor.isActive?(listeners.ghostCount=listeners.ghostCount+1,listeners._current[index]=ListenerGhost$1):listeners._current.spliceOne(index)}},RangeChanges.prototype.dispatchRangeChange=function(plus,minus,index,beforeChange){var descriptor,listeners,tokenName,i,countI,listener,currentListeners,Ghost,descriptors=this.getAllRangeChangeDescriptors(),mapIter=descriptors.values();for(descriptors.dispatchBeforeChange=beforeChange;descriptor=mapIter.next().value;){if(descriptor.isActive)return;if((listeners=beforeChange?descriptor._willChangeListeners:descriptor._changeListeners)&&listeners._current)if(tokenName=listeners.specificHandlerMethodName,Array.isArray(listeners._current)){if(listeners._current.length){descriptor.isActive=!0;try{for(currentListeners=listeners.removeCurrentGostListenersIfNeeded(),Ghost=ListenerGhost$1,i=0,countI=currentListeners.length;i<countI;i++)if((listener=currentListeners[i])!==Ghost)if(listener[tokenName])listener[tokenName](plus,minus,index,this,beforeChange);else{if(!listener.call)throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable");listener.call(this,plus,minus,index,this,beforeChange)}}finally{descriptor.isActive=!1}}}else{descriptor.isActive=!0;try{if((listener=listeners._current)[tokenName])listener[tokenName](plus,minus,index,this,beforeChange);else{if(!listener.call)throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable");listener.call(this,plus,minus,index,this,beforeChange)}}finally{descriptor.isActive=!1}}}},RangeChanges.prototype.addBeforeRangeChangeListener=function(listener,token){return this.addRangeChangeListener(listener,token,!0)},RangeChanges.prototype.removeBeforeRangeChangeListener=function(listener,token){return this.removeRangeChangeListener(listener,token,!0)},RangeChanges.prototype.dispatchBeforeRangeChange=function(plus,minus,index){return this.dispatchRangeChange(plus,minus,index,!0)};var sortedSet=SortedSet;function SortedSet(values,equals,compare,getDefault){if(!(this instanceof SortedSet))return new SortedSet(values,equals,compare,getDefault);this.contentEquals=equals||Object.equals,this.contentCompare=compare||Object.compare,this.getDefault=getDefault||Function.noop,this.root=null,this.length=0,this.addEach(values)}function Node$1(value){this.value=value,this.left=null,this.right=null,this.length=1}function Iterator$1(set,start,end){if(this.set=set,this.prev=null,this.end=end,start){var next=this.set.findLeastGreaterThanOrEqual(start);next&&(this.set.splay(next.value),this.prev=next.getPrevious())}}SortedSet.SortedSet=SortedSet,Object.addEach(SortedSet.prototype,genericCollection.prototype),Object.addEach(SortedSet.prototype,genericSet.prototype),Object.addEach(SortedSet.prototype,propertyChanges.prototype),Object.addEach(SortedSet.prototype,rangeChanges.prototype),Object.defineProperty(SortedSet.prototype,"size",genericCollection._sizePropertyDescriptor),SortedSet.from=genericCollection.from,SortedSet.prototype.isSorted=!0,SortedSet.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentCompare,this.getDefault)},SortedSet.prototype.has=function(value,equals){if(equals)throw new Error("SortedSet#has does not support second argument: equals");return!!this.root&&(this.splay(value),this.contentEquals(value,this.root.value))},SortedSet.prototype.get=function(value,equals){if(equals)throw new Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(value),this.contentEquals(value,this.root.value))?this.root.value:this.getDefault(value)},SortedSet.prototype.add=function(value){var node=new this.Node(value);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([value],[],0),this.root=node,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([value],[],0),!0;if(this.splay(value),!this.contentEquals(value,this.root.value)){var comparison=this.contentCompare(value,this.root.value);if(0===comparison)throw new Error("SortedSet cannot contain incomparable but inequal values: "+value+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([value],[],this.root.index),comparison<0?(node.right=this.root,node.left=this.root.left,this.root.left=null,this.root.touch()):(node.left=this.root,node.right=this.root.right,this.root.right=null,this.root.touch()),node.touch(),this.root=node,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([value],[],this.root.index),!0}return!1},SortedSet.prototype.delete=function(value,equals){if(equals)throw new Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(value),this.contentEquals(value,this.root.value))){var index=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[value],index),this.root.left){var right=this.root.right;this.root=this.root.left,this.splay(value),this.root.right=right}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[value],index),!0}return!1},SortedSet.prototype.indexOf=function(value,index){if(index)throw new Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(value),this.contentEquals(value,this.root.value))?this.root.index:-1},SortedSet.prototype.find=function(value,equals,index){if(equals)throw new Error("SortedSet#find does not support second argument: equals");if(index)throw new Error("SortedSet#find does not support third argument: index");if(this.root&&(this.splay(value),this.contentEquals(value,this.root.value)))return this.root},SortedSet.prototype.findGreatest=function(at){if(this.root){for(at=at||this.root;at.right;)at=at.right;return at}},SortedSet.prototype.findLeast=function(at){if(this.root){for(at=at||this.root;at.left;)at=at.left;return at}},SortedSet.prototype.findGreatestLessThanOrEqual=function(value){if(this.root)return this.splay(value),this.contentCompare(this.root.value,value)>0?this.root.getPrevious():this.root},SortedSet.prototype.findGreatestLessThan=function(value){if(this.root)return this.splay(value),this.contentCompare(this.root.value,value)>=0?this.root.getPrevious():this.root},SortedSet.prototype.findLeastGreaterThanOrEqual=function(value){if(this.root)return this.splay(value),this.contentCompare(this.root.value,value)>=0?this.root:this.root.getNext()},SortedSet.prototype.findLeastGreaterThan=function(value){if(this.root)return this.splay(value),this.contentCompare(this.root.value,value)<=0?this.root.getNext():this.root},SortedSet.prototype.pop=function(){if(this.root){var found=this.findGreatest();return this.delete(found.value),found.value}},SortedSet.prototype.shift=function(){if(this.root){var found=this.findLeast();return this.delete(found.value),found.value}},SortedSet.prototype.push=function(){this.addEach(arguments)},SortedSet.prototype.unshift=function(){this.addEach(arguments)},SortedSet.prototype.slice=function(start,end){start=start||0,end=end||this.length,start<0&&(start+=this.length),end<0&&(end+=this.length);var sliced=[];if(this.root)for(this.splayIndex(start);this.root.index<end&&(sliced.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return sliced},SortedSet.prototype.splice=function(at,length){return this.swap(at,length,Array.prototype.slice.call(arguments,2))},SortedSet.prototype.swap=function(start,length,plus){if(void 0===start&&void 0===length)return[];(start=start||0)<0&&(start+=this.length),void 0===length&&(length=1/0);var swapped=[];if(this.root){this.splayIndex(start);for(var i=0;i<length;i++){swapped.push(this.root.value);var next=this.root.getNext();if(this.delete(this.root.value),!next)break;this.splay(next.value)}}return this.addEach(plus),swapped},SortedSet.prototype.splay=function(value){var stub,left,right,temp,root,history;if(this.root){for(stub=left=right=new this.Node,history=new this.Node,root=this.root;;){var comparison=this.contentCompare(value,root.value);if(comparison<0){if(!root.left)break;if(this.contentCompare(value,root.left.value)<0&&(temp=root.left,root.left=temp.right,root.touch(),temp.right=root,temp.touch(),!(root=temp).left))break;(temp=new Node$1).right=root,temp.left=history.left,history.left=temp,right.left=root,right.touch(),right=root,root=root.left}else{if(!(comparison>0))break;if(!root.right)break;if(this.contentCompare(value,root.right.value)>0&&(temp=root.right,root.right=temp.left,root.touch(),temp.left=root,temp.touch(),!(root=temp).right))break;(temp=new Node$1).left=root,temp.right=history.right,history.right=temp,left.right=root,left.touch(),left=root,root=root.right}}for(left.right=root.left,left.touch(),right.left=root.right,right.touch(),root.left=stub.right,root.right=stub.left;history.left;)history.left.right.touch(),history.left=history.left.left;for(;history.right;)history.right.left.touch(),history.right=history.right.right;root.touch(),this.root=root}},SortedSet.prototype.splayIndex=function(index){if(this.root){for(var at=this.root,atIndex=this.root.index;atIndex!==index;)if(atIndex>index&&at.left)atIndex-=1+((at=at.left).right?at.right.length:0);else{if(!(atIndex<index&&at.right))break;atIndex+=1+((at=at.right).left?at.left.length:0)}return this.splay(at.value),this.root.index===index}return!1},SortedSet.prototype.reduce=function(callback,basis,thisp){return this.root&&(basis=this.root.reduce(callback,basis,0,thisp,this)),basis},SortedSet.prototype.reduceRight=function(callback,basis,thisp){return this.root&&(basis=this.root.reduceRight(callback,basis,this.length-1,thisp,this)),basis},SortedSet.prototype.min=function(at){var least=this.findLeast(at);if(least)return least.value},SortedSet.prototype.max=function(at){var greatest=this.findGreatest(at);if(greatest)return greatest.value},SortedSet.prototype.one=function(){return this.min()},SortedSet.prototype.clear=function(){var minus;this.dispatchesRangeChanges&&(minus=this.toArray(),this.dispatchBeforeRangeChange([],minus,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],minus,0)},SortedSet.prototype.iterate=function(start,end){return new this.Iterator(this,start,end)},SortedSet.prototype.Iterator=Iterator$1,SortedSet.prototype.summary=function(){return this.root?this.root.summary():"()"},SortedSet.prototype.log=function(charmap,logNode,callback,thisp){charmap=charmap||treeLog.unicodeRound,logNode=logNode||this.logNode,callback||(callback=console.log,thisp=console),callback=callback.bind(thisp),this.root&&this.root.log(charmap,logNode,callback,callback)},SortedSet.prototype.logNode=function(node,log,logBefore){log(" "+node.value)},SortedSet.logCharsets=treeLog,SortedSet.prototype.Node=Node$1,Node$1.prototype.reduce=function(callback,basis,index,thisp,tree,depth){if(depth=depth||0,this.left){var length=this.left.length;basis=this.left.reduce(callback,basis,index,thisp,tree,depth+1),index+=length}return basis=callback.call(thisp,basis,this.value,index,tree,this,depth),index+=1,this.right&&(basis=this.right.reduce(callback,basis,index,thisp,tree,depth+1)),basis},Node$1.prototype.reduceRight=function(callback,basis,index,thisp,tree,depth){return depth=depth||0,this.right&&(basis=this.right.reduceRight(callback,basis,index,thisp,tree,depth+1),index-=this.right.length),basis=callback.call(thisp,basis,this.value,this.value,tree,this,depth),index-=1,this.left&&(basis=this.left.reduceRight(callback,basis,index,thisp,tree,depth+1)),basis},Node$1.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},Node$1.prototype.checkIntegrity=function(){var length=1;if(length+=this.left?this.left.checkIntegrity():0,length+=this.right?this.right.checkIntegrity():0,this.length!==length)throw new Error("Integrity check failed: "+this.summary());return length},Node$1.prototype.getNext=function(){var node=this;if(node.right){for(node=node.right;node.left;)node=node.left;return node}},Node$1.prototype.getPrevious=function(){var node=this;if(node.left){for(node=node.left;node.right;)node=node.right;return node}},Node$1.prototype.summary=function(){var value=this.value||"-";return value+=" <"+this.length,this.left||this.right?"("+value+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+value+")"},Node$1.prototype.log=function(charmap,logNode,log,logAbove){var branch,loggedAbove,loggedOn,loggedBelow,self=this;branch=this.left&&this.right?charmap.intersection:this.left?charmap.branchUp:this.right?charmap.branchDown:charmap.through,this.left&&this.left.log(charmap,logNode,(function(line){loggedAbove?logAbove(charmap.strafe+" "+line):(loggedAbove=!0,logAbove(charmap.fromBelow+charmap.through+line))}),(function(line){logAbove("  "+line)})),logNode(this,(function(line){loggedOn?log((self.right?charmap.strafe:" ")+line):(loggedOn=!0,log(branch+line))}),(function(line){logAbove((self.left?charmap.strafe:" ")+line)})),this.right&&this.right.log(charmap,logNode,(function(line){loggedBelow?log("  "+line):(loggedBelow=!0,log(charmap.fromAbove+charmap.through+line))}),(function(line){log(charmap.strafe+" "+line)}))},Iterator$1.prototype.__iterationObject=null,Object.defineProperty(Iterator$1.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Iterator$1.prototype.next=function(){var next;return(next=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast())?void 0!==this.end&&this.set.contentCompare(next.value,this.end)>=0?(this._iterationObject.done=!0,this._iterationObject.value=void 0):(this.prev=next,this._iterationObject.value=next.value):(this._iterationObject.done=!0,this._iterationObject.value=void 0),this._iterationObject};var util={radians:function(degrees){return degrees/(180/Math.PI)},degrees:function(radians){return radians*(180/Math.PI)},REarth:6371,WGS84:{a:6378.137,b:6356.752314245,f:1/298.257223563},consoleColors:{bright:"[1m",dim:"[2m",underscore:"[4m",blink:"[5m",reverse:"[7m",hidden:"[8m",fg:{black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",crimson:"[38m"},bg:{black:"[40m",red:"[41m",green:"[42m",yellow:"[43m",blue:"[44m",magenta:"[45m",cyan:"[46m",white:"[47m",crimson:"[48m"},reset:"[0m"}};var vincentys={inverse:function(p1,p2){const φ1=util.radians(p1.y),λ1=util.radians(p1.x),φ2=util.radians(p2.y),λ2=util.radians(p2.x),{a:a,b:b,f:f}=util.WGS84,L=λ2-λ1,tanU1=(1-f)*Math.tan(φ1),cosU1=1/Math.sqrt(1+tanU1*tanU1),sinU1=tanU1*cosU1,tanU2=(1-f)*Math.tan(φ2),cosU2=1/Math.sqrt(1+tanU2*tanU2),sinU2=tanU2*cosU2,antipodal=Math.abs(L)>Math.PI/2||Math.abs(φ2-φ1)>Math.PI/2;let λ=L,sinλ=null,cosλ=null,σ=antipodal?Math.PI:0,sinσ=0,cosσ=antipodal?-1:1,sinSqσ=null,cos2σₘ=1,sinα=null,cosSqα=1,C=null,λʹ=null,iterations=0;do{if(sinλ=Math.sin(λ),cosλ=Math.cos(λ),sinSqσ=cosU2*sinλ*(cosU2*sinλ)+(cosU1*sinU2-sinU1*cosU2*cosλ)*(cosU1*sinU2-sinU1*cosU2*cosλ),Math.abs(sinSqσ)<Number.EPSILON)break;sinσ=Math.sqrt(sinSqσ),cosσ=sinU1*sinU2+cosU1*cosU2*cosλ,σ=Math.atan2(sinσ,cosσ),sinα=cosU1*cosU2*sinλ/sinσ,cosSqα=1-sinα*sinα,cos2σₘ=0!=cosSqα?cosσ-2*sinU1*sinU2/cosSqα:0,C=f/16*cosSqα*(4+f*(4-3*cosSqα)),λʹ=λ,λ=L+(1-C)*f*sinα*(σ+C*sinσ*(cos2σₘ+C*cosσ*(2*cos2σₘ*cos2σₘ-1)));if((antipodal?Math.abs(λ)-Math.PI:Math.abs(λ))>Math.PI)throw new EvalError("λ > π")}while(Math.abs(λ-λʹ)>1e-7&&++iterations<1e3);if(iterations>=1e3)throw new EvalError("Vincenty formula failed to converge");const uSq=cosSqα*(a*a-b*b)/(b*b),B=uSq/1024*(256+uSq*(uSq*(74-47*uSq)-128)),s=b*(1+uSq/16384*(4096+uSq*(uSq*(320-175*uSq)-768)))*(σ-B*sinσ*(cos2σₘ+B/4*(cosσ*(2*cos2σₘ*cos2σₘ-1)-B/6*cos2σₘ*(4*sinσ*sinσ-3)*(4*cos2σₘ*cos2σₘ-3)))),α1=Math.abs(sinSqσ)<Number.EPSILON?0:Math.atan2(cosU2*sinλ,cosU1*sinU2-sinU1*cosU2*cosλ),α2=Math.abs(sinSqσ)<Number.EPSILON?Math.PI:Math.atan2(cosU1*sinλ,-sinU1*cosU2+cosU1*sinU2*cosλ);return{distance:s,initialBearing:Math.abs(s)<Number.EPSILON?NaN:util.degrees(α1),finalBearing:Math.abs(s)<Number.EPSILON?NaN:util.degrees(α2),iterations:iterations}}};class Point{constructor(x,y){Array.isArray(x)?[this.x,this.y,this.r]=[x[y].longitude,x[y].latitude,y]:[this.x,this.y]=[x,y]}geojson(id,properties){return{type:"Feature",id:id,properties:properties||{},geometry:{type:"Point",coordinates:[this.x,this.y]}}}toString(){return JSON.stringify(this.geojson())}intersects(other){if(other instanceof Point)return this.x==other.x&&this.y==other.y;if(other instanceof Box)return other.intersects(this);throw"other must be either Point or Box"}distanceEarth(p){return this.distanceEarthFCC(p)}distanceEarthFCC(p){const df=p.y-this.y,dg=p.x-this.x,fm=util.radians((this.y+p.y)/2),k1=111.13209-.566605*Math.cos(2*fm)+.0012*Math.cos(4*fm),k2=111.41513*Math.cos(fm)-.09455*Math.cos(3*fm)+12e-5*Math.cos(5*fm);return Math.sqrt(k1*df*(k1*df)+k2*dg*(k2*dg))}distanceEarthRev(dx,dy){const lon=this.x+util.degrees(dx/util.REarth/Math.cos(util.radians(this.y))),lat=this.y+util.degrees(dy/util.REarth);return new Point(lon,lat)}distanceEarthVincentys(p){return vincentys.inverse(this,p).distance}}class Range{constructor(a,b){[this.a,this.b]=[a,b]}count(){return Math.abs(this.a-this.b)+1}center(){return Math.min(this.a,this.b)+Math.floor(Math.abs(this.a-this.b)/2)}left(){return new Range(Math.min(this.a,this.b),Math.min(this.a,this.b)+Math.floor(Math.abs(this.a-this.b)/2))}right(){return new Range(Math.min(this.a,this.b)+Math.ceil(Math.abs(this.a-this.b)/2),Math.max(this.a,this.b))}contains(p){return this.a<=p&&p<=this.b}toString(){return`${this.a}:${this.b}`}}class Box{constructor(a,b,c,d){if(a instanceof Range){[this.x1,this.y1,this.x2,this.y2]=[1/0,1/0,-1/0,-1/0];for(let i=a.a;i<=a.b;i++)this.x1=Math.min(b.flightPoints[i].x,this.x1),this.y1=Math.min(b.flightPoints[i].y,this.y1),this.x2=Math.max(b.flightPoints[i].x,this.x2),this.y2=Math.max(b.flightPoints[i].y,this.y2)}else[this.x1,this.y1,this.x2,this.y2]=[a,b,c,d]}vertices(){return[new Point(this.x1,this.y1),new Point(this.x2,this.y1),new Point(this.x2,this.y2),new Point(this.x1,this.y2)]}intersects(other){return other instanceof Point?this.x1<=other.x&&this.y1<=other.y&&this.x2>=other.x&&this.y2>=other.y:!(this.x1>other.x2||this.x2<other.x1||this.y1>other.y2||this.y2<other.y1)}area(){return Math.abs(this.x2-this.x1)*Math.abs(this.y2-this.y1)}distance(other){if(this.intersects(other))return 0;let x1,y1,x2,y2;return this.x1>other.x2&&(x1=this.x1),x2=other.x2,this.x2<other.x1&&(x1=this.x2),x2=other.x1,this.y1<other.y2&&(y1=this.y1),y2=other.y2,this.y2>other.y1&&(y1=this.y2),y2=other.y1,void 0===x1&&(x1=this.x1,x2=this.x1),void 0===y1&&(y1=this.y1,y2=this.y1),new Point(x1,y1).distanceEarth(new Point(x2,y2))}geojson(id,properties){return{type:"Feature",id:id,properties:properties||{},geometry:{type:"Polygon",coordinates:[[[this.x1,this.y1],[this.x1,this.y2],[this.x2,this.y2],[this.x2,this.y1],[this.x1,this.y1]]]}}}geojson_collection(boxes){let features=[];for(let b in boxes)features.push(boxes[b].geojson(b,{id:b}));return{type:"FeatureCollection",features:features}}toString(){return JSON.stringify(this.geojson())}}var foundation={Point:Point,Range:Range,Box:Box};let id=0;const{Box:Box$1,Point:Point$1,Range:Range$1}=foundation;class Solution{constructor(ranges,opt,parent){ranges.length>opt.scoring.cardinality?this.ranges=ranges.slice(0,opt.scoring.cardinality):this.ranges=ranges,this.opt=opt;for(let _r in this.ranges){const r=parseInt(_r);if(r>0&&this.ranges[r-1].a>this.ranges[r].a&&(this.ranges[r]=new Range$1(Math.max(this.ranges[r-1].a,this.ranges[r].a),this.ranges[r].b)),r<this.ranges.length-1&&this.ranges[r].b>this.ranges[r+1].b&&(this.ranges[r]=new Range$1(this.ranges[r].a,Math.min(this.ranges[r+1].b,this.ranges[r].b))),this.ranges[r].a>this.ranges[r].b)throw console.log(this.ranges,parent.ranges),"error"}this.boxes=[];for(let r in this.ranges)this.boxes[r]=new Box$1(this.ranges[r],opt.flight);this.score=void 0,this.bound=void 0,this.id=id++,this.opt.config&&this.opt.config.debug&&(this.parent=parent,this.trace())}do_branch(){let div=0;for(let r in this.ranges)this.ranges[r].count()>this.ranges[div].count()&&(div=parseInt(r));for(let r in this.ranges)this.ranges[r].count()>1&&this.boxes[r].area()>8*this.boxes[div].area()&&(div=parseInt(r));if(1==this.ranges[div].count())return[];let subsolutions=[];for(let i of[this.ranges[div].left(),this.ranges[div].right()]){let subranges=[];for(let r in this.ranges)subranges[r]=r!=div?this.ranges[r]:i;subsolutions.push(new Solution(subranges,this.opt,this))}return subsolutions}do_bound(){this.bound=this.opt.scoring.bound(this.ranges,this.boxes,this.opt),this.trace()}do_score(){for(let r in this.ranges)if(r<this.ranges.length-1&&this.ranges[r].center()>=this.ranges[parseInt(r)+1].center())return void(this.score=0);let tp=[];for(let r in this.ranges)tp[r]=new Point$1(this.opt.flight.filtered,this.ranges[r].center());this.scoreInfo=this.opt.scoring.score(tp,this.opt),this.score=this.scoreInfo.score,this.trace()}contentEquals(self,other){return self.id===other.id}contentCompare(self,other){return self.bound<other.bound?-1:self.bound>other.bound?1:self.id<other.id?-1:self.id>other.id?1:0}geojson(){let features=[];if(this.opt.config&&this.opt.config.debug)for(let r in this.ranges)features.push(new Box$1(this.ranges[r],this.opt.flight).geojson("box"+r,{id:"box"+r,area:new Box$1(this.ranges[r],this.opt.flight).area(),a:this.ranges[r].a,b:this.ranges[r].b}));try{const tp=this.scoreInfo.tp;for(let r of[0,1,2])features.push(tp[r].geojson("tp"+r,{id:"tp"+r,r:tp[r].r,timestamp:this.opt.flight.filtered[tp[r].r].timestamp})),(r<2||this.scoreInfo.cp)&&features.push({type:"Feature",id:"seg"+r,properties:{id:"seg"+r,stroke:"yellow","stroke-width":4,d:tp[r].distanceEarth(tp[(r+1)%3])},geometry:{type:"LineString",coordinates:[[tp[r].x,tp[r].y],[tp[(r+1)%3].x,tp[(r+1)%3].y]],style:{stroke:"yellow","stroke-width":4}}})}catch(e){}try{if(void 0!==this.scoreInfo.ep||void 0!==this.scoreInfo.cp){const cp=this.scoreInfo.cp,tp=this.scoreInfo.tp,ep=this.scoreInfo.ep;if(cp&&cp.in&&cp.out){for(let r of["in","out"])features.push(cp[r].geojson("cp_"+r,{id:"cp_"+r,r:cp[r].r,timestamp:this.opt.flight.filtered[cp[r].r].timestamp}));features.push({type:"Feature",id:"closing",properties:{id:"closing",stroke:"green","stroke-width":3,d:cp.in.distanceEarth(cp.out)},geometry:{type:"LineString",coordinates:[[cp.in.x,cp.in.y],[cp.out.x,cp.out.y]],style:{stroke:"green","stroke-width":3}}})}if(ep&&ep.start&&ep.finish){for(let r of["start","finish"])features.push(ep[r].geojson("ep_"+r,{id:"ep_"+r,r:ep[r].r,timestamp:this.opt.flight.filtered[ep[r].r].timestamp}));features.push({type:"Feature",id:"seg_in",properties:{id:"seg_in",stroke:"gold","stroke-width":3,d:ep.start.distanceEarth(tp[0])},geometry:{type:"LineString",coordinates:[[ep.start.x,ep.start.y],[tp[0].x,tp[0].y]],style:{stroke:"green","stroke-width":3}}}),features.push({type:"Feature",id:"seg_out",properties:{id:"seg_out",stroke:"gold","stroke-width":3,d:ep.finish.distanceEarth(tp[2])},geometry:{type:"LineString",coordinates:[[tp[2].x,tp[2].y],[ep.finish.x,ep.finish.y]],style:{stroke:"green","stroke-width":3}}})}}}catch(e){}for(let li in this.opt.flight.ll){const l=this.opt.flight.ll[li];features.push(this.opt.flight.flightPoints[l.launch].geojson("launch"+li,{id:"launch"+li,r:l.launch,timestamp:this.opt.flight.filtered[l.launch].timestamp})),features.push(this.opt.flight.flightPoints[l.landing].geojson("land"+li,{id:"land"+li,r:l.landing,timestamp:this.opt.flight.filtered[l.landing].timestamp}))}if(!this.opt.config||!this.opt.config.noflight){let flightData=[];for(let r of this.opt.flight.filtered)flightData.push([r.longitude,r.latitude]);features.push({type:"Feature",id:"flight",properties:{id:"flight"},geometry:{type:"LineString",coordinates:flightData}})}return{type:"FeatureCollection",properties:{name:"EPSG:3857",id:this.id,score:void 0!==this.score?this.score:void 0,bound:void 0!==this.currentUpperBound?this.currentUpperBound:this.bound,optimal:this.optimal,processedTime:this.time/1e3,processedSolutions:this.processed,type:this.opt.scoring.name,code:this.opt.scoring.code},features:features}}toString(){let s=""+this.opt.scoring.name;if(this.score&&(s+=` ${this.opt.scoring.rounding(this.score)} points`),this.scoreInfo&&(s+=` ${this.opt.scoring.rounding(this.scoreInfo.distance)}km`),s+=` ( <${this.bound.toFixed(4)} )`,this.opt.config&&this.opt.config.debug){s+=` { id: ${this.id} `;for(let r of this.ranges)s+=" "+r.toString();s+=" } "}return s}trace(msg){if(!this.opt.config.trace||!process.stdout)return;const trace=this.opt.config.trace.split(",");if(trace[0]<0){if(this.id%parseInt(trace[1])!=0)return}else for(let i in this.ranges)if(!this.ranges[i].contains(trace[i]))return;let r=`${msg||""} solution tracing: ${this.id} ${this.opt.scoring.name} `;for(let i in this.ranges)r+=this.ranges[i]+" ";this.bound&&(r+=`bound: ${this.bound} `),this.score&&(r+=`score: ${this.score} `),process.stdout.write("\n"+r+"\n"),this.opt.config.env.fs.writeFileSync(`debug-${this.id}.json`,JSON.stringify(this.geojson({debug:!0})))}}var solution_Solution=Solution,ObjectChangeDescriptor$2=changeDescriptor.ObjectChangeDescriptor,ChangeListenersRecord$1=changeDescriptor.ChangeListenersRecord,ListenerGhost$2=changeDescriptor.ListenerGhost,mapChanges=MapChanges;function MapChanges(){throw new Error("Can't construct. MapChanges is a mixin.")}var mapChangeDescriptors=new weakMap$1;function MapChangeDescriptor(name){this.name=name,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}MapChangeDescriptor.prototype=new ObjectChangeDescriptor$2,MapChangeDescriptor.prototype.constructor=MapChangeDescriptor,MapChangeDescriptor.prototype.changeListenersRecordConstructor=MapChangeListenersRecord,MapChangeDescriptor.prototype.willChangeListenersRecordConstructor=MapWillChangeListenersRecord;var MapChangeListenersSpecificHandlerMethodName=new _map;function MapChangeListenersRecord(name){var specificHandlerMethodName=MapChangeListenersSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name.slice(0,1).toUpperCase(),specificHandlerMethodName+=name.slice(1),specificHandlerMethodName+="MapChange",MapChangeListenersSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this.specificHandlerMethodName=specificHandlerMethodName,this}MapChangeListenersRecord.prototype=new ChangeListenersRecord$1,MapChangeListenersRecord.prototype.constructor=MapChangeListenersRecord,MapChangeListenersRecord.prototype.genericHandlerMethodName="handleMapChange";var MapWillChangeListenersSpecificHandlerMethodName=new _map;function MapWillChangeListenersRecord(name){var specificHandlerMethodName=MapWillChangeListenersSpecificHandlerMethodName.get(name);return specificHandlerMethodName||(specificHandlerMethodName="handle",specificHandlerMethodName+=name.slice(0,1).toUpperCase(),specificHandlerMethodName+=name.slice(1),specificHandlerMethodName+="MapWillChange",MapWillChangeListenersSpecificHandlerMethodName.set(name,specificHandlerMethodName)),this.specificHandlerMethodName=specificHandlerMethodName,this}MapWillChangeListenersRecord.prototype=new ChangeListenersRecord$1,MapWillChangeListenersRecord.prototype.constructor=MapWillChangeListenersRecord,MapWillChangeListenersRecord.prototype.genericHandlerMethodName="handleMapWillChange",MapChanges.prototype.getAllMapChangeDescriptors=function(){return mapChangeDescriptors.has(this)||mapChangeDescriptors.set(this,new _map),mapChangeDescriptors.get(this)},MapChanges.prototype.getMapChangeDescriptor=function(token){var tokenChangeDescriptors=this.getAllMapChangeDescriptors();return token=token||"",tokenChangeDescriptors.has(token)||tokenChangeDescriptors.set(token,new MapChangeDescriptor(token)),tokenChangeDescriptors.get(token)};var ObjectsDispatchesMapChanges=new weakMap$1,dispatchesChangesPropertyDescriptor$1={get:function(){return ObjectsDispatchesMapChanges.get(this)},set:function(value){return ObjectsDispatchesMapChanges.set(this,value)},configurable:!0,enumerable:!1};MapChanges.prototype.addMapChangeListener=function(listener,token,beforeChange){!this.isObservable&&this.makeObservable&&this.makeObservable();var listeners,descriptor=this.getMapChangeDescriptor(token);(listeners=beforeChange?descriptor.willChangeListeners:descriptor.changeListeners)._current?Array.isArray(listeners._current)?listeners._current.push(listener):listeners._current=[listeners._current,listener]:listeners._current=listener,void 0===Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),"dispatchesMapChanges")&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),"dispatchesMapChanges",dispatchesChangesPropertyDescriptor$1),this.dispatchesMapChanges=!0;var self=this;return function(){self&&(self.removeMapChangeListener(listener,token,beforeChange),self=null)}},MapChanges.prototype.removeMapChangeListener=function(listener,token,beforeChange){var listeners,descriptor=this.getMapChangeDescriptor(token);if((listeners=beforeChange?descriptor.willChangeListeners:descriptor.changeListeners)._current)if(listeners._current===listener)listeners._current=null;else{var index=listeners._current.lastIndexOf(listener);if(-1===index)throw new Error("Can't remove map change listener: does not exist: token "+JSON.stringify(token));descriptor.isActive?(listeners.ghostCount=listeners.ghostCount+1,listeners._current[index]=ListenerGhost$2):listeners._current.spliceOne(index)}},MapChanges.prototype.dispatchMapChange=function(key,value,beforeChange){var descriptors=this.getAllMapChangeDescriptors(),Ghost=ListenerGhost$2;descriptors.forEach((function(descriptor,token){if(!descriptor.isActive){var listeners=beforeChange?descriptor.willChangeListeners:descriptor.changeListeners;if(listeners&&listeners._current){var tokenName=listeners.specificHandlerMethodName;if(Array.isArray(listeners._current)){if(listeners._current.length){var i,countI,listener,currentListeners=listeners.removeCurrentGostListenersIfNeeded();descriptor.isActive=!0;try{for(i=0,countI=currentListeners.length;i<countI;i++)if((listener=currentListeners[i])!==Ghost)if(listener[tokenName])listener[tokenName](value,key,this);else{if(!listener.call)throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable");listener.call(listener,value,key,this)}}finally{descriptor.isActive=!1}}}else{descriptor.isActive=!0;try{if((listener=listeners._current)[tokenName])listener[tokenName](value,key,this);else{if(!listener.call)throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable");listener.call(listener,value,key,this)}}finally{descriptor.isActive=!1}}}}}),this)},MapChanges.prototype.addBeforeMapChangeListener=function(listener,token){return this.addMapChangeListener(listener,token,!0)},MapChanges.prototype.removeBeforeMapChangeListener=function(listener,token){return this.removeMapChangeListener(listener,token,!0)},MapChanges.prototype.dispatchBeforeMapChange=function(key,value){return this.dispatchMapChange(key,value,!0)};var map=_map;void 0===commonjsGlobal.Map||"function"!=typeof commonjsGlobal.Set.prototype.values?(Object.addEach(_map.prototype,propertyChanges.prototype),Object.addEach(_map.prototype,mapChanges.prototype)):(Object.defineEach(_map.prototype,propertyChanges.prototype,!1,!0,!1,!0),Object.defineEach(_map.prototype,mapChanges.prototype,!1,!0,!1,!0));class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(id,value){let pos=this.length++;for(this.ids[pos]=id,this.values[pos]=value;pos>0;){const parent=pos-1>>1,parentValue=this.values[parent];if(value>=parentValue)break;this.ids[pos]=this.ids[parent],this.values[pos]=parentValue,pos=parent}this.ids[pos]=id,this.values[pos]=value}pop(){if(0===this.length)return;const top=this.ids[0];if(this.length--,this.length>0){const id=this.ids[0]=this.ids[this.length],value=this.values[0]=this.values[this.length],halfLength=this.length>>1;let pos=0;for(;pos<halfLength;){let left=1+(pos<<1);const right=left+1;let bestIndex=this.ids[left],bestValue=this.values[left];const rightValue=this.values[right];if(right<this.length&&rightValue<bestValue&&(left=right,bestIndex=this.ids[right],bestValue=rightValue),bestValue>=value)break;this.ids[pos]=bestIndex,this.values[pos]=bestValue,pos=left}this.ids[pos]=id,this.values[pos]=value}return top}peek(){return this.ids[0]}peekValue(){return this.values[0]}}const ARRAY_TYPES=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Flatbush{static from(data){if(!(data instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[magic,versionAndType]=new Uint8Array(data,0,2);if(251!==magic)throw new Error("Data does not appear to be in a Flatbush format.");if(versionAndType>>4!=3)throw new Error(`Got v${versionAndType>>4} data when expected v3.`);const[nodeSize]=new Uint16Array(data,2,1),[numItems]=new Uint32Array(data,4,1);return new Flatbush(numItems,nodeSize,ARRAY_TYPES[15&versionAndType],data)}constructor(numItems,nodeSize=16,ArrayType=Float64Array,data){if(void 0===numItems)throw new Error("Missing required argument: numItems.");if(isNaN(numItems)||numItems<=0)throw new Error(`Unpexpected numItems value: ${numItems}.`);this.numItems=+numItems,this.nodeSize=Math.min(Math.max(+nodeSize,2),65535);let n=numItems,numNodes=n;this._levelBounds=[4*n];do{n=Math.ceil(n/this.nodeSize),numNodes+=n,this._levelBounds.push(4*numNodes)}while(1!==n);this.ArrayType=ArrayType||Float64Array,this.IndexArrayType=numNodes<16384?Uint16Array:Uint32Array;const arrayTypeIndex=ARRAY_TYPES.indexOf(this.ArrayType),nodesByteSize=4*numNodes*this.ArrayType.BYTES_PER_ELEMENT;if(arrayTypeIndex<0)throw new Error(`Unexpected typed array class: ${ArrayType}.`);data&&data instanceof ArrayBuffer?(this.data=data,this._boxes=new this.ArrayType(this.data,8,4*numNodes),this._indices=new this.IndexArrayType(this.data,8+nodesByteSize,numNodes),this._pos=4*numNodes,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+nodesByteSize+numNodes*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*numNodes),this._indices=new this.IndexArrayType(this.data,8+nodesByteSize,numNodes),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+arrayTypeIndex]),new Uint16Array(this.data,2,1)[0]=nodeSize,new Uint32Array(this.data,4,1)[0]=numItems),this._queue=new FlatQueue}add(minX,minY,maxX,maxY){const index=this._pos>>2;return this._indices[index]=index,this._boxes[this._pos++]=minX,this._boxes[this._pos++]=minY,this._boxes[this._pos++]=maxX,this._boxes[this._pos++]=maxY,minX<this.minX&&(this.minX=minX),minY<this.minY&&(this.minY=minY),maxX>this.maxX&&(this.maxX=maxX),maxY>this.maxY&&(this.maxY=maxY),index}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize)return this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,void(this._boxes[this._pos++]=this.maxY);const width=this.maxX-this.minX,height=this.maxY-this.minY,hilbertValues=new Uint32Array(this.numItems);for(let i=0;i<this.numItems;i++){let pos=4*i;const minX=this._boxes[pos++],minY=this._boxes[pos++],maxX=this._boxes[pos++],maxY=this._boxes[pos++],x=Math.floor(65535*((minX+maxX)/2-this.minX)/width),y=Math.floor(65535*((minY+maxY)/2-this.minY)/height);hilbertValues[i]=hilbert(x,y)}!function sort(values,boxes,indices,left,right,nodeSize){if(Math.floor(left/nodeSize)>=Math.floor(right/nodeSize))return;const pivot=values[left+right>>1];let i=left-1,j=right+1;for(;;){do{i++}while(values[i]<pivot);do{j--}while(values[j]>pivot);if(i>=j)break;swap(values,boxes,indices,i,j)}sort(values,boxes,indices,left,j,nodeSize),sort(values,boxes,indices,j+1,right,nodeSize)}(hilbertValues,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,pos=0;i<this._levelBounds.length-1;i++){const end=this._levelBounds[i];for(;pos<end;){const nodeIndex=pos;let nodeMinX=1/0,nodeMinY=1/0,nodeMaxX=-1/0,nodeMaxY=-1/0;for(let i=0;i<this.nodeSize&&pos<end;i++)nodeMinX=Math.min(nodeMinX,this._boxes[pos++]),nodeMinY=Math.min(nodeMinY,this._boxes[pos++]),nodeMaxX=Math.max(nodeMaxX,this._boxes[pos++]),nodeMaxY=Math.max(nodeMaxY,this._boxes[pos++]);this._indices[this._pos>>2]=nodeIndex,this._boxes[this._pos++]=nodeMinX,this._boxes[this._pos++]=nodeMinY,this._boxes[this._pos++]=nodeMaxX,this._boxes[this._pos++]=nodeMaxY}}}search(minX,minY,maxX,maxY,filterFn){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let nodeIndex=this._boxes.length-4;const queue=[],results=[];for(;void 0!==nodeIndex;){const end=Math.min(nodeIndex+4*this.nodeSize,upperBound(nodeIndex,this._levelBounds));for(let pos=nodeIndex;pos<end;pos+=4){const index=0|this._indices[pos>>2];maxX<this._boxes[pos]||(maxY<this._boxes[pos+1]||minX>this._boxes[pos+2]||minY>this._boxes[pos+3]||(nodeIndex<4*this.numItems?(void 0===filterFn||filterFn(index))&&results.push(index):queue.push(index)))}nodeIndex=queue.pop()}return results}neighbors(x,y,maxResults=1/0,maxDistance=1/0,filterFn){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let nodeIndex=this._boxes.length-4;const q=this._queue,results=[],maxDistSquared=maxDistance*maxDistance;for(;void 0!==nodeIndex;){const end=Math.min(nodeIndex+4*this.nodeSize,upperBound(nodeIndex,this._levelBounds));for(let pos=nodeIndex;pos<end;pos+=4){const index=0|this._indices[pos>>2],dx=axisDist(x,this._boxes[pos],this._boxes[pos+2]),dy=axisDist(y,this._boxes[pos+1],this._boxes[pos+3]),dist=dx*dx+dy*dy;nodeIndex<4*this.numItems?(void 0===filterFn||filterFn(index))&&q.push(-index-1,dist):q.push(index,dist)}for(;q.length&&q.peek()<0;){if(q.peekValue()>maxDistSquared)return q.clear(),results;if(results.push(-q.pop()-1),results.length===maxResults)return q.clear(),results}nodeIndex=q.pop()}return q.clear(),results}}function axisDist(k,min,max){return k<min?min-k:k<=max?0:k-max}function upperBound(value,arr){let i=0,j=arr.length-1;for(;i<j;){const m=i+j>>1;arr[m]>value?j=m:i=m+1}return arr[i]}function swap(values,boxes,indices,i,j){const temp=values[i];values[i]=values[j],values[j]=temp;const k=4*i,m=4*j,a=boxes[k],b=boxes[k+1],c=boxes[k+2],d=boxes[k+3];boxes[k]=boxes[m],boxes[k+1]=boxes[m+1],boxes[k+2]=boxes[m+2],boxes[k+3]=boxes[m+3],boxes[m]=a,boxes[m+1]=b,boxes[m+2]=c,boxes[m+3]=d;const e=indices[i];indices[i]=indices[j],indices[j]=e}function hilbert(x,y){let a=x^y,b=65535^a,c=65535^(x|y),d=x&(65535^y),A=a|b>>1,B=a>>1^a,C=c>>1^b&d>>1^c,D=a&c>>1^d>>1^d;a=A,b=B,c=C,d=D,A=a&a>>2^b&b>>2,B=a&b>>2^b&(a^b)>>2,C^=a&c>>2^b&d>>2,D^=b&c>>2^(a^b)&d>>2,a=A,b=B,c=C,d=D,A=a&a>>4^b&b>>4,B=a&b>>4^b&(a^b)>>4,C^=a&c>>4^b&d>>4,D^=b&c>>4^(a^b)&d>>4,a=A,b=B,c=C,d=D,C^=a&c>>8^b&d>>8,D^=b&c>>8^(a^b)&d>>8,a=C^C>>1,b=D^D>>1;let i0=x^y,i1=b|65535^(i0|a);return i0=16711935&(i0|i0<<8),i0=252645135&(i0|i0<<4),i0=858993459&(i0|i0<<2),i0=1431655765&(i0|i0<<1),i1=16711935&(i1|i1<<8),i1=252645135&(i1|i1<<4),i1=858993459&(i1|i1<<2),i1=1431655765&(i1|i1<<1),(i1<<1|i0)>>>0}var flatbush=Object.freeze({__proto__:null,default:Flatbush});function quickselect(arr,k,left,right,compare){!function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap$1(arr,left,k),compare(arr[right],t)>0&&swap$1(arr,left,right);i<j;){for(swap$1(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap$1(arr,left,j):swap$1(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function swap$1(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(let i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(let i=k;i<p;i++){const child=node.children[i];extend(destNode,node.leaf?toBBox(child):child)}return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function intersectionArea(a,b){const minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){const stack=[left,right];for(;stack.length;){if((right=stack.pop())-(left=stack.pop())<=n)continue;const mid=left+Math.ceil((right-left)/n/2)*n;quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right)}}var rbush=Object.freeze({__proto__:null,default:class{constructor(maxEntries=9){this._maxEntries=Math.max(4,maxEntries),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(bbox){let node=this.data;const result=[];if(!intersects(bbox,node))return result;const toBBox=this.toBBox,nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?toBBox(child):child;intersects(bbox,childBBox)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child))}node=nodesToSearch.pop()}return result}collides(bbox){let node=this.data;if(!intersects(bbox,node))return!1;const nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?this.toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}}node=nodesToSearch.pop()}return!1}load(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(let i=0;i<data.length;i++)this.insert(data[i]);return this}let node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){const tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this}insert(item){return item&&this._insert(item,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(item,equalsFn){if(!item)return this;let node=this.data;const bbox=this.toBBox(item),path=[],indexes=[];let i,parent,goingUp;for(;node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf){const index=findItem(item,node.children,equalsFn);if(-1!==index)return node.children.splice(index,1),path.push(node),this._condense(path),this}goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this}toBBox(item){return item}compareMinX(a,b){return a.minX-b.minX}compareMinY(a,b){return a.minY-b.minY}toJSON(){return this.data}fromJSON(data){return this.data=data,this}_all(node,result){const nodesToSearch=[];for(;node;)node.leaf?result.push(...node.children):nodesToSearch.push(...node.children),node=nodesToSearch.pop();return result}_build(items,left,right,height){const N=right-left+1;let node,M=this._maxEntries;if(N<=M)return node=createNode(items.slice(left,right+1)),calcBBox(node,this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),node=createNode([]),node.leaf=!1,node.height=height;const N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));multiSelect(items,left,right,N1,this.compareMinX);for(let i=left;i<=right;i+=N1){const right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(let j=i;j<=right2;j+=N2){const right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1))}}return calcBBox(node,this.toBBox),node}_chooseSubtree(bbox,node,level,path){for(;path.push(node),!node.leaf&&path.length-1!==level;){let targetNode,minArea=1/0,minEnlargement=1/0;for(let i=0;i<node.children.length;i++){const child=node.children[i],area=bboxArea(child),enlargement=(a=bbox,b=child,(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))-area);enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child)}node=targetNode||node.children[0]}var a,b;return node}_insert(item,level,isNode){const bbox=isNode?item:this.toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)}_split(insertPath,level){const node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);const splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)}_splitRoot(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(node,m,M){let index,minOverlap=1/0,minArea=1/0;for(let i=m;i<=M-m;i++){const bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),overlap=intersectionArea(bbox1,bbox2),area=bboxArea(bbox1)+bboxArea(bbox2);overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i)}return index||M-m}_chooseSplitAxis(node,m,M){const compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)}_allDistMargin(node,m,M,compare){node.children.sort(compare);const toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox);let margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(let i=m;i<M-m;i++){const child=node.children[i];extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox)}for(let i=M-m-1;i>=m;i--){const child=node.children[i];extend(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox)}return margin}_adjustParentBBoxes(bbox,path,level){for(let i=level;i>=0;i--)extend(path[i],bbox)}_condense(path){for(let siblings,i=path.length-1;i>=0;i--)0===path[i].children.length?i>0?(siblings=path[i-1].children,siblings.splice(siblings.indexOf(path[i]),1)):this.clear():calcBBox(path[i],this.toBBox)}}}),_Flatbush=getCjsExportFromNamespace(flatbush),RBush$1=getCjsExportFromNamespace(rbush);const Flatbush$1=_Flatbush.default?_Flatbush.default:_Flatbush,{Box:Box$2,Point:Point$2}=foundation;var geom={maxDistance3Rectangles:function(boxes,distance_fn){let minx,miny,maxx,maxy,vertices=[];for(let r of[0,1,2])vertices[r]=boxes[r].vertices(),minx=Math.min(minx||1/0,boxes[r].x1),miny=Math.min(miny||1/0,boxes[r].y1),maxx=Math.max(maxx||-1/0,boxes[r].x2),maxy=Math.max(maxy||-1/0,boxes[r].y2);let intersecting=!1;for(let i of[0,1,2])if(boxes[i].intersects(boxes[(i+1)%3])){intersecting=!0;break}let path=[[],[],[]];for(let i of[0,1,2]){for(let v of vertices[i])v.x!=minx&&v.x!=maxx||v.y!=miny&&v.y!=maxy||path[i].push(v);if(0==path[i].length)for(let v of vertices[i])v.x!=minx&&v.x!=maxx&&v.y!=miny&&v.y!=maxy||path[i].push(v);(0==path[i].length||intersecting)&&(path[i]=vertices[i])}let distanceMax=0;for(let i of path[0])for(let j of path[1])for(let k of path[2]){const distance=distance_fn(i,j,k);distanceMax=Math.max(distanceMax,distance)}return distanceMax},maxDistance2Rectangles:function(boxes){let minx,miny,maxx,maxy,vertices=[];for(let r of[0,1])vertices[r]=boxes[r].vertices(),minx=Math.min(minx||1/0,boxes[r].x1),miny=Math.min(miny||1/0,boxes[r].y1),maxx=Math.max(maxx||-1/0,boxes[r].x2),maxy=Math.max(maxy||-1/0,boxes[r].y2);let path=[[],[]];for(let i of[0,1])path[i]=vertices[i];let distanceMax=0;for(let i of path[0])for(let j of path[1]){const distance=i.distanceEarth(j);distanceMax=Math.max(distanceMax,distance)}return distanceMax},minDistance3Rectangles:function(boxes,distance_fn){let minx,miny,maxx,maxy,vertices=[];for(let r of[0,1,2])vertices[r]=boxes[r].vertices(),minx=Math.min(minx||1/0,boxes[r].x1),miny=Math.min(miny||1/0,boxes[r].y1),maxx=Math.max(maxx||-1/0,boxes[r].x2),maxy=Math.max(maxy||-1/0,boxes[r].y2);let path=[[],[],[]];for(let i of[0,1,2])path[i]=vertices[i];let distanceMin=1/0;for(let i of path[0])for(let j of path[1])for(let k of path[2]){const distance=distance_fn(i,j,k);distanceMin=Math.min(distanceMin,distance)}return distanceMin},maxDistanceNRectangles:function(boxes){let minx,miny,maxx,maxy,vertices=[],path=[];for(let r in boxes){if(boxes[r]instanceof Box$2)vertices[r]=boxes[r].vertices(),minx=Math.min(minx||1/0,boxes[r].x1),miny=Math.min(miny||1/0,boxes[r].y1),maxx=Math.max(maxx||-1/0,boxes[r].x2),maxy=Math.max(maxy||-1/0,boxes[r].y2);else{if(!(boxes[r]instanceof Point$2))throw new TypeError("boxes must contain only Box or Point");vertices[r]=[boxes[r]],minx=Math.min(minx||1/0,boxes[r].x),miny=Math.min(miny||1/0,boxes[r].y),maxx=Math.max(maxx||-1/0,boxes[r].x),maxy=Math.max(maxy||-1/0,boxes[r].y)}path[r]=[]}for(let i in boxes)if(i>0){boxes[i-1].intersects(boxes[i])&&(boxes[i-1].intersecting=!0,boxes[i].intersecting=!0)}for(let i in boxes)if(boxes[i].intersecting)path[i]=vertices[i];else{for(let v of vertices[i])v.x!=minx&&v.x!=maxx||v.y!=miny&&v.y!=maxy||path[i].push(v);if(0==path[i].length)for(let v of vertices[i])v.x!=minx&&v.x!=maxx&&v.y!=miny&&v.y!=maxy||path[i].push(v);0==path[i].length&&(path[i]=vertices[i])}return function maxDistancePath(origin,path,pathStart){let distanceMax=0;for(let i of path[pathStart]){const distance1=void 0!==origin?i.distanceEarth(origin):0,distance2=path.length>pathStart+1?maxDistancePath(i,path,pathStart+1):0;distanceMax=Math.max(distanceMax,distance1+distance2)}return distanceMax}(void 0,path,0)},findFurthestPointInSegment:function(sega,segb,target,opt){let points,pos,zSearch;if(target instanceof Box$2)points=target.vertices();else{if(!(target instanceof Point$2))throw new TypeError("target must be either Point or Box");points=[target]}if(sega===opt.launch)pos=0,zSearch=+segb;else{if(segb!==opt.landing)throw new RangeError("this function supports seeking only from the launch or the landing point");pos=1,zSearch=+sega}let fpoint,distanceMax=-1/0;for(let v of points){let fVpoint,precomputed,distanceVMax=-1/0;const precomputedAll=opt.flight.furthestPoints[pos].get(v.x+":"+v.y);for(const p of precomputedAll||[])if(zSearch>=p.min&&zSearch<=p.max){precomputed=p;break}if(precomputed){if(!(sega<=precomputed.o.r&&precomputed.o.r<=segb))throw new Error("furthestPoints cache inconsistency");distanceVMax=v.distanceEarth(precomputed.o),fVpoint=precomputed.o}if(void 0===fVpoint){let intersecting=!1,canCache=!1;for(let p=sega;p<=segb;p++){const f=opt.flight.flightPoints[p];if(target instanceof Box$2&&target.intersects(f)){intersecting=!0;continue}const d=v.distanceEarth(f);d>distanceVMax&&(distanceVMax=d,fVpoint=f,canCache=!0)}if(intersecting)for(let p of points){const d=v.distanceEarth(p);d>distanceVMax&&(distanceVMax=d,fVpoint=target,canCache=!1)}if(canCache){let zCache;sega===opt.launch?zCache={min:+fVpoint.r,max:+segb}:segb===opt.landing&&(zCache={min:+sega,max:+fVpoint.r});let c=precomputedAll;c||(c=[],opt.flight.furthestPoints[pos].set(v.x+":"+v.y,c));const existing=c.filter(x=>x.o.r==fVpoint.r&&!(zCache.max<=x.min||zCache.min>=x.max))[0];existing?(existing.min=Math.min(zCache.min,existing.min),existing.max=Math.max(zCache.max,existing.max)):c.push({...zCache,o:fVpoint})}}distanceVMax>distanceMax&&(distanceMax=distanceVMax,fpoint=fVpoint)}return void 0===fpoint&&(fpoint=target),fpoint},isTriangleClosed:function(p1,p2,distance,opt){const fastCandidates=opt.flight.closestPairs.search({minX:opt.launch,minY:p2,maxX:p1,maxY:opt.landing});for(let f of fastCandidates)if(f.o.d<=opt.scoring.closingDistanceFree)return f.o;const min=function(p1,p2,opt){let precomputedAll=opt.flight.closestPairs.search({minX:p1,minY:p2,maxX:p1,maxY:p2}),precomputed=precomputedAll.reduce((a,x)=>!a||x.in>a.in?x:a,void 0);if(precomputed=precomputedAll.reduce((a,x)=>!a||x.out<a.out?x:a,precomputed),void 0!==precomputed)return precomputed.o;const rtree=new Flatbush$1(p1+1-opt.launch,8),lc=Math.abs(Math.cos(util.radians(opt.flight.flightPoints[p1].y)));for(let i=opt.launch;i<=p1;i++){const r=opt.flight.flightPoints[i];rtree.add(r.x*lc,r.y,r.x*lc,r.y)}rtree.finish(),precomputedAll=opt.flight.closestPairs.search({minX:p1,minY:p2,maxX:p1,maxY:opt.landing});const precomputedNext=precomputedAll.reduce((a,x)=>!a||x.out<a.out?x:a,void 0),lastUnknown=void 0!==precomputedNext?precomputedNext.maxY:opt.landing;let min={d:1/0};for(let i=p2;i<lastUnknown;i++){const pout=opt.flight.flightPoints[i],n=rtree.neighbors(pout.x*lc,pout.y,1)[0]+opt.launch;if(void 0!==n){const pin=opt.flight.flightPoints[n],d=pout.distanceEarth(pin);d<min.d&&(min.d=d,min.out=pout,min.in=pin)}}if(void 0!==precomputedNext){const pout=precomputedNext.o.out,pin=precomputedNext.o.in,d=pout.distanceEarth(pin);d<min.d&&(min.d=d,min.out=pout,min.in=pin)}return opt.flight.closestPairs.insert({minX:min.in.r,minY:p2,maxX:p1,maxY:min.out.r,o:min}),min}(p1,p2,opt);return min.d<=opt.scoring.closingDistance(distance,opt)&&min},init:function(opt){opt.flight.closestPairs=new RBush$1,opt.flight.furthestPoints=[new map,new map],opt.flight.flightPoints=new Array(opt.flight.filtered.length);for(let r in opt.flight.filtered)opt.flight.flightPoints[r]=new Point$2(opt.flight.filtered,r)}};const definitionFlight_t=60,definitionFlight_x0=1.5,definitionFlight_xt=5,definitionFlight_z0=.05,definitionFlight_zt=.9,definitionGround_t=20,definitionGround_xmax=2.5,definitionGround_zmax=.1,Point$3=foundation.Point;var flight={analyze:function(flight,config){if(config.invalid?flight.filtered=flight.fixes.slice(0):flight.filtered=flight.fixes.filter(x=>x.valid).filter((x,i,a)=>0==i||a[i-1].timestamp!==x.timestamp),flight.filtered.length<5)throw new Error(`Flight must contain at least 5 valid GPS fixes, ${flight.filtered.length} valid fixes found (out of ${flight.fixes.length})`);config.trim||config.detectLaunch||config.detectLanding?(!function(fixes){for(let i in fixes)(null===fixes[i].pressureAltitude||void 0===fixes[i].pressureAltitude||fixes[i].pressureAltitude<-1e3)&&(fixes[i].pressureAltitude=fixes[i].gpsAltitude),null===fixes[i].pressureAltitude&&(fixes[i].gpsAltitude=void 0),i>0?fixes[i].timestamp!==fixes[i-1].timestamp?(fixes[i].hspeed=1e3*new Point$3(fixes,i-1).distanceEarth(new Point$3(fixes,i))/(fixes[i].timestamp-fixes[i-1].timestamp)*1e3,fixes[i].vspeed=(fixes[i].pressureAltitude-fixes[i-1].pressureAltitude)/(fixes[i].timestamp-fixes[i-1].timestamp)*1e3):(fixes[i].hspeed=fixes[i-1].hspeed,fixes[i].vspeed=fixes[i-1].vspeed):(fixes[i].hspeed=0,fixes[i].vspeed=0);for(let _i in fixes){const i=parseInt(_i),now=fixes[i].timestamp;let start,end;for(start=i;start>0&&fixes[start].timestamp>now-Math.round(5e3);start--);for(end=i;end<fixes.length-1&&fixes[end].timestamp<now+Math.round(5e3);end++);const maSegment=fixes.slice(start,end+1);fixes[i].hma=maSegment.reduce((sum,x)=>sum+x.hspeed,0)/maSegment.length,fixes[i].vma=maSegment.reduce((sum,x)=>sum+Math.abs(x.vspeed),0)/maSegment.length}}(flight.filtered),function(fixes){let start;for(let i=0;i<fixes.length-1;i++)if(void 0===start&&fixes[i].hma>definitionFlight_xt&&fixes[i].vma>definitionFlight_zt&&(start=i),void 0!==start)if(fixes[i].hma>definitionFlight_x0&&fixes[i].vma>definitionFlight_z0){if(fixes[i].timestamp>fixes[start].timestamp+1e3*definitionFlight_t)for(let j=start;j<=i;j++)fixes[i].stateFlight=!0}else start=void 0}(flight.filtered),function(fixes){let start;for(let i=0;i<fixes.length-1;i++)if(void 0===start&&fixes[i].hma<definitionGround_xmax&&fixes[i].vma<definitionGround_zmax&&(start=i),void 0!==start)if(fixes[i].hma<definitionGround_xmax&&fixes[i].vma<definitionGround_zmax){if(fixes[i].timestamp>fixes[start].timestamp+1e3*definitionGround_t)for(let j=start;j<=i;j++)fixes[i].stateGround=!0}else start=void 0}(flight.filtered),flight.ll=function(fixes){let ll=[];for(let i=0;i<fixes.length-1;i++)if(fixes[i].stateFlight){let j;for(j=i;j>0&&!fixes[j].stateGround;j--);const launch=j;for(j=i;j<fixes.length-2&&!fixes[j].stateGround;j++);const landing=j;i=j,ll.push({launch:launch,landing:landing})}return 0==ll.length&&ll.push({launch:0,landing:fixes.length-1}),ll}(flight.filtered)):flight.ll=[{launch:0,landing:flight.filtered.length-1}]}};function closingPenalty(cd,opt){return cd>(opt.scoring.closingDistanceFree||0)?cd:0}function maxFAIDistance(maxTriDistance,boxes,opt){const minTriDistance=geom.minDistance3Rectangles(boxes,(i,j,k)=>i.distanceEarth(j)+j.distanceEarth(k)+k.distanceEarth(i)),maxAB=geom.maxDistance2Rectangles([boxes[0],boxes[1]]),maxBC=geom.maxDistance2Rectangles([boxes[1],boxes[2]]),maxCA=geom.maxDistance2Rectangles([boxes[2],boxes[0]]),maxDistance=Math.min(maxAB/opt.scoring.minSide,maxBC/opt.scoring.minSide,maxCA/opt.scoring.minSide,maxTriDistance);return maxDistance<minTriDistance?0:maxDistance}var scoring={closingWithLimit:function(distance,opt){return Math.max(opt.scoring.closingDistanceFixed||0,distance*(opt.scoring.closingDistanceRelative||0))},closingWithPenalty:function(distance,opt){return 1/0},boundTriangle:function(ranges,boxes,opt){const maxTriDistance=geom.maxDistance3Rectangles(boxes,(i,j,k)=>i.distanceEarth(j)+j.distanceEarth(k)+k.distanceEarth(i)),maxDistance=void 0!==opt.scoring.minSide?maxFAIDistance(maxTriDistance,boxes,opt):maxTriDistance;if(0===maxDistance)return 0;let cp={d:0};return ranges[0].b<ranges[2].a?(cp=geom.isTriangleClosed(ranges[0].b,ranges[2].a,maxDistance,opt),cp?(maxDistance-closingPenalty(cp.d,opt))*opt.scoring.multiplier:0):maxDistance*opt.scoring.multiplier},scoreTriangle:function(tp,opt){const d0=tp[0].distanceEarth(tp[1]),d1=tp[1].distanceEarth(tp[2]),d2=tp[2].distanceEarth(tp[0]),distance=d0+d1+d2;if(void 0!==opt.scoring.minSide){const minSide=opt.scoring.minSide*distance;if(d0<minSide||d1<minSide||d2<minSide)return{score:0}}let cp=geom.isTriangleClosed(tp[0].r,tp[2].r,distance,opt);return cp?{distance:distance,score:(distance-closingPenalty(cp.d,opt))*opt.scoring.multiplier,tp:tp,cp:cp}:{score:0}},boundDistance3Points:function(ranges,boxes,opt){const pin=geom.findFurthestPointInSegment(opt.launch,ranges[0].a,boxes[0],opt),pout=geom.findFurthestPointInSegment(ranges[2].b,opt.landing,boxes[2],opt);return geom.maxDistanceNRectangles([pin,boxes[0],boxes[1],boxes[2],pout])*opt.scoring.multiplier},scoreDistance3Points:function(tp,opt){let distance=0;const pin=geom.findFurthestPointInSegment(opt.launch,tp[0].r,tp[0],opt),pout=geom.findFurthestPointInSegment(tp[2].r,opt.landing,tp[2],opt),all=[pin,tp[0],tp[1],tp[2],pout];for(let i of[0,1,2,3])distance+=all[i].distanceEarth(all[i+1]);return{distance:distance,score:distance*opt.scoring.multiplier,tp:tp,ep:{start:pin,finish:pout}}},boundOpenTriangle:function(ranges,boxes,opt){const pin=geom.findFurthestPointInSegment(opt.launch,ranges[0].a,boxes[0],opt),pout=geom.findFurthestPointInSegment(ranges[2].b,opt.landing,boxes[2],opt),maxD3PDistance=geom.maxDistanceNRectangles([pin,boxes[0],boxes[1],boxes[2],pout]),maxTriDistance=geom.maxDistance3Rectangles(boxes,(i,j,k)=>i.distanceEarth(j)+j.distanceEarth(k)+k.distanceEarth(i));if(void 0!==opt.scoring.minSide&&0===maxFAIDistance(maxTriDistance,boxes,opt))return 0;let cp={d:0};return ranges[0].b<ranges[2].a?(cp=geom.isTriangleClosed(ranges[0].b,ranges[2].a,maxTriDistance,opt),cp?(maxD3PDistance-closingPenalty(cp.d,opt))*opt.scoring.multiplier:0):maxD3PDistance*opt.scoring.multiplier},scoreOpenTriangle:function(tp,opt){const d0=tp[0].distanceEarth(tp[1]),d1=tp[1].distanceEarth(tp[2]),d2=tp[2].distanceEarth(tp[0]),triDistance=d0+d1+d2;if(void 0!==opt.scoring.minSide){const minSide=opt.scoring.minSide*triDistance;if(d0<minSide||d1<minSide||d2<minSide)return{score:0}}let cp=geom.isTriangleClosed(tp[0].r,tp[2].r,triDistance,opt);if(!cp)return{score:0};let d3pDistance=0;const pin=geom.findFurthestPointInSegment(opt.launch,tp[0].r,tp[0],opt),pout=geom.findFurthestPointInSegment(tp[2].r,opt.landing,tp[2],opt),all=[pin,tp[0],tp[1],tp[2],pout];for(let i of[0,1,2,3])d3pDistance+=all[i].distanceEarth(all[i+1]);return{distance:d3pDistance,score:d3pDistance*opt.scoring.multiplier-closingPenalty(cp.d,opt),tp:tp,ep:{start:pin,finish:pout},cp:cp}}};function round2(score){return parseFloat(parseFloat(score).toFixed(2))}var scoringRules_config={FFVL:[{name:"Distance 3 points",multiplier:1,bound:scoring.boundDistance3Points,score:scoring.scoreDistance3Points,rounding:round2,cardinality:3,code:"od"},{name:"Triangle plat",multiplier:1.2,bound:scoring.boundTriangle,score:scoring.scoreTriangle,closingDistance:scoring.closingWithLimit,closingDistanceFixed:3,closingDistanceFree:3,closingDistanceRelative:.05,rounding:round2,cardinality:3,code:"tri"},{name:"Triangle FAI",multiplier:1.4,bound:scoring.boundTriangle,score:scoring.scoreTriangle,minSide:.28,closingDistance:scoring.closingWithLimit,closingDistanceFixed:3,closingDistanceFree:3,closingDistanceRelative:.05,rounding:round2,cardinality:3,code:"fai"}],XContest:[{name:"Free flight",multiplier:1,bound:scoring.boundDistance3Points,score:scoring.scoreDistance3Points,rounding:round2,cardinality:3,code:"od"},{name:"Free triangle",multiplier:1.2,bound:scoring.boundTriangle,score:scoring.scoreTriangle,closingDistance:scoring.closingWithLimit,closingDistanceRelative:.2,rounding:round2,cardinality:3,code:"tri"},{name:"FAI triangle",multiplier:1.4,bound:scoring.boundTriangle,score:scoring.scoreTriangle,minSide:.28,closingDistance:scoring.closingWithLimit,closingDistanceRelative:.2,rounding:round2,cardinality:3,code:"fai"},{name:"Closed free triangle",multiplier:1.4,bound:scoring.boundTriangle,score:scoring.scoreTriangle,closingDistance:scoring.closingWithLimit,closingDistanceFixed:0,closingDistanceFree:0,closingDistanceRelative:.05,rounding:round2,cardinality:3,code:"tri"},{name:"Closed FAI triangle",multiplier:1.6,bound:scoring.boundTriangle,score:scoring.scoreTriangle,minSide:.28,closingDistance:scoring.closingWithLimit,closingDistanceFixed:0,closingDistanceFree:0,closingDistanceRelative:.05,rounding:round2,cardinality:3,code:"fai"}]};const Solution$1=solution_Solution,{Range:Range$2,Point:Point$4}=foundation;var main={solver:function*(flight$1,_scoringTypes,_config){let reset;const scoringTypes=_scoringTypes||scoringRules_config.FFVL,config=_config||{};flight.analyze(flight$1,config),geom.init({flight:flight$1}),config.hp?Point$4.prototype.distanceEarth=Point$4.prototype.distanceEarthVincentys:Point$4.prototype.distanceEarth=Point$4.prototype.distanceEarthFCC;let solutionRoots=[];for(let scoringType of scoringTypes)for(let l of flight$1.ll){const opt={flight:flight$1,launch:l.launch,landing:l.landing,scoring:scoringType,config:config};let solutionRoot=new Solution$1([new Range$2(l.launch,l.landing),new Range$2(l.launch,l.landing),new Range$2(l.launch,l.landing)],opt);solutionRoot.do_bound(),solutionRoot.do_score(),solutionRoots.push(solutionRoot)}let best=solutionRoots[0],solutionQueue=new sortedSet(solutionRoots,Solution$1.prototype.contentEquals,Solution$1.prototype.contentCompare),processed=0,tcum=0;do{const tstart=Date.now();for(;solutionQueue.length>0;){if(processed%100==0&&"undefined"!=typeof process&&process.memoryUsage){const mem=process.memoryUsage();if(mem.heapUsed/mem.heapTotal>.98)break}let current=solutionQueue.pop();if(current.opt.scoring.rounding(current.bound)<=best.opt.scoring.rounding(best.score)){solutionQueue.clear();break}let children=current.do_branch();for(let s of children)if(s.do_bound(),!(s.bound<=best.score)){if(s.do_score(),processed++,s.score>=best.score&&s.score>0&&(best=s,solutionQueue.length>1e4&&solutionQueue.findLeast().value.bound<=best.score)){const garbageBest=solutionQueue.findGreatestLessThanOrEqual({bound:best.score});if(void 0!==garbageBest){const cutoff=solutionQueue.indexOf(garbageBest.value);solutionQueue.splice(0,cutoff+1).length}}solutionQueue.push(s)}if(processed>config.maxloop||Date.now()-tstart>config.maxcycle)break}best.processed=processed;const currentUpperBound=solutionQueue.findGreatest();if(best.currentUpperBound=currentUpperBound?currentUpperBound.value.bound:best.bound,tcum+=Date.now()-tstart,best.time=tcum,0==solutionQueue.length?best.optimal=!0:best.optimal=!1,best.optimal)return best.score=best.opt.scoring.rounding(best.score),best.scoreInfo&&(best.scoreInfo.distance=best.opt.scoring.rounding(best.scoreInfo.distance),best.scoreInfo.cp&&(best.scoreInfo.cp.d=best.opt.scoring.rounding(best.scoreInfo.cp.d))),reset=!0,best;reset=yield best}while(!reset)},scoring:scoringRules_config},main_1=main.solver,main_2=main.scoring;exports.default=main,exports.scoring=main_2,exports.solver=main_1;