"use strict";var t,e=(t=require("fs"))&&"object"==typeof t&&"default"in t?t.default:t,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var i,o=(i=Object.freeze({__proto__:null,default:[{name:"Aircotec",long:"ACT",short:"I"},{name:"Cambridge Aero Instruments",long:"CAM",short:"C"},{name:"ClearNav Instruments",long:"CNI",short:null},{name:"Data Swan/DSX",long:"DSX",short:"D"},{name:"EW Avionics",long:"EWA",short:"E"},{name:"Filser",long:"FIL",short:"F"},{name:"Flarm",long:"FLA",short:"G"},{name:"Flytech",long:"FLY",short:null},{name:"Garrecht",long:"GCS",short:"A"},{name:"IMI Gliding Equipment",long:"IMI",short:"M"},{name:"Logstream",long:"LGS",short:null},{name:"LX Navigation",long:"LXN",short:"L"},{name:"LXNAV",long:"LXV",short:"V"},{name:"Naviter",long:"NAV",short:null},{name:"New Technologies",long:"NTE",short:"N"},{name:"Nielsen Kellerman",long:"NKL",short:"K"},{name:"Peschges",long:"PES",short:"P"},{name:"PressFinish Electronics",long:"PFE",short:null},{name:"Print Technik",long:"PRT",short:"R"},{name:"Scheffel",long:"SCH",short:"H"},{name:"Streamline Data Instruments",long:"SDI",short:"S"},{name:"Triadis Engineering GmbH",long:"TRI",short:"T"},{name:"Zander",long:"ZAN",short:"Z"},{name:"XCSoar",long:"XCS",short:null},{name:"LK8000",long:"XLK",short:null},{name:"GpsDump",long:"XGD",short:null},{name:"SeeYou Recorder",long:"XCM",short:null}]}))&&i.default||i,s=function(t){let e=1===t.length;t=t.toUpperCase();let r=o.filter(r=>r[e?"short":"long"]===t);return 0!==r.length?r[0].name:t},a=/^A(\w{3})(\w{3,}?)(?:FLIGHT:(\d+)|\:(.+))?$/,h=/^HFDTE(?:DATE:)?(\d{2})(\d{2})(\d{2})(?:,?(\d{2}))?/,c=/^H[FOP]PLT(?:.{0,}?:(.*)|(.*))$/,u=/^H[FOP]CM2(?:.{0,}?:(.*)|(.*))$/,l=/^H[FOP]GTY(?:.{0,}?:(.*)|(.*))$/,p=/^H[FOP]GID(?:.{0,}?:(.*)|(.*))$/,f=/^H[FOP]CID(?:.{0,}?:(.*)|(.*))$/,d=/^H[FOP]CCL(?:.{0,}?:(.*)|(.*))$/,g=/^H[FOP]FTY(?:.{0,}?:(.*)|(.*))$/,y=/^H[FOP]RFW(?:.{0,}?:(.*)|(.*))$/,v=/^H[FOP]RHW(?:.{0,}?:(.*)|(.*))$/,m=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])([AV])(-\d{4}|\d{5})(-\d{4}|\d{5})/,b=/^K(\d{2})(\d{2})(\d{2})/,_=/^[IJ](\d{2})(?:\d{2}\d{2}[A-Z]{3})+/,w=/^C(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{4})([-\d]{2})(.*)/,x=/^C(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])(.*)/,O=function(){function t(){this._result={numFlight:null,pilot:null,copilot:null,gliderType:null,registration:null,callsign:null,competitionClass:null,loggerType:null,firmwareVersion:null,hardwareVersion:null,task:null,fixes:[],dataRecords:[],security:null,errors:[]},this.fixExtensions=[],this.dataExtensions=[],this.lineNumber=0,this.prevTimestamp=null}return t.parse=function(e,r){void 0===r&&(r={});for(var n=new t,i=[],o=0,s=e.split("\n");o<s.length;o++){var a=s[o];try{n.processLine(a.trim())}catch(t){if(!r.lenient)throw t;i.push(t)}}var h=n.result;return h.errors=i,h},Object.defineProperty(t.prototype,"result",{get:function(){if(!this._result.loggerManufacturer)throw new Error("Missing A record");if(!this._result.date)throw new Error("Missing HFDTE record");return this._result},enumerable:!0,configurable:!0}),t.prototype.processLine=function(t){this.lineNumber+=1;var e=t[0];if("B"===e){var r=this.parseBRecord(t);this.prevTimestamp=r.timestamp,this._result.fixes.push(r)}else if("K"===e){var n=this.parseKRecord(t);this.prevTimestamp=n.timestamp,this._result.dataRecords.push(n)}else if("H"===e)this.processHeader(t);else if("C"===e)this.processTaskLine(t);else if("A"===e){var i=this.parseARecord(t);this._result.loggerId=i.loggerId,this._result.loggerManufacturer=i.manufacturer,null!==i.numFlight&&(this._result.numFlight=i.numFlight)}else"I"===e?this.fixExtensions=this.parseIJRecord(t):"J"===e?this.dataExtensions=this.parseIJRecord(t):"G"===e&&(this._result.security=(this._result.security||"")+t.slice(1))},t.prototype.processHeader=function(t){var e=t.slice(2,5);if("DTE"===e){var r=this.parseDateHeader(t);this._result.date=r.date,null!==r.numFlight&&(this._result.numFlight=r.numFlight)}else"PLT"===e?this._result.pilot=this.parsePilot(t):"CM2"===e?this._result.copilot=this.parseCopilot(t):"GTY"===e?this._result.gliderType=this.parseGliderType(t):"GID"===e?this._result.registration=this.parseRegistration(t):"CID"===e?this._result.callsign=this.parseCallsign(t):"CCL"===e?this._result.competitionClass=this.parseCompetitionClass(t):"FTY"===e?this._result.loggerType=this.parseLoggerType(t):"RFW"===e?this._result.firmwareVersion=this.parseFirmwareVersion(t):"RHW"===e&&(this._result.hardwareVersion=this.parseHardwareVersion(t))},t.prototype.parseARecord=function(t){var e=t.match(a);if(e)return{manufacturer:s(e[1]),loggerId:e[2],numFlight:e[3]?parseInt(e[3],10):null,additionalData:e[4]||null};if(e=t.match(/^A(\w{3})(.+)?$/))return{manufacturer:s(e[1]),loggerId:null,numFlight:null,additionalData:e[2]?e[2].trim():null};throw new Error("Invalid A record at line "+this.lineNumber+": "+t)},t.prototype.parseDateHeader=function(t){var e=t.match(h);if(!e)throw new Error("Invalid DTE header at line "+this.lineNumber+": "+t);return{date:("8"===e[3][0]||"9"===e[3][0]?"19":"20")+e[3]+"-"+e[2]+"-"+e[1],numFlight:e[4]?parseInt(e[4],10):null}},t.prototype.parseTextHeader=function(t,e,r,n){void 0===n&&(n=" ");var i=r.match(e);return i?(i[1]||i[2]||"").replace(/_/g,n).trim():""},t.prototype.parsePilot=function(t){return this.parseTextHeader("PLT",c,t)},t.prototype.parseCopilot=function(t){return this.parseTextHeader("CM2",u,t)},t.prototype.parseGliderType=function(t){return this.parseTextHeader("GTY",l,t)},t.prototype.parseRegistration=function(t){return this.parseTextHeader("GID",p,t,"-")},t.prototype.parseCallsign=function(t){return this.parseTextHeader("CID",f,t)},t.prototype.parseCompetitionClass=function(t){return this.parseTextHeader("GID",d,t)},t.prototype.parseLoggerType=function(t){return this.parseTextHeader("FTY",g,t)},t.prototype.parseFirmwareVersion=function(t){return this.parseTextHeader("RFW",y,t)},t.prototype.parseHardwareVersion=function(t){return this.parseTextHeader("RHW",v,t)},t.prototype.processTaskLine=function(t){this._result.task?this._result.task.points.push(this.parseTaskPoint(t)):this._result.task=this.parseTask(t)},t.prototype.parseTask=function(t){var e=t.match(w);if(!e)throw new Error("Invalid task declaration at line "+this.lineNumber+": "+t);var r="8"===e[3][0]||"9"===e[3][0],n=(r?"19":"20")+e[3]+"-"+e[2]+"-"+e[1],i=e[4]+":"+e[5]+":"+e[6],o=Date.parse(n+"T"+i+"Z"),s=null;return"00"===e[7]&&"00"===e[8]&&"00"===e[9]||(s=((r="8"===e[9][0]||"9"===e[9][0])?"19":"20")+e[9]+"-"+e[8]+"-"+e[7]),{declarationDate:n,declarationTime:i,declarationTimestamp:o,flightDate:s,taskNumber:"0000"!==e[10]?parseInt(e[10],10):null,numTurnpoints:parseInt(e[11],10),comment:e[12]||null,points:[]}},t.prototype.parseTaskPoint=function(e){var r=e.match(x);if(!r)throw new Error("Invalid task point declaration at line "+this.lineNumber+": "+e);return{latitude:t.parseLatitude(r[1],r[2],r[3],r[4]),longitude:t.parseLongitude(r[5],r[6],r[7],r[8]),name:r[9]||null}},t.prototype.parseBRecord=function(e){if(!this._result.date)throw new Error("Missing HFDTE record before first B record");var r=e.match(m);if(!r)throw new Error("Invalid B record at line "+this.lineNumber+": "+e);var n=r[1]+":"+r[2]+":"+r[3],i=this.calcTimestamp(n),o=t.parseLatitude(r[4],r[5],r[6],r[7]),s=t.parseLongitude(r[8],r[9],r[10],r[11]),a="A"===r[12],h="00000"===r[13]?null:parseInt(r[13],10),c="00000"===r[14]?null:parseInt(r[14],10),u={};if(this.fixExtensions)for(var l=0,p=this.fixExtensions;l<p.length;l++){var f=p[l],d=f.code,g=f.start,y=f.length;u[d]=e.slice(g,g+y)}var v=null;if(u.ENL){var b=this.fixExtensions.filter((function(t){return"ENL"===t.code}))[0].length,_=Math.pow(10,b);v=parseInt(u.ENL,10)/_}return{timestamp:i,time:n,latitude:o,longitude:s,valid:a,pressureAltitude:h,gpsAltitude:c,extensions:u,enl:v,fixAccuracy:u.FXA?parseInt(u.FXA,10):null}},t.prototype.parseKRecord=function(t){if(!this._result.date)throw new Error("Missing HFDTE record before first K record");if(!this.dataExtensions)throw new Error("Missing J record before first K record");var e=t.match(b);if(!e)throw new Error("Invalid K record at line "+this.lineNumber+": "+t);var r=e[1]+":"+e[2]+":"+e[3],n=this.calcTimestamp(r),i={};if(this.dataExtensions)for(var o=0,s=this.dataExtensions;o<s.length;o++){var a=s[o],h=a.code,c=a.start,u=a.length;i[h]=t.slice(c,c+u)}return{timestamp:n,time:r,extensions:i}},t.prototype.parseIJRecord=function(t){var e=t.match(_);if(!e)return[];var r=parseInt(e[1],10);if(t.length<3+7*r)throw new Error("Invalid "+t[0]+" record at line "+this.lineNumber+": "+t);for(var n=new Array(r),i=0;i<r;i++){var o=3+7*i,s=parseInt(t.slice(o,o+2),10),a=parseInt(t.slice(o+2,o+4),10)-s+1,h=t.slice(o+4,o+7);n[i]={start:s,length:a,code:h}}return n},t.parseLatitude=function(t,e,r,n){var i=parseInt(t,10)+parseFloat(e+"."+r)/60;return"S"===n?-i:i},t.parseLongitude=function(t,e,r,n){var i=parseInt(t,10)+parseFloat(e+"."+r)/60;return"W"===n?-i:i},t.prototype.calcTimestamp=function(t){for(var e=Date.parse(this._result.date+"T"+t+"Z");this.prevTimestamp&&e<this.prevTimestamp-36e5;)e+=864e5;return e},t}();function j(t){return t/(180/Math.PI)}function C(t){return t*(180/Math.PI)}class E{constructor(t,e){void 0!==t.fixes?[this.x,this.y,this.r]=[t.fixes[e].longitude,t.fixes[e].latitude,e]:[this.x,this.y]=[t,e]}geojson(t,e){return{type:"Feature",id:t,properties:e||{},geometry:{type:"Point",coordinates:[this.x,this.y]}}}toString(){return JSON.stringify(this.geojson())}distanceEarth(t){const e=t.y-this.y,r=t.x-this.x,n=j((this.y+t.y)/2),i=111.13209-.566605*Math.cos(2*n)+.0012*Math.cos(4*n),o=111.41513*Math.cos(n)-.09455*Math.cos(3*n)+12e-5*Math.cos(5*n);return Math.sqrt(i*e*(i*e)+o*r*(o*r))}distanceEarthRev(t,e){const r=this.x+C(t/6371/Math.cos(j(this.y))),n=this.y+C(e/6371);return new E(r,n)}}class M{constructor(t,e){[this.a,this.b]=[t,e]}count(){return Math.abs(this.a-this.b)+1}center(){return Math.min(this.a,this.b)+Math.floor(Math.abs(this.a-this.b)/2)}left(){return new M(Math.min(this.a,this.b),Math.min(this.a,this.b)+Math.floor(Math.abs(this.a-this.b)/2))}right(){return new M(Math.min(this.a,this.b)+Math.ceil(Math.abs(this.a-this.b)/2),Math.max(this.a,this.b))}contains(t){return this.a<=t&&t<=this.b}}var A=E,P=M,k=class{constructor(t,e,r,n){if(t instanceof M){[this.x1,this.y1,this.x2,this.y2]=[1/0,1/0,-1/0,-1/0];for(let r=t.a;r<=t.b;r++)this.x1=Math.min(e.fixes[r].longitude,this.x1),this.y1=Math.min(e.fixes[r].latitude,this.y1),this.x2=Math.max(e.fixes[r].longitude,this.x2),this.y2=Math.max(e.fixes[r].latitude,this.y2)}else[this.x1,this.y1,this.x2,this.y2]=[t,e,r,n]}vertices(){return[new E(this.x1,this.y1),new E(this.x2,this.y1),new E(this.x2,this.y2),new E(this.x1,this.y2)]}intersects(t){return!(this.x1>t.x2||this.x2<t.x1||this.y1>t.y2||this.y2<t.y1)}distance(t){if(this.intersects(t))return 0;let e,r,n,i;return this.x1>t.x2&&(e=this.x1),n=t.x2,this.x2<t.x1&&(e=this.x2),n=t.x1,this.y1<t.y2&&(r=this.y1),i=t.y2,this.y2>t.y1&&(r=this.y2),i=t.y1,void 0===e&&(e=this.x1,n=this.x1),void 0===r&&(r=this.y1,i=this.y1),distance_earth(new E(e,r),new E(n,i))}geojson(t,e){return{type:"Feature",id:t,properties:e||{},geometry:{type:"Polygon",coordinates:[[[this.x1,this.y1],[this.x1,this.y2],[this.x2,this.y2],[this.x2,this.y1],[this.x1,this.y1]]]}}}geojson_collection(t){for(let e in t)(void 0).push(t[e].geojson(e,{id:e}));return{type:"FeatureCollection",features:void 0}}toString(){return JSON.stringify(this.geojson())}},L={reset:"[0m",bright:"[1m",dim:"[2m",underscore:"[4m",blink:"[5m",reverse:"[7m",hidden:"[8m",fg:{black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",crimson:"[38m"},bg:{black:"[40m",red:"[41m",green:"[42m",yellow:"[43m",blue:"[44m",magenta:"[45m",cyan:"[46m",white:"[47m",crimson:"[48m"}};let D=0;const S=k,I=A;class T{constructor(t,e,r){t.length>e.scoring.cardinality?this.ranges=t.slice(0,e.scoring.cardinality):this.ranges=t,this.score=void 0,this.bound=void 0,this.id=D++,this.opt=e,this.parent=void 0!==r?r+"-"+this.id:this.id}do_branch(){let t=0;for(let e in this.ranges)this.ranges[e].count()>this.ranges[t].count()&&(t=parseInt(e));if(1==this.ranges[t].count())return[];let e=[];for(let r of[this.ranges[t].left(),this.ranges[t].right()]){if(t>0&&r.a<this.ranges[t-1].a)continue;if(t>0&&r.b<this.ranges[t-1].b)continue;let n=[];for(let e in this.ranges)n[e]=e!=t?this.ranges[e]:r;e.push(new T(n,this.opt,this.parent))}return e}do_bound(){this.bound=this.opt.scoring.bound(this.ranges,this.opt)}do_score(){for(let t in this.ranges)if(t<this.ranges.length-1&&this.ranges[t].center()>=this.ranges[parseInt(t)+1].center())return void(this.score=0);let t=[];for(let e in this.ranges)t[e]=new I(this.opt.flight,this.ranges[e].center());this.scoreInfo=this.opt.scoring.score(t,this.opt),this.score=this.scoreInfo.score}contentEquals(t,e){return t.id===e.id}contentCompare(t,e){return t.bound<e.bound?-1:t.bound>e.bound?1:t.id<e.id?-1:t.id>e.id?1:0}geojson(t){let e=[];if(!t.quiet)for(let t in this.ranges)e.push(new S(this.ranges[t],this.opt.flight).geojson("box"+t,{a:this.ranges[t].a,b:this.ranges[t].b}));try{const t=this.scoreInfo.tp;for(let r of[0,1,2])e.push(t[r].geojson("tp"+r,{id:"tp"+r,r:t[r].r,timestamp:this.opt.flight.fixes[t[r].r].timestamp})),(r<2||this.opt.scoring.closingDistance)&&e.push({type:"Feature",id:"seg"+r,properties:{id:"seg"+r,stroke:"yellow","stroke-width":4},geometry:{type:"LineString",coordinates:[[t[r].x,t[r].y],[t[(r+1)%3].x,t[(r+1)%3].y]],style:{stroke:"yellow","stroke-width":4}}})}catch(t){console.error("no turnpoints")}try{if(void 0!==this.scoreInfo.cp){const t=this.scoreInfo.cp,r=this.scoreInfo.tp;for(let r of["in","out"])e.push(t[r].geojson("cp_"+r,{id:"cp_"+r,r:t[r].r,timestamp:this.opt.flight.fixes[t[r].r].timestamp}));this.opt.scoring.closingDistance?e.push({type:"Feature",id:"closing",properties:{id:"seg",stroke:"green","stroke-width":3},geometry:{type:"LineString",coordinates:[[t.in.x,t.in.y],[t.out.x,t.out.y]],style:{stroke:"green","stroke-width":3}}}):(e.push({type:"Feature",id:"closing",properties:{id:"seg",stroke:"green","stroke-width":3},geometry:{type:"LineString",coordinates:[[t.in.x,t.in.y],[r[0].x,r[0].y]],style:{stroke:"green","stroke-width":3}}}),e.push({type:"Feature",id:"closing",properties:{id:"seg",stroke:"green","stroke-width":3},geometry:{type:"LineString",coordinates:[[t.out.x,t.out.y],[r[2].x,r[2].y]],style:{stroke:"green","stroke-width":3}}}))}}catch(t){console.error("no closing points")}if(!t.noflight){let t=[];for(let e of this.opt.flight.fixes)t.push([e.longitude,e.latitude]);e.push({type:"Feature",properties:{id:"flight"},geometry:{type:"LineString",coordinates:t}})}return{type:"FeatureCollection",properties:{id:this.id,score:void 0!==this.score?this.score:void 0,bound:void 0!==this.bound?this.bound:void 0,optimal:this.optimal,processedTime:this.time/1e3,processedSolutions:this.processed,type:this.opt.scoring.name},features:e}}toString(){return JSON.stringify(this.geojson())}}var R=T;class B{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,e){let r=this.length++;for(this.ids[r]=t,this.values[r]=e;r>0;){const t=r-1>>1,n=this.values[t];if(e>=n)break;this.ids[r]=this.ids[t],this.values[r]=n,r=t}this.ids[r]=t,this.values[r]=e}pop(){if(0===this.length)return;const t=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],e=this.values[0]=this.values[this.length],r=this.length>>1;let n=0;for(;n<r;){let t=1+(n<<1);const r=t+1;let i=this.ids[t],o=this.values[t];const s=this.values[r];if(r<this.length&&s<o&&(t=r,i=this.ids[r],o=s),o>=e)break;this.ids[n]=i,this.values[n]=o,n=t}this.ids[n]=t,this.values[n]=e}return t}peek(){return this.ids[0]}peekValue(){return this.values[0]}}const F=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class N{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,r]=new Uint8Array(t,0,2);if(251!==e)throw new Error("Data does not appear to be in a Flatbush format.");if(r>>4!=3)throw new Error(`Got v${r>>4} data when expected v3.`);const[n]=new Uint16Array(t,2,1),[i]=new Uint32Array(t,4,1);return new N(i,n,F[15&r],t)}constructor(t,e=16,r=Float64Array,n){if(void 0===t)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535);let i=t,o=i;this._levelBounds=[4*i];do{i=Math.ceil(i/this.nodeSize),o+=i,this._levelBounds.push(4*o)}while(1!==i);this.ArrayType=r||Float64Array,this.IndexArrayType=o<16384?Uint16Array:Uint32Array;const s=F.indexOf(this.ArrayType),a=4*o*this.ArrayType.BYTES_PER_ELEMENT;if(s<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this._boxes=new this.ArrayType(this.data,8,4*o),this._indices=new this.IndexArrayType(this.data,8+a,o),this._pos=4*o,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+a+o*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*o),this._indices=new this.IndexArrayType(this.data,8+a,o),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+s]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t),this._queue=new B}add(t,e,r,n){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=t,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,t<this.minX&&(this.minX=t),e<this.minY&&(this.minY=e),r>this.maxX&&(this.maxX=r),n>this.maxY&&(this.maxY=n),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize)return this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,void(this._boxes[this._pos++]=this.maxY);const t=this.maxX-this.minX,e=this.maxY-this.minY,r=new Uint32Array(this.numItems);for(let n=0;n<this.numItems;n++){let i=4*n;const o=this._boxes[i++],s=this._boxes[i++],a=this._boxes[i++],h=this._boxes[i++],c=Math.floor(65535*((o+a)/2-this.minX)/t),u=Math.floor(65535*((s+h)/2-this.minY)/e);r[n]=Y(c,u)}!function t(e,r,n,i,o,s){if(Math.floor(i/s)>=Math.floor(o/s))return;const a=e[i+o>>1];let h=i-1,c=o+1;for(;;){do{h++}while(e[h]<a);do{c--}while(e[c]>a);if(h>=c)break;H(e,r,n,h,c)}t(e,r,n,i,c,s),t(e,r,n,c+1,o,s)}(r,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let t=0,e=0;t<this._levelBounds.length-1;t++){const r=this._levelBounds[t];for(;e<r;){const t=e;let n=1/0,i=1/0,o=-1/0,s=-1/0;for(let t=0;t<this.nodeSize&&e<r;t++)n=Math.min(n,this._boxes[e++]),i=Math.min(i,this._boxes[e++]),o=Math.max(o,this._boxes[e++]),s=Math.max(s,this._boxes[e++]);this._indices[this._pos>>2]=t,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,this._boxes[this._pos++]=o,this._boxes[this._pos++]=s}}}search(t,e,r,n,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const s=[],a=[];for(;void 0!==o;){const h=Math.min(o+4*this.nodeSize,X(o,this._levelBounds));for(let c=o;c<h;c+=4){const h=0|this._indices[c>>2];r<this._boxes[c]||(n<this._boxes[c+1]||t>this._boxes[c+2]||e>this._boxes[c+3]||(o<4*this.numItems?(void 0===i||i(h))&&a.push(h):s.push(h)))}o=s.pop()}return a}neighbors(t,e,r=1/0,n=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const s=this._queue,a=[],h=n*n;for(;void 0!==o;){const n=Math.min(o+4*this.nodeSize,X(o,this._levelBounds));for(let r=o;r<n;r+=4){const n=0|this._indices[r>>2],a=q(t,this._boxes[r],this._boxes[r+2]),h=q(e,this._boxes[r+1],this._boxes[r+3]),c=a*a+h*h;o<4*this.numItems?(void 0===i||i(n))&&s.push(-n-1,c):s.push(n,c)}for(;s.length&&s.peek()<0;){if(s.peekValue()>h)return s.clear(),a;if(a.push(-s.pop()-1),a.length===r)return s.clear(),a}o=s.pop()}return s.clear(),a}}function q(t,e,r){return t<e?e-t:t<=r?0:t-r}function X(t,e){let r=0,n=e.length-1;for(;r<n;){const i=r+n>>1;e[i]>t?n=i:r=i+1}return e[r]}function H(t,e,r,n,i){const o=t[n];t[n]=t[i],t[i]=o;const s=4*n,a=4*i,h=e[s],c=e[s+1],u=e[s+2],l=e[s+3];e[s]=e[a],e[s+1]=e[a+1],e[s+2]=e[a+2],e[s+3]=e[a+3],e[a]=h,e[a+1]=c,e[a+2]=u,e[a+3]=l;const p=r[n];r[n]=r[i],r[i]=p}function Y(t,e){let r=t^e,n=65535^r,i=65535^(t|e),o=t&(65535^e),s=r|n>>1,a=r>>1^r,h=i>>1^n&o>>1^i,c=r&i>>1^o>>1^o;r=s,n=a,i=h,o=c,s=r&r>>2^n&n>>2,a=r&n>>2^n&(r^n)>>2,h^=r&i>>2^n&o>>2,c^=n&i>>2^(r^n)&o>>2,r=s,n=a,i=h,o=c,s=r&r>>4^n&n>>4,a=r&n>>4^n&(r^n)>>4,h^=r&i>>4^n&o>>4,c^=n&i>>4^(r^n)&o>>4,r=s,n=a,i=h,o=c,h^=r&i>>8^n&o>>8,c^=n&i>>8^(r^n)&o>>8,r=h^h>>1,n=c^c>>1;let u=t^e,l=n|65535^(u|r);return u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),l=16711935&(l|l<<8),l=252645135&(l|l<<4),l=858993459&(l|l<<2),l=1431655765&(l|l<<1),(l<<1|u)>>>0}function z(t,e,r,n,i){!function t(e,r,n,i,o){for(;i>n;){if(i-n>600){var s=i-n+1,a=r-n+1,h=Math.log(s),c=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*c*(s-c)/s)*(a-s/2<0?-1:1),l=Math.max(n,Math.floor(r-a*c/s+u)),p=Math.min(i,Math.floor(r+(s-a)*c/s+u));t(e,r,l,p,o)}var f=e[r],d=n,g=i;for($(e,n,r),o(e[i],f)>0&&$(e,n,i);d<g;){for($(e,d,g),d++,g--;o(e[d],f)<0;)d++;for(;o(e[g],f)>0;)g--}0===o(e[n],f)?$(e,n,g):(g++,$(e,g,i)),g<=r&&(n=g+1),r<=g&&(i=g-1)}}(t,e,r||0,n||t.length-1,i||G)}function $(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function G(t,e){return t<e?-1:t>e?1:0}function V(t,e,r){if(!r)return e.indexOf(t);for(let n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function W(t,e){U(t,0,t.children.length,e,t)}function U(t,e,r,n,i){i||(i=it(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=e;o<r;o++){const e=t.children[o];J(i,t.leaf?n(e):e)}return i}function J(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function K(t,e){return t.minX-e.minX}function Z(t,e){return t.minY-e.minY}function Q(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function tt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function et(t,e){const r=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function rt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function nt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function it(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ot(t,e,r,n,i){const o=[e,r];for(;o.length;){if((r=o.pop())-(e=o.pop())<=n)continue;const s=e+Math.ceil((r-e)/n/2)*n;z(t,s,e,r,i),o.push(e,s,s,r)}}const st=k,at=A,ht=P;function ct(t,e){let r=0;for(let n of e[0]){const i=n.distanceEarth(t)+(e.length>1?ct(n,e.slice(1)):0);r=Math.max(r,i)}return r}const ut=new class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!nt(t,e))return r;const n=this.toBBox,i=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],a=e.leaf?n(s):s;nt(t,a)&&(e.leaf?r.push(s):rt(t,a)?this._all(s,r):i.push(s))}e=i.pop()}return r}collides(t){let e=this.data;if(!nt(t,e))return!1;const r=[];for(;e;){for(let n=0;n<e.children.length;n++){const i=e.children[n],o=e.leaf?this.toBBox(i):i;if(nt(t,o)){if(e.leaf||rt(t,o))return!0;r.push(i)}}e=r.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=it([]),this}remove(t,e){if(!t)return this;let r=this.data;const n=this.toBBox(t),i=[],o=[];let s,a,h;for(;r||i.length;){if(r||(r=i.pop(),a=i[i.length-1],s=o.pop(),h=!0),r.leaf){const n=V(t,r.children,e);if(-1!==n)return r.children.splice(n,1),i.push(r),this._condense(i),this}h||r.leaf||!rt(r,n)?a?(s++,r=a.children[s],h=!1):r=null:(i.push(r),o.push(s),s=0,a=r,r=r.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,n){const i=r-e+1;let o,s=this._maxEntries;if(i<=s)return o=it(t.slice(e,r+1)),W(o,this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),o=it([]),o.leaf=!1,o.height=n;const a=Math.ceil(i/s),h=a*Math.ceil(Math.sqrt(s));ot(t,e,r,h,this.compareMinX);for(let i=e;i<=r;i+=h){const e=Math.min(i+h-1,r);ot(t,i,e,a,this.compareMinY);for(let r=i;r<=e;r+=a){const i=Math.min(r+a-1,e);o.children.push(this._build(t,r,i,n-1))}}return W(o,this.toBBox),o}_chooseSubtree(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){let r,n=1/0,s=1/0;for(let a=0;a<e.children.length;a++){const h=e.children[a],c=Q(h),u=(i=t,o=h,(Math.max(o.maxX,i.maxX)-Math.min(o.minX,i.minX))*(Math.max(o.maxY,i.maxY)-Math.min(o.minY,i.minY))-c);u<s?(s=u,n=c<n?c:n,r=h):u===s&&c<n&&(n=c,r=h)}e=r||e.children[0]}var i,o;return e}_insert(t,e,r){const n=r?t:this.toBBox(t),i=[],o=this._chooseSubtree(n,this.data,e,i);for(o.children.push(t),J(o,n);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(n,i,e)}_split(t,e){const r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const o=this._chooseSplitIndex(r,i,n),s=it(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,W(r,this.toBBox),W(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)}_splitRoot(t,e){this.data=it([t,e]),this.data.height=t.height+1,this.data.leaf=!1,W(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let n,i=1/0,o=1/0;for(let s=e;s<=r-e;s++){const e=U(t,0,s,this.toBBox),a=U(t,s,r,this.toBBox),h=et(e,a),c=Q(e)+Q(a);h<i?(i=h,n=s,o=c<o?c:o):h===i&&c<o&&(o=c,n=s)}return n||r-e}_chooseSplitAxis(t,e,r){const n=t.leaf?this.compareMinX:K,i=t.leaf?this.compareMinY:Z;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)}_allDistMargin(t,e,r,n){t.children.sort(n);const i=this.toBBox,o=U(t,0,e,i),s=U(t,r-e,r,i);let a=tt(o)+tt(s);for(let n=e;n<r-e;n++){const e=t.children[n];J(o,t.leaf?i(e):e),a+=tt(o)}for(let n=r-e-1;n>=e;n--){const e=t.children[n];J(s,t.leaf?i(e):e),a+=tt(s)}return a}_adjustParentBBoxes(t,e,r){for(let n=r;n>=0;n--)J(e[n],t)}_condense(t){for(let e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():W(t[r],this.toBBox)}};var lt={maxDistance3Rectangles:function(t,e){let r,n,i,o,s=[];for(let e of[0,1,2])s[e]=t[e].vertices(),r=Math.min(r||1/0,t[e].x1),n=Math.min(n||1/0,t[e].y1),i=Math.max(i||-1/0,t[e].x2),o=Math.max(o||-1/0,t[e].y2);let a=[[],[],[]];for(let e of[0,1,2]){for(let t of s[e])t.x!=r&&t.x!=i||t.y!=n&&t.y!=o||a[e].push(t);if(0==a[e].length)for(let t of s[e])t.x!=r&&t.x!=i&&t.y!=n&&t.y!=o||a[e].push(t);(0==a[e].length||e>1&&t[e-1].intersects(t[e]))&&(a[e]=s[e])}let h=0;for(let t of a[0])for(let r of a[1])for(let n of a[2]){const i=e(t,r,n);h=Math.max(h,i)}return h},maxDistance2Rectangles:function(t){let e,r,n,i,o=[];for(let s of[0,1])o[s]=t[s].vertices(),e=Math.min(e||1/0,t[s].x1),r=Math.min(r||1/0,t[s].y1),n=Math.max(n||-1/0,t[s].x2),i=Math.max(i||-1/0,t[s].y2);let s=[[],[]];for(let t of[0,1])s[t]=o[t];let a=0;for(let t of s[0])for(let e of s[1]){const r=t.distanceEarth(e);a=Math.max(a,r)}return a},minDistance3Rectangles:function(t,e){let r,n,i,o,s=[];for(let e of[0,1,2])s[e]=t[e].vertices(),r=Math.min(r||1/0,t[e].x1),n=Math.min(n||1/0,t[e].y1),i=Math.max(i||-1/0,t[e].x2),o=Math.max(o||-1/0,t[e].y2);let a=[[],[],[]];for(let t of[0,1,2])a[t]=s[t];let h=1/0;for(let t of a[0])for(let r of a[1])for(let n of a[2]){const i=e(t,r,n);h=Math.min(h,i)}return h},maxDistanceNRectangles:function(t){let e,r,n,i,o=[],s=[];for(let a in t)o[a]=t[a].vertices(),e=Math.min(e||1/0,t[a].x1),r=Math.min(r||1/0,t[a].y1),n=Math.max(n||-1/0,t[a].x2),i=Math.max(i||-1/0,t[a].y2),s[a]=[];for(let e in t)s[e]=o[e];let a=0;for(let t of s[0]){const e=ct(t,s.slice(1));a=Math.max(a,e)}return a},findFurthestPoint:function(t,e,r){const n="start"==e?1:-1;let i,o,s="start"==e?0:r.flight.fixes.length-1,a=-1/0,h=void 0,c=void 0;for(t instanceof ht?(o=new st(t,r.flight).vertices(),i="start"==e?t.a:t.b):(o=[new at(r.flight,t)],i=t);"start"==e?s<=i:s>=i;s+=n){const t=new at(r.flight,s);for(let e of o){let r=e.distanceEarth(t);r>a&&(a=r,h=e.r,c=s)}}return{d:a,in:Math.min(h,c),out:Math.max(h,c)}},isTriangleClosed:function(t,e,r,n){const i=ut.search({minX:0,minY:e,maxX:t,maxY:n.flight.fixes.length});for(let t of i)if(t.o.d<n.scoring.closingDistance(0))return t.o;const o=function(t,e,r){const n=ut.search({minX:t,minY:e,maxX:t,maxY:e})[0];if(void 0!==n)return n.o;const i=new N(t+1);for(let e=0;e<=t;e++){let t=r.flight.fixes[e];i.add(t.longitude,t.latitude,t.longitude,t.latitude)}i.finish();let o={d:1/0};for(let t=e;t<r.flight.fixes.length;t++){const e=new at(r.flight,t),n=i.neighbors(e.x,e.y,1)[0];if(void 0!==n){const t=new at(r.flight,n),i=e.distanceEarth(t);i<o.d&&(o.d=i,o.out=e,o.in=t)}}return ut.insert({minX:t,minY:e,maxX:t,maxY:e,o:o}),o}(t,e,n);return o.d<=n.scoring.closingDistance(r)&&o}};const pt=k,ft=[{name:"Flat Triangle",bound:dt,score:gt,closingDistance:yt,rounding:wt,cardinality:3},{name:"FAI Triangle",bound:bt,score:_t,closingDistance:yt,rounding:wt,cardinality:3},{name:"3 TP Distance",bound:vt,score:mt,rounding:wt,cardinality:5}];function dt(t,e){let r=[];for(let n of[0,1,2])r[n]=new pt(t[n],e.flight);const n=lt.maxDistance3Rectangles(r,(t,e,r)=>t.distanceEarth(e)+e.distanceEarth(r)+r.distanceEarth(t));let i={d:0};return t[0].b<t[2].a?(i=lt.isTriangleClosed(t[0].b,t[2].a,n,e),i?1.2*n-(i.d>3?i.d:0):0):1.2*n}function gt(t,e){const r=t[0].distanceEarth(t[1])+t[1].distanceEarth(t[2])+t[2].distanceEarth(t[0]);let n=lt.isTriangleClosed(t[0].r,t[2].r,r,e);return n?{distance:r,score:1.2*r-(n.d>3?n.d:0),tp:t,cp:n}:{score:0}}function yt(t){return Math.max(3,.05*t)}function vt(t,e){let r=[];for(let n of[0,1,2,3,4])r[n]=new pt(t[n],e.flight);return lt.maxDistanceNRectangles(r)}function mt(t,e){let r=0;for(let e of[0,1,2,3])r+=t[e].distanceEarth(t[e+1]);return{distance:r,score:r,tp:t.slice(1,4),cp:{in:t[0],out:t[4],d:0}}}function bt(t,e){let r=[];for(let n of[0,1,2])r[n]=new pt(t[n],e.flight);const n=lt.maxDistance3Rectangles(r,(t,e,r)=>t.distanceEarth(e)+e.distanceEarth(r)+r.distanceEarth(t)),i=lt.minDistance3Rectangles(r,(t,e,r)=>t.distanceEarth(e)+e.distanceEarth(r)+r.distanceEarth(t)),o=lt.maxDistance2Rectangles([r[0],r[1]]),s=lt.maxDistance2Rectangles([r[1],r[2]]),a=lt.maxDistance2Rectangles([r[2],r[0]]),h=Math.min(o/.28,s/.28,a/.28,n);if(h<i)return 0;let c={d:0};return t[0].b<t[2].a?(c=lt.isTriangleClosed(t[0].b,t[2].a,h,e),c?1.4*h-(c.d>3?c.d:0):0):1.4*h}function _t(t,e){const r=t[0].distanceEarth(t[1]),n=t[1].distanceEarth(t[2]),i=t[2].distanceEarth(t[0]),o=r+n+i;let s=0;r>.28*o&&n>.28*o&&i>.28*o&&(s=1.4*o);let a=lt.isTriangleClosed(t[0].r,t[2].r,o,e);return a?(s-=a.d>3?a.d:0,{distance:o,score:s,tp:t,cp:a}):{score:0}}function wt(t){return t.toFixed(2)}var xt={defaultScoringTypes:ft,scoringFFVL:ft,isClosedTriangle:yt,boundFlatTriangle:dt,scoreFlatTriangle:gt,boundDistance3Points:vt,scoreDistance3Points:mt,boundFAITriangle:bt,scoreFAITriangle:_t};Function.noop=function(){},Function.identity=function(t){return t},Function.by=function(t,e){e=e||Object.compare,t=t||Function.identity;var r=function(r,n){return e(t(r),t(n))};return r.compare=e,r.by=t,r},Function.get=function(t){return function(e){return Object.get(e,t)}};var Ot=jt;function jt(){throw new Error("Can't construct. GenericCollection is a mixin.")}var Ct=r.DOMTokenList||function(){};jt.EmptyArray=Object.freeze([]),jt.prototype.addEach=function(t,e,r){if(t&&(t instanceof Array||t instanceof Ct||t instanceof String))if(e)for(var n=0;n<t.length;n++)this.add(e.call(r,t[n]),n);else for(n=0;n<t.length;n++)this.add(t[n],n);else if(t&&Object(t)===t)if("function"==typeof t.forEach)e?t.map(e,r).forEach(this.add,this):t.forEach(this.add,this);else if("function"==typeof t.next){var i;n=0;if(e)for(;i=t.next().value;)this.add(e.call(r,i),n++);else for(;i=t.next().value;)this.add(i,n++)}else if("number"==typeof t.length)if(e)for(n=0;n<t.length;n++)this.add(e.call(r,t[n]),n);else for(n=0;n<t.length;n++)this.add(t[n],n);else e?Object.keys(t).forEach((function(n){this.add(e.call(r,t[n]),n)}),this):Object.keys(t).forEach((function(e){this.add(t[e],e)}),this);return this},jt.prototype.deleteEach=function(t,e){return t.forEach((function(t){this.delete(t,e)}),this),this},jt.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(r,n,i,o,s){t.call(e,n,i,o,s)}),void 0)},jt.prototype.map=function(t){var e=arguments[1],r=[];return this.reduce((function(n,i,o,s,a){r.push(t.call(e,i,o,s,a))}),void 0),r},jt.prototype.enumerate=function(t){null==t&&(t=0);var e=[];return this.reduce((function(r,n){e.push([t++,n])}),void 0),e},jt.prototype.group=function(t,e,r){r=r||Object.equals;var n=[],i=[];return this.forEach((function(o,s,a){s=t.call(e,o,s,a);var h,c=i.indexOf(s,r);-1===c?(h=[],n.push([s,h]),i.push(s)):h=n[c][1],h.push(o)})),n},jt.prototype.toArray=function(){return this.map(Function.identity)},jt.prototype.toObject=function(){var t={};return this.reduce((function(e,r,n){t[n]=r}),void 0),t},jt.from=function(){return this.apply(this,arguments)},jt.prototype.filter=function(t){var e=arguments[1],r=this.constructClone();return this.reduce((function(n,i,o,s,a){t.call(e,i,o,s,a)&&r.add(i,o)}),void 0),r},jt.prototype.every=function(t){var e=arguments[1];return this.reduce((function(r,n,i,o,s){return r&&t.call(e,n,i,o,s)}),!0)},jt.prototype.some=function(t){var e=arguments[1];return this.reduce((function(r,n,i,o,s){return r||t.call(e,n,i,o,s)}),!1)},jt.prototype.all=function(){return this.every(Boolean)},jt.prototype.any=function(){return this.some(Boolean)},jt.prototype.min=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(r,n){return e?(e=!1,n):t(n,r)<0?n:r}),void 0)},jt.prototype.max=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(r,n){return e?(e=!1,n):t(n,r)>0?n:r}),void 0)},jt.prototype.sum=function(t){return t=void 0===t?0:t,this.reduce((function(t,e){return t+e}),t)},jt.prototype.average=function(t){var e=void 0===t?0:t,r=void 0===t?0:t;return this.reduce((function(t,n){e+=n,r+=1}),void 0),e/r},jt.prototype.concat=function(){for(var t=this.constructClone(this),e=0;e<arguments.length;e++)t.addEach(arguments[e]);return t},jt.prototype.flatten=function(){var t=this;return this.reduce((function(e,r){return r.forEach((function(t){this.push(t)}),e,t),e}),[])},jt.prototype.zip=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),Array.unzip(t)},jt.prototype.join=function(t){return this.reduce((function(e,r){return void 0===e?r:e+t+r}),void 0)},jt.prototype.sorted=function(t,e,r){return(t=t||this.contentCompare||Object.compare).by?(e=t.by,t=t.compare||this.contentCompare||Object.compare):e=e||Function.identity,void 0===r&&(r=1),this.map((function(t){return{by:e(t),value:t}})).sort((function(e,n){return t(e.by,n.by)*r})).map((function(t){return t.value}))},jt.prototype.reversed=function(){return this.constructClone(this).reverse()},jt.prototype.clone=function(t,e){if(void 0===t)t=1/0;else if(0===t)return this;var r=this.constructClone();return this.forEach((function(n,i){r.add(Object.clone(n,t-1,e),i)}),this),r},jt.prototype.only=function(){if(1===this.length)return this.one()},jt.prototype.iterator=function(){return this.iterate.apply(this,arguments)},jt._sizePropertyDescriptor={get:function(){return this.length},enumerable:!1,configurable:!0},Object.defineProperty(jt.prototype,"size",jt._sizePropertyDescriptor);var Et=n((function(t){!function(){if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=g);var e=!1;if("function"==typeof WeakMap){var r=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var n=new r,i=Object.freeze({});if(n.set(i,1),1===n.get(i))return void(t.exports=WeakMap);e=!0}}var o=Object.getOwnPropertyNames,s=Object.defineProperty,a=Object.isExtensible,h="weakmap:ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var c=new ArrayBuffer(25),u=new Uint8Array(c);crypto.getRandomValues(u),h="weakmap:rand:"+Array.prototype.map.call(u,(function(t){return(t%36).toString(36)})).join("")+"___"}if(s(Object,"getOwnPropertyNames",{value:function(t){return o(t).filter(y)}}),"getPropertyNames"in Object){var l=Object.getPropertyNames;s(Object,"getPropertyNames",{value:function(t){return l(t).filter(y)}})}!function(){var t=Object.freeze;s(Object,"freeze",{value:function(e){return v(e),t(e)}});var e=Object.seal;s(Object,"seal",{value:function(t){return v(t),e(t)}});var r=Object.preventExtensions;s(Object,"preventExtensions",{value:function(t){return v(t),r(t)}})}();var p=!1,f=0,d=function(){this instanceof d||b();var t=[],e=[],r=f++;return Object.create(d.prototype,{get___:{value:m((function(n,i){var o,s=v(n);return s?r in s?s[r]:i:(o=t.indexOf(n))>=0?e[o]:i}))},has___:{value:m((function(e){var n=v(e);return n?r in n:t.indexOf(e)>=0}))},set___:{value:m((function(n,i){var o,s=v(n);return s?s[r]=i:(o=t.indexOf(n))>=0?e[o]=i:(o=t.length,e[o]=i,t[o]=n),this}))},delete___:{value:m((function(n){var i,o,s=v(n);return s?r in s&&delete s[r]:!((i=t.indexOf(n))<0)&&(o=t.length-1,t[i]=void 0,e[i]=e[o],t[i]=t[o],t.length=o,e.length=o,!0)}))}})};d.prototype=Object.create(Object.prototype,{get:{value:function(t,e){return this.get___(t,e)},writable:!0,configurable:!0},has:{value:function(t){return this.has___(t)},writable:!0,configurable:!0},set:{value:function(t,e){return this.set___(t,e)},writable:!0,configurable:!0},delete:{value:function(t){return this.delete___(t)},writable:!0,configurable:!0}}),"function"==typeof r?function(){function n(){this instanceof d||b();var t,n=new r,i=void 0,o=!1;return t=e?function(t,e){return n.set(t,e),n.has(t)||(i||(i=new d),i.set(t,e)),this}:function(t,e){if(o)try{n.set(t,e)}catch(r){i||(i=new d),i.set___(t,e)}else n.set(t,e);return this},Object.create(d.prototype,{get___:{value:m((function(t,e){return i?n.has(t)?n.get(t):i.get___(t,e):n.get(t,e)}))},has___:{value:m((function(t){return n.has(t)||!!i&&i.has___(t)}))},set___:{value:m(t)},delete___:{value:m((function(t){var e=!!n.delete(t);return i&&i.delete___(t)||e}))},permitHostObjects___:{value:m((function(t){if(t!==g)throw new Error("bogus call to permitHostObjects___");o=!0}))}})}e&&"undefined"!=typeof Proxy&&(Proxy=void 0),n.prototype=d.prototype,t.exports=n,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),t.exports=d)}function g(t){t.permitHostObjects___&&t.permitHostObjects___(g)}function y(t){return!("weakmap:"==t.substr(0,"weakmap:".length)&&"___"===t.substr(t.length-3))}function v(t){if(t!==Object(t))throw new TypeError("Not an object: "+t);var e=t[h];if(e&&e.key===t)return e;if(a(t)){e={key:t};try{return s(t,h,{value:e,writable:!1,enumerable:!1,configurable:!1}),e}catch(t){return}}}function m(t){return t.prototype=null,Object.freeze(t)}function b(){p||"undefined"==typeof console||(p=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()})),Mt="undefined"!=typeof WeakMap?WeakMap:Et,At=Object;Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(t){return Object(t)===t},Object.getValueOf=function(t){return t&&"function"==typeof t.valueOf&&(t=t.valueOf()),t};var Pt=new Mt;Object.hash=function(t){return t&&"function"==typeof t.hash?""+t.hash():Object(t)===t?(Pt.has(t)||Pt.set(t,Math.random().toString(36).slice(2)),Pt.get(t)):""+t};var kt=Object.prototype.hasOwnProperty;Object.owns=function(t,e){return kt.call(t,e)},Object.has=function(t,e){if("object"!=typeof t)throw new Error("Object.has can't accept non-object: "+typeof t);if(t&&"function"==typeof t.has)return t.has(e);if("string"==typeof e)return e in t&&t[e]!==Object.prototype[e];throw new Error("Key must be a string for Object.has on plain objects")},Object.get=function(t,e,r){if("object"!=typeof t)throw new Error("Object.get can't accept non-object: "+typeof t);return t&&"function"==typeof t.get?t.get(e,r):Object.has(t,e)?t[e]:r},Object.set=function(t,e,r){t&&"function"==typeof t.set?t.set(e,r):t[e]=r},Object.addEach=function(t,e,r){var n=3!==arguments.length||r;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var i=0;i<e.length;i++)t[i]=e[i];else for(var o,s=Object.keys(e),a=0;o=s[a];a++)!n&&Object.owns(t,o)||(t[o]=e[o]);else!0===e.isMap?e.forEach((function(e,r){t[r]=e})):e.forEach((function(e){t[e[0]]=e[1]}));else;return t},Object.defineEach=function(t,e,r,n,i,o){var s=3!==arguments.length||r;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var a=0;a<e.length;a++)Object.defineProperty(t,a,{value:e[a],writable:o,configurable:n,enumerable:i});else for(var h,c=Object.keys(e),u=0;h=c[u];u++)!s&&Object.owns(t,h)||Object.defineProperty(t,h,{value:e[h],writable:o,configurable:n,enumerable:i});else!0===e.isMap?e.forEach((function(e,r){Object.defineProperty(t,r,{value:e,writable:o,configurable:n,enumerable:i})})):e.forEach((function(e){Object.defineProperty(t,e[0],{value:e[1],writable:o,configurable:n,enumerable:i})}));else;return t},Object.forEach=function(t,e,r){for(var n,i=Object.keys(t),o=0;n=i[o];o++)e.call(r,t[n],n,t)},Object.map=function(t,e,r){for(var n,i=Object.keys(t),o=0,s=[];n=i[o];o++)s.push(e.call(r,t[n],n,t));return s},Object.values=function(t){return Object.map(t,Function.identity)},Object.concat=function(){for(var t={},e=0;e<arguments.length;e++)Object.addEach(t,arguments[e]);return t},Object.from=Object.concat,Object.is=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e},Object.equals=function(t,e,r,n){if(r=r||Object.equals,(t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return!0;if(Object.isObject(t)){if((n=n||new Mt).has(t))return!0;n.set(t,!0)}if(Object.isObject(t)&&"function"==typeof t.equals)return t.equals(e,r,n);if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(t,r,n);if(Object.isObject(t)&&Object.isObject(e)&&Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){for(var i in t)if(!r(t[i],e[i],r,n))return!1;for(var i in e)if(!(i in t)||!r(e[i],t[i],r,n))return!1;return!0}return t!=t&&e!=e||(!t||!e)&&t===e},Object.compare=function(t,e){if((t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return 0;var r=typeof t,n=typeof e;return"number"===r&&"number"===n?t-e:"string"===r&&"string"===n?t<e?-1/0:1/0:t&&"function"==typeof t.compare?t.compare(e):e&&"function"==typeof e.compare?-e.compare(t):0},Object.clone=function(t,e,r){if(t=Object.getValueOf(t),r=r||new Mt,void 0===e)e=1/0;else if(0===e)return t;if(Object.isObject(t)){if(!r.has(t))if(t&&"function"==typeof t.clone)r.set(t,t.clone(e,r));else{var n=Object.getPrototypeOf(t);if(null!==n&&n!==Object.prototype)throw new Error("Can't clone "+t);var i=Object.create(n);for(var o in r.set(t,i),t)i[o]=Object.clone(t[o],e-1,r)}return r.get(t)}return t},Object.clear=function(t){if(t&&"function"==typeof t.clear)t.clear();else for(var e=Object.keys(t),r=e.length;r;)delete t[e[--r]];return t};var Lt=Dt;function Dt(){throw new Error("Can't construct. GenericOrder is a mixin.")}Dt.prototype.equals=function(t,e){return e=e||this.contentEquals||At.equals,this===t||!!t&&(this.length===t.length&&this.zip(t).every((function(t){return e(t[0],t[1])})))},Dt.prototype.compare=function(t,e){if(e=e||this.contentCompare||At.compare,this===t)return 0;if(!t)return 1;var r=Math.min(this.length,t.length),n=this.zip(t).reduce((function(t,n,i){return 0===t?i>=r?t:e(n[0],n[1]):t}),0);return 0===n?this.length-t.length:n},Dt.prototype.toJSON=function(){return this.toArray()};var St=Array.prototype.splice,It=Array.prototype.slice;function Tt(t,e){Object.defineProperty(Array.prototype,t,{value:e,writable:!0,configurable:!0,enumerable:!1})}Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.nativeFrom=Array.from,Array.from=function(t,e,r){if(Symbol&&t&&"function"==typeof t[Symbol.iterator])return Array.nativeFrom(t,e,r);var n=[];return n.addEach(t),n},Array.unzip=function(t){for(var e=[],r=1/0,n=0;n<t.length;n++){var i=t[n];t[n]=i.toArray(),i.length<r&&(r=i.length)}for(n=0;n<t.length;n++){i=t[n];for(var o=0;o<i.length;o++)o<r&&o in i&&(e[o]=e[o]||[],e[o][n]=i[o])}return e},Tt("addEach",Ot.prototype.addEach),Tt("deleteEach",Ot.prototype.deleteEach),Tt("toArray",Ot.prototype.toArray),Tt("toObject",Ot.prototype.toObject),Tt("all",Ot.prototype.all),Tt("any",Ot.prototype.any),Tt("min",Ot.prototype.min),Tt("max",Ot.prototype.max),Tt("sum",Ot.prototype.sum),Tt("average",Ot.prototype.average),Tt("only",Ot.prototype.only),Tt("flatten",Ot.prototype.flatten),Tt("zip",Ot.prototype.zip),Tt("enumerate",Ot.prototype.enumerate),Tt("group",Ot.prototype.group),Tt("sorted",Ot.prototype.sorted),Tt("reversed",Ot.prototype.reversed),Tt("constructClone",(function(t){var e=new this.constructor;return e.addEach(t),e})),Tt("has",(function(t,e){return-1!==this.findValue(t,e)})),Tt("get",(function(t,e){if(+t!==t)throw new Error("Indicies must be numbers");return!t in this?e:this[t]})),Tt("set",(function(t,e){return this[t]=e,!0})),Tt("add",(function(t){return this.push(t),!0})),Tt("delete",(function(t,e){var r=this.findValue(t,e);return-1!==r&&(this.spliceOne(r),!0)})),Tt("deleteAll",(function(t,e){e=e||this.contentEquals||Object.equals;for(var r=0,n=0;n<this.length;)e(t,this[n])?(this.swap(n,1),r++):n++;return r})),Array.prototype.find||Tt("find",(function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var o=e[i];if(t.call(n,o,i,e))return o;i++}}));var Rt={};function Bt(t,e){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==e&&!1===Rt.hasOwnProperty(t)&&(console.warn(t),Rt[t]++)}var Ft=Object.getOwnPropertyDescriptor(Array.prototype,"find").value;function Nt(t,e,r){this.array=t,this.start=null==e?0:e,this.end=r}if(Tt("find",(function(t,e,r){return"function"==typeof arguments[0]&&this instanceof Array?Ft.apply(this,arguments):(Bt("Array#find usage is deprecated please use Array#findValue"),this.findValue.apply(this,arguments))})),Tt("findValue",(function(t,e,r){if(r)throw new Error("Array#findValue does not support third argument: index");e=e||this.contentEquals||Object.equals;for(r=0;r<this.length;r++)if(r in this&&e(t,this[r]))return r;return-1})),Tt("findLast",(function(t,e){return Bt("Array#findLast function is deprecated please use Array#findLastValue instead."),this.findLastValue.apply(this,arguments)})),Tt("findLastValue",(function(t,e){e=e||this.contentEquals||Object.equals;var r=this.length;do{if(--r in this&&e(this[r],t))return r}while(r>0);return-1})),Tt("swap",(function(t,e,r){var n,i,o,s,a;if(t>this.length&&(this.length=t),void 0!==r){if(n=[t,e],Array.isArray(r)||(r=It.call(r)),o=0,(i=r.length)<1e3){for(;o<i;o++)n[o+2]=r[o];return St.apply(this,n)}for(a=St.apply(this,n);o<i;){for(n=[t+o,0],s=2;s<1002&&o<i;s++,o++)n[s]=r[o];St.apply(this,n)}return a}return void 0!==e?St.call(this,t,e):void 0!==t?St.call(this,t):[]})),Tt("peek",(function(){return this[0]})),Tt("poke",(function(t){this.length>0&&(this[0]=t)})),Tt("peekBack",(function(){if(this.length>0)return this[this.length-1]})),Tt("pokeBack",(function(t){this.length>0&&(this[this.length-1]=t)})),Tt("one",(function(){for(var t in this)if(Object.owns(this,t))return this[t]})),Array.prototype.clear||Tt("clear",(function(){return this.length=0,this})),Tt("compare",(function(t,e){var r,n,i;if(e=e||Object.compare,this===t)return 0;if(!t||!Array.isArray(t))return Lt.prototype.compare.call(this,t,e);for(n=this.length<t.length?this.length:t.length,r=0;r<n;r++)if(r in this){if(!(r in t))return-1;if(i=e(this[r],t[r]))return i}else if(r in t)return 1;return this.length-t.length})),Tt("equals",(function(t,e){e=e||Object.equals;var r=0,n=this.length;if(this===t)return!0;if(!t||!Array.isArray(t))return Lt.prototype.equals.call(this,t);if(n!==t.length)return!1;for(;r<n;++r)if(r in this){if(!(r in t))return!1;if(!e(this[r],t[r]))return!1}else if(r in t)return!1;return!0})),Tt("clone",(function(t,e){if(null==t)t=1/0;else if(0===t)return this;if((e=e||new Mt).has(this))return e.get(this);var r=new Array(this.length);for(var n in e.set(this,r),this)r[n]=Object.clone(this[n],t-1,e);return r})),Tt("iterate",(function(t,e){return new Nt(this,t,e)})),void 0===Array.prototype.spliceOne&&Tt("spliceOne",(function(t,e){var r=this.length;if(r)if(1===arguments.length){for(;t<r;)this[t]=this[t+1],t++;this.length--}else this[t]=e})),Tt("Iterator",Nt),Nt.prototype.__iterationObject=null,Object.defineProperty(Nt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Nt.prototype.next=function(){return this.start===(null==this.end?this.array.length:this.end)?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=this.array[this.start++],this._iterationObject},!RegExp.escape){var qt=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(qt,"\\$&")}}var Xt=Ht;function Ht(){throw new Error("Can't construct. GenericSet is a mixin.")}Ht.prototype.isSet=!0,Ht.prototype.union=function(t){var e=this.constructClone(this);return e.addEach(t),e},Ht.prototype.intersection=function(t){return this.constructClone(this.filter((function(e){return t.has(e)})))},Ht.prototype.difference=function(t){var e=this.constructClone(this);return e.deleteEach(t),e},Ht.prototype.symmetricDifference=function(t){var e=this.union(t),r=this.intersection(t);return e.difference(r)},Ht.prototype.deleteAll=function(t){return+this.delete(t)},Ht.prototype.equals=function(t,e){var r=this;return t&&"function"==typeof t.reduce&&this.length===t.length&&t.reduce((function(t,n){return t&&r.has(n,e)}),!0)},Ht.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(r,n,i,o,s){t.call(e,n,n,o,s)}),void 0)},Ht.prototype.toJSON=function(){return this.toArray()},Ht.prototype.contains=function(t){return this.has(t)},Ht.prototype.remove=function(t){return this.delete(t)},Ht.prototype.toggle=function(t){this.has(t)?this.delete(t):this.add(t)};var Yt=function(t,e){return t};Ht.prototype.valuesArray=function(){return this.map(Yt)};var zt=function(t,e){return[e,t]};Ht.prototype.entriesArray=function(){return this.map(zt)};var $t=Gt;function Gt(t,e,r){return Gt._init(Gt,this,t,e,r)}function Vt(t){this.head=t,this.at=t.next}function Wt(t){this.value=t,this.prev=null,this.next=null}Gt._init=function(t,e,r,n,i){if(!(e instanceof t))return new t(r,n,i);var o=e.head=new e.Node;o.next=o,o.prev=o,e.contentEquals=n||Object.equals,e.getDefault=i||Function.noop,e.length=0,e.addEach(r)},Gt.List=Gt,Object.addEach(Gt.prototype,Ot.prototype),Object.addEach(Gt.prototype,Lt.prototype),Gt.from=Ot.from,Gt.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.getDefault)},Gt.prototype.find=function(t,e,r){e=e||this.contentEquals;for(var n=this.head,i=this.scan(r,n.next);i!==n;){if(e(i.value,t))return i;i=i.next}},Gt.prototype.findLast=function(t,e,r){e=e||this.contentEquals;for(var n=this.head,i=this.scan(r,n.prev);i!==n;){if(e(i.value,t))return i;i=i.prev}},Gt.prototype.has=function(t,e){return!!this.find(t,e)},Gt.prototype.get=function(t,e){var r=this.find(t,e);return r?r.value:this.getDefault(t)},Gt.prototype.delete=function(t,e){var r=this.findLast(t,e);return!!r&&(r.delete(),this.length--,!0)},Gt.prototype.deleteAll=function(t,e){e=e||this.contentEquals;for(var r=this.head,n=r.next,i=0;n!==r;)e(t,n.value)&&(n.delete(),i++),n=n.next;return this.length-=i,i},Gt.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},Gt.prototype.add=function(t){var e=new this.Node(t);return this._addNode(e)},Gt.prototype._addNode=function(t){return this.head.addBefore(t),this.length++,!0},Gt.prototype.push=function(){for(var t=this.head,e=0;e<arguments.length;e++){var r=arguments[e],n=new this.Node(r);t.addBefore(n)}this.length+=arguments.length},Gt.prototype.unshift=function(){for(var t=this.head,e=0;e<arguments.length;e++){var r=arguments[e],n=new this.Node(r);t.addAfter(n),t=n}this.length+=arguments.length},Gt.prototype._shouldPop=function(){var t,e=this.head;return e.prev!==e&&(t=e.prev.value),t},Gt.prototype.pop=function(t,e){var r,n=this.head;if(n.prev!==n){r=n.prev.value;var i=this.length-1,o=t?t.call(this,r,i):void 0;n.prev.delete(),this.length--,e&&e.call(this,r,i,o)}return r},Gt.prototype.shift=function(t,e){var r,n=this.head;if(n.prev!==n){r=n.next.value;var i=t?t.call(this,r,0):void 0;n.next.delete(),this.length--,e&&e.call(this,r,0,i)}return r},Gt.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},Gt.prototype.poke=function(t){this.head!==this.head.next?this.head.next.value=t:this.push(t)},Gt.prototype.one=function(){return this.peek()},Gt.prototype.scan=function(t,e){var r=this.head;if("number"==typeof t){var n=t;if(n>=0)for(t=r.next;n&&(n--,(t=t.next)!=r););else for(t=r;n<0&&(n++,(t=t.prev)!=r););return t}return t||e},Gt.prototype.slice=function(t,e){var r=[],n=this.head;for(t=this.scan(t,n.next),e=this.scan(e,n);t!==e&&t!==n;)r.push(t.value),t=t.next;return r},Gt.prototype.splice=function(t,e){return this.swap(t,e,Array.prototype.slice.call(arguments,2))},Gt.prototype.swap=function(t,e,r,n,i){var o=t;t=this.scan(t,this.head),null==e&&(e=1/0),r=Array.from(r);for(var s=[],a=t;e--&&e>=0&&a!==this.head;)s.push(a.value),a=a.next;n&&n.call(this,t,r,s);a=t;var h=0;for(a=t;h<s.length;h++,a=a.next)a.delete();null==o&&a===this.head&&(a=this.head.next);for(h=0;h<r.length;h++){var c=new this.Node(r[h]);a.addBefore(c)}return this.length+=r.length-s.length,i&&i.call(this,t,r,s),s},Gt.prototype.reverse=function(){var t=this.head;do{var e=t.next;t.next=t.prev,t.prev=e,t=t.next}while(t!==this.head);return this},Gt.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))},Gt.prototype.reduce=function(t,e){for(var r=arguments[2],n=this.head,i=n.next;i!==n;)e=t.call(r,e,i.value,i,this),i=i.next;return e},Gt.prototype.reduceRight=function(t,e){for(var r=arguments[2],n=this.head,i=n.prev;i!==n;)e=t.call(r,e,i.value,i,this),i=i.prev;return e},Gt.prototype.updateIndexes=function(t,e){for(;t!==this.head;)t.index=e++,t=t.next},Gt.prototype.iterate=function(){return new Vt(this.head)},Vt.prototype.__iterationObject=null,Object.defineProperty(Vt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Vt.prototype.next=function(){if(this.at===this.head)this._iterationObject.done=!0,this._iterationObject.value=void 0;else{var t=this.at.value;this.at=this.at.next,this._iterationObject.value=t}return this._iterationObject},Gt.prototype.Node=Wt,Wt.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},Wt.prototype.addBefore=function(t){var e=this.prev;this.prev=t,t.prev=e,e.next=t,t.next=this},Wt.prototype.addAfter=function(t){var e=this.next;this.next=t,t.next=e,e.prev=t,t.prev=this};var Ut=Jt;function Jt(t,e){var r=e&&t&&t.values&&t.values();if(r&&"function"==typeof r.next)return r;if(!(this instanceof Jt))return new Jt(t);if(Array.isArray(t)||"string"==typeof t)return Jt.iterate(t);if((t=At(t))instanceof Jt)return t;if(t.next)this.next=function(){return t.next()};else if(t.iterate){var n=t.iterate();this.next=function(){return n.next()}}else{if("[object Function]"!==At.prototype.toString.call(t))throw new TypeError("Can't iterate "+t);this.next=t}}Jt.prototype.forEach=Ot.prototype.forEach,Jt.prototype.map=Ot.prototype.map,Jt.prototype.filter=Ot.prototype.filter,Jt.prototype.every=Ot.prototype.every,Jt.prototype.some=Ot.prototype.some,Jt.prototype.any=Ot.prototype.any,Jt.prototype.all=Ot.prototype.all,Jt.prototype.min=Ot.prototype.min,Jt.prototype.max=Ot.prototype.max,Jt.prototype.sum=Ot.prototype.sum,Jt.prototype.average=Ot.prototype.average,Jt.prototype.flatten=Ot.prototype.flatten,Jt.prototype.zip=Ot.prototype.zip,Jt.prototype.enumerate=Ot.prototype.enumerate,Jt.prototype.sorted=Ot.prototype.sorted,Jt.prototype.group=Ot.prototype.group,Jt.prototype.reversed=Ot.prototype.reversed,Jt.prototype.toArray=Ot.prototype.toArray,Jt.prototype.toObject=Ot.prototype.toObject,Jt.prototype.iterator=Ot.prototype.iterator,Jt.prototype.__iterationObject=null,At.defineProperty(Jt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Jt.prototype.constructClone=function(t){var e=[];return e.addEach(t),e},Jt.prototype.mapIterator=function(t){var e=Jt(this),r=arguments[1],n=0;if("[object Function]"!=At.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=t.call(r,e.next().value,n++,e);e._iterationObject.value=i}return e._iterationObject}))},Jt.prototype.filterIterator=function(t){var e=Jt(this),r=arguments[1],n=0;if("[object Function]"!=At.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){for(var i;;){if(!0===(i=e.next()).done)return i;if(t.call(r,i.value,n++,e))return i}}))},Jt.prototype.reduce=function(t){var e,r=Jt(this),n=arguments[1],i=arguments[2],o=0;if("[object Function]"!=At.prototype.toString.call(t))throw new TypeError;if(!0===(e=r.next()).done){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(n=arguments.length>1?t.call(i,n,e.value,o,r):e.value,o++;;){if(!0===(e=r.next()).done)return n;n=t.call(i,n,e.value,o,r),o++}},Jt.prototype.concat=function(){return Jt.concat(Array.prototype.concat.apply(this,arguments))},Jt.prototype.dropWhile=function(t){var e,r,n=Jt(this),i=arguments[1],o=!1,s=0;if("[object Function]"!=At.prototype.toString.call(t))throw new TypeError;for(;!0!==(r=n.next()).done;){if(!t.call(i,r.value,s,n)){o=!0,e=r.value;break}s++}return o?n.constructor([e]).concat(n):n.constructor([])},Jt.prototype.takeWhile=function(t){var e=Jt(this),r=arguments[1],n=0;if("[object Function]"!=At.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=e.next().value;t.call(r,i,n++,e)?e._iterationObject.value=i:(e._iterationObject.done=!0,e._iterationObject.value=void 0)}return e._iterationObject}))},Jt.prototype.zipIterator=function(){return Jt.unzip(Array.prototype.concat.apply(this,arguments))},Jt.prototype.enumerateIterator=function(t){return Jt.count(t).zipIterator(this)},Jt.iterate=function(t){var e;return e=0,new Jt((function(){if("object"==typeof t)for(;!(e in t);){if(e>=t.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}e+=1}else e>=t.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=t[e],e+=1),this._iterationObject}))},Jt.cycle=function(t,e){var r;return arguments.length<2&&(e=1/0),new Jt((function(){var n,i;return r&&(i=r()),r&&!0!==i.done||(e>0?(e--,n=Jt.iterate(t),i=(r=n.next.bind(n))()):(this._iterationObject.done=!0,i=this._iterationObject)),i}))},Jt.concat=function(t){var e;return t=Jt(t),new Jt((function(){var r,n;return e&&(n=e()),n&&!0!==n.done?n:!1===(n=t.next()).done?(r=Jt(n.value),(e=r.next.bind(r))()):n}))},Jt.unzip=function(t){return 0===(t=Jt(t).map(Jt)).length?new Jt([]):new Jt((function(){var e,r,n=t.map((function(t){return!0===(r=t.next()).done&&(e=!0),r.value}));return e?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=n,this._iterationObject}))},Jt.zip=function(){return Jt.unzip(Array.prototype.slice.call(arguments))},Jt.chain=function(){return Jt.concat(Array.prototype.slice.call(arguments))},Jt.range=function(t,e,r){return arguments.length<3&&(r=1),arguments.length<2&&(e=t,t=0),t=t||0,r=r||1,new Jt((function(){t>=e&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var n=t;return t+=r,this._iterationObject.value=n,this._iterationObject}))},Jt.count=function(t,e){return Jt.range(t,1/0,e)},Jt.repeat=function(t,e){return new Jt.range(e).mapIterator((function(){return t}))};var Kt=Zt;function Zt(){throw new Error("Can't construct. GenericMap is a mixin.")}function Qt(t,e){this.key=t,this.value=e}Zt.prototype.isMap=!0,Zt.prototype.addEach=function(t){var e;if(t&&At(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);else At.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},Zt.prototype.get=function(t,e){var r=this.store.get(new this.Item(t));return r?r.value:arguments.length>1?(console.log("Use of a second argument as default value is deprecated to match standards"),e):this.getDefault(t)},Zt.prototype.set=function(t,e){var r=new this.Item(t,e),n=this.store.get(r);return n?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n.value),n.value=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.store.add(r)&&this.length++,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},Zt.prototype.add=function(t,e){return this.set(e,t)},Zt.prototype.has=function(t){return this.store.has(new this.Item(t))},Zt.prototype.delete=function(t){var e=new this.Item(t);if(this.store.has(e)){var r=this.store.get(e).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,r),this.store.delete(e),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0}return!1},Zt.prototype.clear=function(){var t,e;if(this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),this.store.clear(),this.length=0,this.dispatchesMapChanges)for(var r=0;e=t[r];r++)this.dispatchMapChange(e)},Zt.prototype.reduce=function(t,e,r){return this.store.reduce((function(e,n){return t.call(r,e,n.value,n.key,this)}),e,this)},Zt.prototype.reduceRight=function(t,e,r){return this.store.reduceRight((function(e,n){return t.call(r,e,n.value,n.key,this)}),e,this)},Zt.prototype.keysArray=function(){return this.map((function(t,e){return e}))},Zt.prototype.keys=function(){return new Ut(this.keysArray(),!0)},Zt.prototype.valuesArray=function(){return this.map(Function.identity)},Zt.prototype.values=function(){return new Ut(this.valuesArray(),!0)},Zt.prototype.entriesArray=function(){return this.map((function(t,e){return[e,t]}))},Zt.prototype.entries=function(){return new Ut(this.entriesArray(),!0)},Zt.prototype.items=function(){return this.entriesArray()},Zt.prototype.equals=function(t,e){return e=e||At.equals,this===t||(t&&"function"==typeof t.every?t.length===this.length&&t.every((function(t,r){return e(this.get(r),t)}),this):At.keys(t).length===this.length&&At.keys(t).every((function(r){return e(this.get(r),t[r])}),this))},Zt.prototype.toJSON=function(){return this.entriesArray()},Zt.prototype.Item=Qt,Qt.prototype.equals=function(t){return At.equals(this.key,t.key)&&At.equals(this.value,t.value)},Qt.prototype.compare=function(t){return At.compare(this.key,t.key)};var te=ee;function ee(t,e){if(!(this instanceof ee))return new ee(t,e);e=e||Function.noop,this.getDefault=e,this.store=Object.create(null),this.length=0,this.addEach(t)}ee.Dict=ee,Object.addEach(ee.prototype,Ot.prototype),Object.addEach(ee.prototype,Kt.prototype),ee.from=Ot.from,ee.prototype.constructClone=function(t){return new this.constructor(t,this.getDefault)},ee.prototype.assertString=function(t){if("string"!=typeof t)throw new TypeError("key must be a string but Got "+t)},Object.defineProperty(ee.prototype,"$__proto__",{writable:!0}),Object.defineProperty(ee.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&void 0!==this._protoValue}}),Object.defineProperty(ee.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(t){this.$__proto__=t}}),Object.defineProperty(ee.prototype,"size",Ot._sizePropertyDescriptor),ee.prototype.get=function(t,e){return this.assertString(t),"__proto__"===t?this._hasProto?this._protoValue:arguments.length>1?e:this.getDefault(t):t in this.store?this.store[t]:arguments.length>1?e:this.getDefault(t)},ee.prototype.set=function(t,e){this.assertString(t);var r="__proto__"===t;return(r?this._hasProto:t in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,r?this._protoValue:this.store[t]),r?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.length++,r?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!0)},ee.prototype.has=function(t){return this.assertString(t),"__proto__"===t?this._hasProto:t in this.store},ee.prototype.delete=function(t){return this.assertString(t),"__proto__"===t?!!this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0):t in this.store&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)},ee.prototype.clear=function(){var t;for(t in this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0)),this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0);this.length=0},ee.prototype.reduce=function(t,e,r){this._hasProto&&(e=t.call(r,e,"$__proto__","__proto__",this));var n=this.store;for(var i in this.store)e=t.call(r,e,n[i],i,this);return e},ee.prototype.reduceRight=function(t,e,r){var n=this,i=this.store;return e=Object.keys(this.store).reduceRight((function(e,o){return t.call(r,e,i[o],o,n)}),e),this._hasProto?t.call(r,e,this._protoValue,"__proto__",n):e},ee.prototype.one=function(){var t;for(t in this.store)return this.store[t];return this._protoValue},ee.prototype.toJSON=function(){return this.toObject()};var re=ne;function ne(){}ne.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},ne.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},ne.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"};var ie=oe;function oe(t,e,r,n){if(!(this instanceof oe))return new oe(t,e,r,n);e=e||Object.equals,r=r||Object.hash,n=n||Function.noop,this.contentEquals=e,this.contentHash=r,this.getDefault=n;var i=this;this.buckets=new this.Buckets(null,(function(){return new i.Bucket})),this.length=0,this.addEach(t)}oe.FastSet=oe,Object.addEach(oe.prototype,Ot.prototype),Object.addEach(oe.prototype,Xt.prototype),oe.from=Ot.from,oe.prototype.Buckets=te,oe.prototype.Bucket=$t,oe.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},oe.prototype.has=function(t){var e=this.contentHash(t);return this.buckets.get(e).has(t)},oe.prototype.get=function(t,e){if(e)throw new Error("FastSet#get does not support second argument: equals");var r=this.contentHash(t),n=this.buckets;return n.has(r)?n.get(r).get(t):this.getDefault(t)},oe.prototype.delete=function(t,e){if(e)throw new Error("FastSet#delete does not support second argument: equals");var r=this.contentHash(t),n=this.buckets;if(n.has(r)){var i=n.get(r);if(i.delete(t))return this.length--,0===i.length&&n.delete(r),!0}return!1},oe.prototype.clear=function(){this.buckets.clear(),this.length=0},oe.prototype.add=function(t){var e=this.contentHash(t),r=this.buckets;return r.has(e)||r.set(e,new this.Bucket(null,this.contentEquals)),!r.get(e).has(t)&&(r.get(e).add(t),this.length++,!0)},oe.prototype.reduce=function(t,e){var r=arguments[2],n=this.buckets,i=0;return n.reduce((function(e,n){return n.reduce((function(e,n){return t.call(r,e,n,i++,this)}),e,this)}),e,this)},oe.prototype.one=function(){if(this.length>0)return this.buckets.one().one()},oe.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()},oe.prototype.log=function(t,e,r,n){t=t||re.unicodeSharp,e=e||this.logNode,r||(r=console.log,n=console),r=r.bind(n);for(var i,o,s,a,h=this.buckets,c=h.size,u=h.keys(),l=0;i=u.next().value;)l===c-1?(o=t.fromAbove,s=" "):0===l?(o=t.branchDown,s=t.strafe):(o=t.fromBoth,s=t.strafe),a=h.get(i),r.call(n,o+t.through+t.branchDown+" "+i),a.forEach((function(i,o){var h,c,u;o===a.head.prev?(h=t.fromAbove,c=" "):(h=t.fromBoth,c=t.strafe),e(o,(function(e){u?r.call(n,s+" "+c+"  "+e):(r.call(n,s+" "+h+t.through+t.through+e),u=!0)}),(function(e){r.call(n,s+" "+t.strafe+"  "+e)}))})),l++},oe.prototype.logNode=function(t,e){var r=t.value;Object(r)===r?JSON.stringify(r,null,4).split("\n").forEach((function(t){e(" "+t)})):e(" "+r)};var se=n((function(t){var e,n;void 0!==r.Set&&"function"==typeof r.Set.prototype.values&&((e=t.exports=r.Set).Set=e,e.prototype.reduce=function(t,e){var r=arguments[2];return this.forEach((function(n){e=t.call(r,e,n,this)})),e},e.prototype.reduceRight=function(t,e){for(var r,n=arguments[2],i=this.values(),o=this.size,s=new Array(this.size),a=o;r=i.next().value;)s[--a]=r;for(;a<o;)e=t.call(n,e,s[a++],this);return e},e.prototype.equals=function(t,e){var r=this;return t&&"function"==typeof t.reduce&&this.size===(t.size||t.length)&&t.reduce((function(t,n){return t&&r.has(n,e)}),!0)},e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.one=function(){if(this.size>0)return this.values().next().value},e.prototype.pop=function(){if(this.size){for(var t,e,r=this.values();t=r.next().value;)e=t;return this.delete(e,this.size-1),e}},e.prototype.shift=function(){if(this.size){var t=this.values().next().value;return this.delete(t,0),t}},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),e.from=function(t){var e=new this;return e.addEach(t),e},Object.addEach(e.prototype,Ot.prototype,!1),Object.addEach(e.prototype,Xt.prototype,!1)),(n=function t(e,r,n,i){return t._init(t,this,e,r,n,i)})._init=function(t,e,r,n,i,o){if(!(e instanceof t))return new t(r,n,i,o);n=n||Object.equals,i=i||Object.hash,o=o||Function.noop,e.contentEquals=n,e.contentHash=i,e.getDefault=o,e.order=new e.Order(void 0,n),e.store=new e.Store(void 0,(function(t,e){return n(t.value,e.value)}),(function(t){return i(t.value)})),e.length=0,e.addEach(r)},n.Set=n,n.CollectionsSet=n,Object.addEach(n.prototype,Ot.prototype),Object.addEach(n.prototype,Xt.prototype),n.from=Ot.from,Object.defineProperty(n.prototype,"size",Ot._sizePropertyDescriptor),n.prototype.Order=$t,n.prototype.Store=ie,n.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},n.prototype.has=function(t){var e=new this.order.Node(t);return this.store.has(e)},n.prototype.get=function(t,e){if(e)throw new Error("Set#get does not support second argument: equals");var r=new this.order.Node(t);return(r=this.store.get(r))?r.value:this.getDefault(t)},n.prototype.add=function(t){var e=new this.order.Node(t);if(!this.store.has(e)){this.length;return this.order.add(t),e=this.order.head.prev,this.store.add(e),this.length++,!0}return!1},n.prototype.delete=function(t,e){if(e)throw new Error("Set#delete does not support second argument: equals");var r=new this.order.Node(t);return!!this.store.has(r)&&(r=this.store.get(r),this.store.delete(r),this.order.splice(r,1),this.length--,!0)},n.prototype.pop=function(){if(this.length){var t=this.order.head.prev.value;return this.delete(t),t}},n.prototype.shift=function(){if(this.length){var t=this.order.head.next.value;return this.delete(t),t}},n.prototype.one=function(){if(this.length>0)return this.store.one().value},n.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(n.prototype,"_clear",{value:n.prototype.clear}),n.prototype.reduce=function(t,e){var r=arguments[2],n=this.order,i=0;return n.reduce((function(e,n){return t.call(r,e,n,i++,this)}),e,this)},n.prototype.reduceRight=function(t,e){var r=arguments[2],n=this.order,i=this.length-1;return n.reduceRight((function(e,n){return t.call(r,e,n,i--,this)}),e,this)},n.prototype.iterate=function(){return this.order.iterate()},n.prototype.values=function(){return new Ut(this.valuesArray(),!0)},n.prototype.log=function(){var t=this.store;return t.log.apply(t,arguments)},e?(e.prototype.valuesArray=Xt.prototype.valuesArray,e.prototype.entriesArray=Xt.prototype.entriesArray,t.exports=e,e.CollectionsSet=n):t.exports=n})),ae=n((function(t){var e,n,i;if(void 0!==r.Map&&"function"==typeof r.Set.prototype.values){var o;n=e=t.exports=r.Map,e.Map=e,o={}.__proto__===Object.prototype?function(){this.__proto__=f}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(e.prototype,"makeObservable",{value:o,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(e.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),e.prototype.constructClone=function(t){return new this.constructor(t)},e.prototype.isMap=!0,e.prototype.addEach=function(t){if(t&&Object(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(var e=0;e<t.length;e++)this.add(t[e],e);else Object.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},e.prototype.add=function(t,e){return this.set(e,t)},e.prototype.reduce=function(t,e){var r=arguments[2];return this.forEach((function(n,i,o){e=t.call(r,e,n,i,this)})),e},e.prototype.reduceRight=function(t,e){for(var r,n=arguments[2],i=this.keys(),o=this.size,s=new Array(this.size),a=0;r=i.next().value;)s[--o]=r;for(;a++<o;)e=t.call(n,e,this.get(s[a]),s[a],this);return e},e.prototype.equals=function(t,e){return e=e||Object.equals,this===t||(t&&"function"==typeof t.every?t.size===this.size&&t.every((function(t,r){return e(this.get(r),t)}),this):Object.keys(t).length===this.size&&Object.keys(t).every((function(r){return e(this.get(r),t[r])}),this))};var s=function(t,e){return e};e.prototype.keysArray=function(){return this.map(s)};var a=function(t,e){return t};e.prototype.valuesArray=function(){return this.map(a)};var h=function(t,e){return[e,t]};e.prototype.entriesArray=function(){return this.map(h)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.items=function(){return this.entriesArray()},e.from=function(t){var e=new this;return e.addEach(t),e},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0});var c=e.prototype.clear,u=e.prototype.set,l=e.prototype.delete,p={clear:{value:function(){var t;this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),c.call(this),this.dispatchesMapChanges&&t.forEach((function(t){this.dispatchMapChange(t)}),this)},writable:!0,configurable:!0},set:{value:function(t,e){var r=this.get(t);return r?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,r),u.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),u.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},writable:!0,configurable:!0},delete:{value:function(t){return!!this.has(t)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.get(t)),l.call(this,t),this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)}}};Object.addEach(e.prototype,Ot.prototype,!1);var f=Object.create(e.prototype,p)}var d=se.CollectionsSet;i=e=function t(e,r,n,i){if(!(this instanceof t))return new t(e,r,n,i);r=r||Object.equals,n=n||Object.hash,i=i||Function.noop,this.contentEquals=r,this.contentHash=n,this.getDefault=i,this.store=new d(void 0,(function(t,e){return r(t.key,e.key)}),(function(t){return n(t.key)})),this.length=0,this.addEach(e)},e.Map=e,Object.addEach(e.prototype,Ot.prototype),Object.addEach(e.prototype,Kt.prototype),Object.defineProperty(e.prototype,"size",Ot._sizePropertyDescriptor),e.from=Ot.from,e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.log=function(t,e,r,n){e=e||this.logNode,this.store.log(t,(function(t,r,n){e(t.value.value,r,n)}),r,n)},e.prototype.logNode=function(t,e){e(" key: "+t.key),e(" value: "+t.value)},n?(t.exports=n,n.CollectionsMap=i):t.exports=i})),he=n((function(t){var e=t.exports.ObjectChangeDescriptor=function(t){return this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(e.prototype,{name:{value:null,writable:!0},isActive:{value:!1,writable:!0},_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new this.willChangeListenersRecordConstructor(this.name))}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new this.changeListenersRecordConstructor(this.name))}},changeListenersRecordConstructor:{value:i,writable:!0},willChangeListenersRecordConstructor:{value:s,writable:!0}});var r=t.exports.ListenerGhost=Object.create(null),n=new ae;function i(t){var e=n.get(t);return e||(e="handle",e+=t,e+="Change",n.set(t,e)),this._current=null,this._current=null,this.specificHandlerMethodName=e,this}t.exports.ChangeListenersRecord=i,Object.defineProperties(i.prototype,{_current:{value:null,writable:!0},current:{get:function(){return this._current},set:function(t){this._current=t}},ListenerGhost:{value:r,writable:!0},ghostCount:{value:0,writable:!0},maxListenerGhostRatio:{value:.3,writable:!0},listenerGhostFilter:{value:function(t){return t!==this.ListenerGhost}},removeCurrentGostListenersIfNeeded:{value:function(){return this._current&&this.ghostCount/this._current.length>this.maxListenerGhostRatio&&(this.ghostCount=0,this._current=this._current.filter(this.listenerGhostFilter,this)),this._current}},dispatchBeforeChange:{value:!1,writable:!0},genericHandlerMethodName:{value:"handlePropertyChange",writable:!0}}),t.exports.WillChangeListenersRecord=s;var o=new ae;function s(t){var e=o.get(t);return e||(e="handle",e+=t,e+="WillChange",o.set(t,e)),this.specificHandlerMethodName=e,this}s.prototype=new i,s.prototype.constructor=s,s.prototype.genericHandlerMethodName="handlePropertyWillChange"})),ce=(he.ObjectChangeDescriptor,he.ListenerGhost,he.ChangeListenersRecord,he.WillChangeListenersRecord,ue);function ue(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}var le=he.ObjectChangeDescriptor,pe=he.ListenerGhost;ue.debug=!0;var fe=new Mt,de=new ae;function ge(t,e,r,n){if(t&&t._current){var i,o,s,a,h,c=t.specificHandlerMethodName,u=t.genericHandlerMethodName,l=pe;if(Array.isArray(t._current)){for(s=0,a=(i=t.removeCurrentGostListenersIfNeeded()).length;s<a;s++)if((h=i[s])!==l){if(!(o=h[c]||h[u]||h).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(h,r,e,n)}}else{if(!(o=(h=t._current)[c]||h[u]||h).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(h,r,e,n)}}}ue.ObjectChangeDescriptor=function(){},ue.prototype.getOwnPropertyChangeDescriptor=function(t){var e,r=fe.get(this);if(r||(r=Object.create(null),fe.set(this,r)),void 0===(e=r[t])){var n=de.get(t);return n||(n=(n=String(t))&&n[0].toUpperCase()+n.slice(1),de.set(t,n)),r[t]=new le(n)}return e},ue.prototype.hasOwnPropertyChangeDescriptor=function(t){var e=fe.get(this);return!!e&&(!t||void 0!==e[t])},ue.prototype.addOwnPropertyChangeListener=function(t,e,r){this.makeObservable&&!this.isObservable&&this.makeObservable();var n=ue.getOwnPropertyChangeDescriptor(this,t),i=r?n.willChangeListeners:n.changeListeners;ue.makePropertyObservable(this,t),i._current?Array.isArray(i._current)?i._current.push(e):i._current=[i._current,e]:i._current=e;var o=this;return function(){ue.removeOwnPropertyChangeListener(o,t,e,r),o=null}},ue.prototype.addBeforeOwnPropertyChangeListener=function(t,e){return ue.addOwnPropertyChangeListener(this,t,e,!0)},ue.prototype.removeOwnPropertyChangeListener=function t(e,r,n){var i,o=ue.getOwnPropertyChangeDescriptor(this,e);if((i=n?o._willChangeListeners:o._changeListeners)&&i._current)if(i._current===r)i._current=null;else{var s=i._current.lastIndexOf(r);if(-1===s)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));o.isActive?(i.ghostCount=i.ghostCount+1,i._current[s]=t.ListenerGhost):i._current.spliceOne(s)}},ue.prototype.removeOwnPropertyChangeListener.ListenerGhost=pe,ue.prototype.removeBeforeOwnPropertyChangeListener=function(t,e){return ue.removeOwnPropertyChangeListener(this,t,e,!0)},ue.prototype.dispatchOwnPropertyChange=function t(e,r,n){var i,o=ue.getOwnPropertyChangeDescriptor(this,e);if(!o.isActive){o.isActive=!0,i=n?o._willChangeListeners:o._changeListeners;try{t.dispatchEach(i,e,r,this)}finally{o.isActive=!1}}},ue.prototype.dispatchOwnPropertyChange.dispatchEach=ge,ge.ListenerGhost=pe,ue.prototype.dispatchBeforeOwnPropertyChange=function(t,e){return ue.dispatchOwnPropertyChange(this,t,e,!0)};var ye=new Mt,ve=(new Mt,{get:void 0,set:void 0,configurable:!0,enumerable:!1});ue.prototype.makePropertyObservable=function(t){var e=ye.get(this);if(!e||void 0===e.get(t)){if(!e){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(t)+" observable on "+this+" because object is not extensible");e=new ae,ye.set(this,e)}var r,n=this;do{if(r=Object.getOwnPropertyDescriptor(n,t))break;n=Object.getPrototypeOf(n)}while(n);if(r){if(!r.configurable)return;if(!r.writable&&!r.set)return}else r={value:void 0,enumerable:!0,writable:!0,configurable:!0};e.set(t,r),"value"in r?(ve.get=function t(){return t.overriddenDescriptor.value},ve.set=function t(e){var r,n,i=t.overriddenDescriptor;if(e!==i.value){if(!(n=(r=t.descriptor).isActive)){r.isActive=!0;try{t.dispatchEach(r._willChangeListeners,t.key,i.value,this)}finally{}}if(i.value=e,!n)try{t.dispatchEach(r._changeListeners,t.key,e,this)}finally{r.isActive=!1}}},ve.set.dispatchEach=ge,ve.set.key=t,ve.get.overriddenDescriptor=ve.set.overriddenDescriptor=r,ve.set.descriptor=fe.get(this)[t],ve.enumerable=r.enumerable,ve.configurable=!0):(ve.get=r.get,ve.set=function e(){var r,n,i,o=e.overriddenGetter.call(this);if(1===arguments.length?e.overriddenSetter.call(this,arguments[0]):2===arguments.length?e.overriddenSetter.call(this,arguments[0],arguments[1]):e.overriddenSetter.apply(this,arguments),(i=e.overriddenGetter.call(this))!==o){if(!(n=(r=e.descriptor).isActive)){r.isActive=!0;try{e.dispatchEach(r._willChangeListeners,t,o,this)}finally{}}if(!n)try{e.dispatchEach(r._changeListeners,t,i,this)}finally{r.isActive=!1}}},ve.enumerable=r.enumerable,ve.configurable=!0,ve.set.dispatchEach=ge,ve.set.overriddenSetter=r.set,ve.set.overriddenGetter=r.get,ve.set.descriptor=fe.get(this)[t]),Object.defineProperty(this,t,ve)}},ue.getOwnPropertyChangeDescriptor=function(t,e){return t.getOwnPropertyChangeDescriptor?t.getOwnPropertyChangeDescriptor(e):ue.prototype.getOwnPropertyChangeDescriptor.call(t,e)},ue.hasOwnPropertyChangeDescriptor=function(t,e){return t.hasOwnPropertyChangeDescriptor?t.hasOwnPropertyChangeDescriptor(e):ue.prototype.hasOwnPropertyChangeDescriptor.call(t,e)},ue.addOwnPropertyChangeListener=function(t,e,r,n){if(Object.isObject(t))return t.addOwnPropertyChangeListener?t.addOwnPropertyChangeListener(e,r,n):this.prototype.addOwnPropertyChangeListener.call(t,e,r,n)},ue.removeOwnPropertyChangeListener=function(t,e,r,n){if(Object.isObject(t))return t.removeOwnPropertyChangeListener?t.removeOwnPropertyChangeListener(e,r,n):ue.prototype.removeOwnPropertyChangeListener.call(t,e,r,n)},ue.dispatchOwnPropertyChange=function(t,e,r,n){if(Object.isObject(t))return t.dispatchOwnPropertyChange?t.dispatchOwnPropertyChange(e,r,n):ue.prototype.dispatchOwnPropertyChange.call(t,e,r,n)},ue.addBeforeOwnPropertyChangeListener=function(t,e,r){return ue.addOwnPropertyChangeListener(t,e,r,!0)},ue.removeBeforeOwnPropertyChangeListener=function(t,e,r){return ue.removeOwnPropertyChangeListener(t,e,r,!0)},ue.dispatchBeforeOwnPropertyChange=function(t,e,r){return ue.dispatchOwnPropertyChange(t,e,r,!0)},ue.makePropertyObservable=function(t,e){return t.makePropertyObservable?t.makePropertyObservable(e):ue.prototype.makePropertyObservable.call(t,e)};var me=he.ObjectChangeDescriptor,be=he.ChangeListenersRecord,_e=he.ListenerGhost,we=new Mt;function xe(t){this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}xe.prototype=new me,xe.prototype.constructor=xe,xe.prototype.changeListenersRecordConstructor=je,xe.prototype.willChangeListenersRecordConstructor=Ee,Object.defineProperty(xe.prototype,"active",{get:function(){return this._active||(this._active=this._current?this._current.slice():[])}});var Oe=new ae;function je(t){var e=Oe.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeChange",Oe.set(t,e)),this.specificHandlerMethodName=e,this}je.prototype=new be,je.prototype.constructor=je;var Ce=new ae;function Ee(t){var e=Ce.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeWillChange",Ce.set(t,e)),this.specificHandlerMethodName=e,this}Ee.prototype=new be,Ee.prototype.constructor=Ee;var Me=Ae;function Ae(){throw new Error("Can't construct. RangeChanges is a mixin.")}Ae.prototype.getAllRangeChangeDescriptors=function(){return we.has(this)||we.set(this,new ae),we.get(this)},Ae.prototype.getRangeChangeDescriptor=function(t){var e=this.getAllRangeChangeDescriptors();return t=t||"",e.has(t)||e.set(t,new xe(t)),e.get(t)};var Pe=new Mt,ke={get:function(){return Pe.get(this)},set:function(t){return Pe.set(this,t)},configurable:!0,enumerable:!1};Ae.prototype.addRangeChangeListener=function(t,e,r){!this.isObservable&&this.makeObservable&&this.makeObservable();var n,i=this.getRangeChangeDescriptor(e);(n=r?i.willChangeListeners:i.changeListeners)._current?Array.isArray(n._current)?n._current.push(t):n._current=[n._current,t]:n._current=t,void 0===Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),"dispatchesRangeChanges")&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),"dispatchesRangeChanges",ke),this.dispatchesRangeChanges=!0;var o=this;return function(){o&&(o.removeRangeChangeListener(t,e,r),o=null)}},Ae.prototype.removeRangeChangeListener=function(t,e,r){var n,i=this.getRangeChangeDescriptor(e);if((n=r?i._willChangeListeners:i._changeListeners)._current)if(n._current===t)n._current=null;else{var o=n._current.lastIndexOf(t);if(-1===o)throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(e));i.isActive?(n.ghostCount=n.ghostCount+1,n._current[o]=_e):n._current.spliceOne(o)}},Ae.prototype.dispatchRangeChange=function(t,e,r,n){var i,o,s,a,h,c,u,l,p=this.getAllRangeChangeDescriptors(),f=p.values();for(p.dispatchBeforeChange=n;i=f.next().value;){if(i.isActive)return;if((o=n?i._willChangeListeners:i._changeListeners)&&o._current)if(s=o.specificHandlerMethodName,Array.isArray(o._current)){if(o._current.length){i.isActive=!0;try{for(u=o.removeCurrentGostListenersIfNeeded(),l=_e,a=0,h=u.length;a<h;a++)if((c=u[a])!==l)if(c[s])c[s](t,e,r,this,n);else{if(!c.call)throw new Error("Handler "+c+" has no method "+s+" and is not callable");c.call(this,t,e,r,this,n)}}finally{i.isActive=!1}}}else{i.isActive=!0;try{if((c=o._current)[s])c[s](t,e,r,this,n);else{if(!c.call)throw new Error("Handler "+c+" has no method "+s+" and is not callable");c.call(this,t,e,r,this,n)}}finally{i.isActive=!1}}}},Ae.prototype.addBeforeRangeChangeListener=function(t,e){return this.addRangeChangeListener(t,e,!0)},Ae.prototype.removeBeforeRangeChangeListener=function(t,e){return this.removeRangeChangeListener(t,e,!0)},Ae.prototype.dispatchBeforeRangeChange=function(t,e,r){return this.dispatchRangeChange(t,e,r,!0)};var Le=De;function De(t,e,r,n){if(!(this instanceof De))return new De(t,e,r,n);this.contentEquals=e||Object.equals,this.contentCompare=r||Object.compare,this.getDefault=n||Function.noop,this.root=null,this.length=0,this.addEach(t)}function Se(t){this.value=t,this.left=null,this.right=null,this.length=1}function Ie(t,e,r){if(this.set=t,this.prev=null,this.end=r,e){var n=this.set.findLeastGreaterThanOrEqual(e);n&&(this.set.splay(n.value),this.prev=n.getPrevious())}}De.SortedSet=De,Object.addEach(De.prototype,Ot.prototype),Object.addEach(De.prototype,Xt.prototype),Object.addEach(De.prototype,ce.prototype),Object.addEach(De.prototype,Me.prototype),Object.defineProperty(De.prototype,"size",Ot._sizePropertyDescriptor),De.from=Ot.from,De.prototype.isSorted=!0,De.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentCompare,this.getDefault)},De.prototype.has=function(t,e){if(e)throw new Error("SortedSet#has does not support second argument: equals");return!!this.root&&(this.splay(t),this.contentEquals(t,this.root.value))},De.prototype.get=function(t,e){if(e)throw new Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(t),this.contentEquals(t,this.root.value))?this.root.value:this.getDefault(t)},De.prototype.add=function(t){var e=new this.Node(t);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([t],[],0),this.root=e,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([t],[],0),!0;if(this.splay(t),!this.contentEquals(t,this.root.value)){var r=this.contentCompare(t,this.root.value);if(0===r)throw new Error("SortedSet cannot contain incomparable but inequal values: "+t+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([t],[],this.root.index),r<0?(e.right=this.root,e.left=this.root.left,this.root.left=null,this.root.touch()):(e.left=this.root,e.right=this.root.right,this.root.right=null,this.root.touch()),e.touch(),this.root=e,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([t],[],this.root.index),!0}return!1},De.prototype.delete=function(t,e){if(e)throw new Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(t),this.contentEquals(t,this.root.value))){var r=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[t],r),this.root.left){var n=this.root.right;this.root=this.root.left,this.splay(t),this.root.right=n}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[t],r),!0}return!1},De.prototype.indexOf=function(t,e){if(e)throw new Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(t),this.contentEquals(t,this.root.value))?this.root.index:-1},De.prototype.find=function(t,e,r){if(e)throw new Error("SortedSet#find does not support second argument: equals");if(r)throw new Error("SortedSet#find does not support third argument: index");if(this.root&&(this.splay(t),this.contentEquals(t,this.root.value)))return this.root},De.prototype.findGreatest=function(t){if(this.root){for(t=t||this.root;t.right;)t=t.right;return t}},De.prototype.findLeast=function(t){if(this.root){for(t=t||this.root;t.left;)t=t.left;return t}},De.prototype.findGreatestLessThanOrEqual=function(t){if(this.root)return this.splay(t),this.contentCompare(this.root.value,t)>0?this.root.getPrevious():this.root},De.prototype.findGreatestLessThan=function(t){if(this.root)return this.splay(t),this.contentCompare(this.root.value,t)>=0?this.root.getPrevious():this.root},De.prototype.findLeastGreaterThanOrEqual=function(t){if(this.root)return this.splay(t),this.contentCompare(this.root.value,t)>=0?this.root:this.root.getNext()},De.prototype.findLeastGreaterThan=function(t){if(this.root)return this.splay(t),this.contentCompare(this.root.value,t)<=0?this.root.getNext():this.root},De.prototype.pop=function(){if(this.root){var t=this.findGreatest();return this.delete(t.value),t.value}},De.prototype.shift=function(){if(this.root){var t=this.findLeast();return this.delete(t.value),t.value}},De.prototype.push=function(){this.addEach(arguments)},De.prototype.unshift=function(){this.addEach(arguments)},De.prototype.slice=function(t,e){t=t||0,e=e||this.length,t<0&&(t+=this.length),e<0&&(e+=this.length);var r=[];if(this.root)for(this.splayIndex(t);this.root.index<e&&(r.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return r},De.prototype.splice=function(t,e){return this.swap(t,e,Array.prototype.slice.call(arguments,2))},De.prototype.swap=function(t,e,r){if(void 0===t&&void 0===e)return[];(t=t||0)<0&&(t+=this.length),void 0===e&&(e=1/0);var n=[];if(this.root){this.splayIndex(t);for(var i=0;i<e;i++){n.push(this.root.value);var o=this.root.getNext();if(this.delete(this.root.value),!o)break;this.splay(o.value)}}return this.addEach(r),n},De.prototype.splay=function(t){var e,r,n,i,o,s;if(this.root){for(e=r=n=new this.Node,s=new this.Node,o=this.root;;){var a=this.contentCompare(t,o.value);if(a<0){if(!o.left)break;if(this.contentCompare(t,o.left.value)<0&&(i=o.left,o.left=i.right,o.touch(),i.right=o,i.touch(),!(o=i).left))break;(i=new Se).right=o,i.left=s.left,s.left=i,n.left=o,n.touch(),n=o,o=o.left}else{if(!(a>0))break;if(!o.right)break;if(this.contentCompare(t,o.right.value)>0&&(i=o.right,o.right=i.left,o.touch(),i.left=o,i.touch(),!(o=i).right))break;(i=new Se).left=o,i.right=s.right,s.right=i,r.right=o,r.touch(),r=o,o=o.right}}for(r.right=o.left,r.touch(),n.left=o.right,n.touch(),o.left=e.right,o.right=e.left;s.left;)s.left.right.touch(),s.left=s.left.left;for(;s.right;)s.right.left.touch(),s.right=s.right.right;o.touch(),this.root=o}},De.prototype.splayIndex=function(t){if(this.root){for(var e=this.root,r=this.root.index;r!==t;)if(r>t&&e.left)r-=1+((e=e.left).right?e.right.length:0);else{if(!(r<t&&e.right))break;r+=1+((e=e.right).left?e.left.length:0)}return this.splay(e.value),this.root.index===t}return!1},De.prototype.reduce=function(t,e,r){return this.root&&(e=this.root.reduce(t,e,0,r,this)),e},De.prototype.reduceRight=function(t,e,r){return this.root&&(e=this.root.reduceRight(t,e,this.length-1,r,this)),e},De.prototype.min=function(t){var e=this.findLeast(t);if(e)return e.value},De.prototype.max=function(t){var e=this.findGreatest(t);if(e)return e.value},De.prototype.one=function(){return this.min()},De.prototype.clear=function(){var t;this.dispatchesRangeChanges&&(t=this.toArray(),this.dispatchBeforeRangeChange([],t,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],t,0)},De.prototype.iterate=function(t,e){return new this.Iterator(this,t,e)},De.prototype.Iterator=Ie,De.prototype.summary=function(){return this.root?this.root.summary():"()"},De.prototype.log=function(t,e,r,n){t=t||re.unicodeRound,e=e||this.logNode,r||(r=console.log,n=console),r=r.bind(n),this.root&&this.root.log(t,e,r,r)},De.prototype.logNode=function(t,e,r){e(" "+t.value)},De.logCharsets=re,De.prototype.Node=Se,Se.prototype.reduce=function(t,e,r,n,i,o){if(o=o||0,this.left){var s=this.left.length;e=this.left.reduce(t,e,r,n,i,o+1),r+=s}return e=t.call(n,e,this.value,r,i,this,o),r+=1,this.right&&(e=this.right.reduce(t,e,r,n,i,o+1)),e},Se.prototype.reduceRight=function(t,e,r,n,i,o){return o=o||0,this.right&&(e=this.right.reduceRight(t,e,r,n,i,o+1),r-=this.right.length),e=t.call(n,e,this.value,this.value,i,this,o),r-=1,this.left&&(e=this.left.reduceRight(t,e,r,n,i,o+1)),e},Se.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},Se.prototype.checkIntegrity=function(){var t=1;if(t+=this.left?this.left.checkIntegrity():0,t+=this.right?this.right.checkIntegrity():0,this.length!==t)throw new Error("Integrity check failed: "+this.summary());return t},Se.prototype.getNext=function(){var t=this;if(t.right){for(t=t.right;t.left;)t=t.left;return t}},Se.prototype.getPrevious=function(){var t=this;if(t.left){for(t=t.left;t.right;)t=t.right;return t}},Se.prototype.summary=function(){var t=this.value||"-";return t+=" <"+this.length,this.left||this.right?"("+t+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+t+")"},Se.prototype.log=function(t,e,r,n){var i,o,s,a,h=this;i=this.left&&this.right?t.intersection:this.left?t.branchUp:this.right?t.branchDown:t.through,this.left&&this.left.log(t,e,(function(e){o?n(t.strafe+" "+e):(o=!0,n(t.fromBelow+t.through+e))}),(function(t){n("  "+t)})),e(this,(function(e){s?r((h.right?t.strafe:" ")+e):(s=!0,r(i+e))}),(function(e){n((h.left?t.strafe:" ")+e)})),this.right&&this.right.log(t,e,(function(e){a?r("  "+e):(a=!0,r(t.fromAbove+t.through+e))}),(function(e){r(t.strafe+" "+e)}))},Ie.prototype.__iterationObject=null,Object.defineProperty(Ie.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Ie.prototype.next=function(){var t;return(t=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast())?void 0!==this.end&&this.set.contentCompare(t.value,this.end)>=0?(this._iterationObject.done=!0,this._iterationObject.value=void 0):(this.prev=t,this._iterationObject.value=t.value):(this._iterationObject.done=!0,this._iterationObject.value=void 0),this._iterationObject};const Te=R,Re=P;var Be=function(t,e=xt.defaultScoringTypes,r={}){t.fixes=t.fixes.filter(t=>t.valid);let n=[];for(let r of e){const e={flight:t,scoring:r};let i=new Te([new Re(0,t.fixes.length-1),new Re(0,t.fixes.length-1),new Re(0,t.fixes.length-1),new Re(0,t.fixes.length-1),new Re(0,t.fixes.length-1)],e);i.do_bound(),i.do_score(),n.push(i)}let i=n[0],o=new Le(n,Te.prototype.contentEquals,Te.prototype.contentCompare),s=0;const a=Date.now();t:for(;o.length>0;){let t=o.pop();if(!r.quiet&&process.stdout.write&&process.stdout.write(`${o.length} elements in queue, processing ${t.id} ( <${t.bound.toFixed(4)} ~${i.opt.scoring.rounding(t.score)} ) best=${i.opt.scoring.rounding(i.score)} (${i.opt.scoring.name})`+(r.debug?` ${t.ranges[0].count()} ${t.ranges[1].count()} ${t.ranges[2].count()} ${t.ranges[0].a}:${t.ranges[0].b} ${t.ranges[1].a}:${t.ranges[1].b} ${t.ranges[2].a}:${t.ranges[2].b}\r`:"\r")),t.bound<=i.score){!r.quiet&&process.stdout.write&&process.stdout.write("only shit left in queue                                                                                                                  \n");break}let e=t.do_branch();for(let t of e)if(t.do_bound(),!(t.bound<=i.score)){if(t.do_score(),s++,s>r.maxloop||(Date.now()-a)/1e3>r.maxtime){i.optimal=!1,process.stderr.write("max limit reached                    \n");break t}t.score>=i.score&&t.score>0&&(i=t,!r.quiet&&process.stdout.write&&process.stdout.write(`best so far : ${t.opt.scoring.name}, ${t.score.toFixed(5)} points, id:${t.id}`+(r.debug?` ${t.ranges[0].a}:${t.ranges[0].b} ${t.ranges[1].a}:${t.ranges[1].b} ${t.ranges[2].a}:${t.ranges[2].b} ${t.parent}`:"")+"                                                                        \n")),o.push(t)}}return!r.quiet&&process.stdout.write&&process.stdout.write(`processed ${s} candidates       \n`),i.processed=s,i.time=Date.now()-a,void 0===i.optimal&&(i.optimal=!0),i.score=i.opt.scoring.rounding(i.score),i.scoreInfo.distance=i.opt.scoring.rounding(i.scoreInfo.distance),i.scoreInfo.cp.d&&(i.scoreInfo.cp.d=i.opt.scoring.rounding(i.scoreInfo.cp.d)),i};process.argv[2]||(console.log("please specify an IGC file"),process.exit(1));const Fe=O.parse(e.readFileSync(process.argv[2],"utf8"));let Ne={};for(let t of process.argv.slice(3)){const e=t.split("=");isNaN(e[1])?"true"===e[1]?Ne[e[0]]=!0:"false"===e[1]?Ne[e[0]]=!1:Ne[e[0]]=e[1]:Ne[e[0]]=parseInt(e[1])}Object.keys(Ne).length&&!Ne.quiet&&console.log(Ne);const qe=Be(Fe,xt.defaultScoringTypes,Ne);Ne.out&&e.writeFileSync(Ne.out,JSON.stringify(qe.geojson(Ne))),console.log("best solution is "+((qe.optimal?L.fg.green+"optimal":L.fg.red+"not optimal")+L.reset)+` ${L.fg.yellow}${qe.opt.scoring.name}`+` ${L.fg.green}${qe.score} points,`+` ${L.fg.yellow}${qe.scoreInfo.distance}km`+(qe.opt.scoring.closingDistance?` [ closing distance is ${qe.scoreInfo.cp.d}km ]`:"")+(qe.optimal?"":` potential maximum score could be up to ${qe.bound.toFixed(2)} points`)+L.reset);